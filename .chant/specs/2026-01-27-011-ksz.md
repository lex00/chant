---
type: code
status: needs_attention
target_files:
- src/main.rs
---
# Fix 00x-v6m: Add --all-completed flag to merge command CLI

## Problem

Spec 00x-v6m (Add chant merge --all-completed convenience flag) was marked completed but the feature was not fully integrated into the CLI:

- Implementation exists in `src/cmd/lifecycle.rs` (functions `find_completed_specs_with_branches()` and logic in `cmd_merge()`)
- `cmd_merge()` function signature has `all_completed` parameter
- **BUT** the CLI argument definition is missing from `src/main.rs`
- This caused a compile error: function expects 9 args but only receives 8
- Currently hardcoded to `false` as a temporary fix

**Evidence from audit**:
```bash
$ cargo build
error[E0061]: this function takes 9 arguments but 8 arguments were supplied
  --> src/main.rs:587

$ chant merge --all-completed
error: unexpected argument '--all-completed' found
```

## Solution

Add the missing `--all-completed` flag to the `Merge` command struct in `src/main.rs`:

```rust
/// Merge completed spec branches back to main
Merge {
    /// Spec ID(s) to merge (one or more)
    #[arg(value_name = "ID")]
    ids: Vec<String>,
    /// Merge all completed spec branches
    #[arg(long)]
    all: bool,
    /// Merge all completed specs that have branches (convenience flag)
    #[arg(long)]
    all_completed: bool,
    /// Preview merges without executing
    #[arg(long)]
    dry_run: bool,
    // ... rest of fields
}
```

Update the match arm to pass `all_completed` instead of hardcoded `false`:

```rust
Commands::Merge {
    ids,
    all,
    all_completed,  // Add this
    dry_run,
    delete_branch,
    continue_on_error,
    yes,
    rebase,
    auto,
} => cmd::lifecycle::cmd_merge(
    &ids,
    all,
    all_completed,  // Pass actual value
    dry_run,
    delete_branch,
    continue_on_error,
    yes,
    rebase,
    auto,
),
```

## Acceptance Criteria

- [ ] Add `all_completed` field to Merge command struct
- [ ] Add doc comment explaining the flag
- [ ] Update pattern match to extract `all_completed`
- [ ] Pass `all_completed` to `cmd_merge()` (remove hardcoded `false`)
- [ ] Verify `chant merge --help` shows `--all-completed` flag
- [ ] Test: `chant merge --all-completed` runs successfully
- [ ] Test: Flag works with `--yes`, `--delete-branch`, etc.
- [ ] All existing tests pass