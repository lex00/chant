---
type: code
status: pending
target_files:
  - src/cmd/lifecycle.rs
---

# Auto-resolve spec frontmatter conflicts during merge

## Problem

When merging spec branches back to main, frontmatter conflicts occur because:
- Main has `status: completed` (from finalize)
- Feature branch has `status: in_progress`
- Main may have `completed_at` and `model` fields
- Feature branch may not have these fields yet

This forces manual conflict resolution, and using `git checkout --theirs` can discard actual implementation code while keeping wrong metadata.

**Current workflow failure**:
```bash
git merge --no-ff chant/2026-01-27-00l-egi
# CONFLICT in .chant/specs/2026-01-27-00l-egi.md
git checkout --theirs .chant/specs/2026-01-27-00l-egi.md  # WRONG: loses implementation
```

## Solution

Add custom merge driver for `.chant/specs/*.md` files that:
1. Detects frontmatter vs body conflicts
2. For frontmatter conflicts:
   - Prefers feature branch version for status/metadata (it's fresher)
   - Takes completed_at, model from whichever side has them
3. For body conflicts (actual content):
   - Uses standard 3-way merge
   - Conflicts if both sides changed same sections

Register in `.gitattributes`:
```
.chant/specs/*.md merge=chant-spec
```

Configure merge driver in `.chant/config.md` or global git config.

## Acceptance Criteria

- [ ] Create custom merge driver script/binary
- [ ] Merge driver parses frontmatter from both sides
- [ ] Merge driver intelligently resolves status conflicts
- [ ] Merge driver preserves implementation content
- [ ] Add .gitattributes entry for spec files
- [ ] Document merge driver installation
- [ ] Test: merge spec with status conflict resolves automatically
- [ ] Test: merge spec with body changes preserves code
- [ ] All existing tests pass
