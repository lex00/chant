---
type: code
status: in_progress
target_files:
- justfile
---
# Add just release command for automated releases

## Problem

Releasing a new version requires multiple manual steps:
1. Edit Cargo.toml version
2. cargo build --release (updates Cargo.lock)
3. Commit "Release vX.Y.Z"
4. git tag vX.Y.Z
5. git push && git push --tags
6. Wait for GitHub Actions
7. Update homebrew formula with new SHA256 hashes

Steps 1-5 should be automated.

## Solution

Add a `just release VERSION` command that:
1. Updates version in Cargo.toml using sed
2. Runs cargo build --release to update Cargo.lock
3. Commits both files with "Release vX.Y.Z"
4. Creates git tag vX.Y.Z
5. Pushes commits and tags
6. Prints instructions for homebrew update

## Acceptance Criteria

- [ ] `just release 0.2.0` works end-to-end
- [ ] Version format validated (must be X.Y.Z)
- [ ] Fails if working directory is dirty
- [ ] Fails if version already exists as tag
- [ ] Updates Cargo.toml version field
- [ ] Runs cargo build to update Cargo.lock
- [ ] Creates commit with message "Release vX.Y.Z"
- [ ] Creates annotated tag vX.Y.Z
- [ ] Pushes to origin (commits + tags)
- [ ] Prints next steps for homebrew update
- [ ] All tests pass

## Example Usage

```bash
just release 0.2.0
# Updates Cargo.toml to version = "0.2.0"
# Builds release
# Commits "Release v0.2.0"
# Tags v0.2.0
# Pushes
# Prints: "Now update homebrew formula..."
```

## Implementation Notes

Use sed for Cargo.toml update:
```bash
sed -i '' 's/^version = ".*"/version = "NEW_VERSION"/' Cargo.toml
```

Check for dirty working directory:
```bash
git diff --quiet || (echo "Working directory dirty" && exit 1)
```

Check tag doesn't exist:
```bash
git tag -l "vVERSION" | grep -q . && (echo "Tag exists" && exit 1)
```