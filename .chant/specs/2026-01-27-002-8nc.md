---
type: code
status: completed
depends_on:
- 2026-01-27-001-sul
labels:
- multi-repo
- v0.4.0
target_files:
- src/spec.rs
- src/deps.rs
- src/config.rs
- src/lib.rs
- src/merge.rs
- src/prompt.rs
- src/cmd/work.rs
- Cargo.toml
completed_at: 2026-01-27T00:00:00Z
model: claude-haiku-4-5-20251001
---
# Implement cross-repo dependencies with depends_on field

Enable specs to depend on specs in other repositories using the `repo:spec-id` syntax in the `depends_on` field.

## Context

With repo prefix parsing (001-sul), we can now implement actual cross-repo dependency resolution. This allows specs in one repo to block on specs in another:

```yaml
# In backend repo: .chant/specs/2026-01-27-001-abc.md
---
depends_on:
  - shared:types-2026-01-22-001-xyz   # Wait for shared repo spec
---
```

## Design

### Global Config for Repos

```yaml
# ~/.config/chant/config.yaml
repos:
  - path: ~/work/frontend
    name: frontend
  - path: ~/work/backend
    name: backend
  - path: ~/work/shared
    name: shared
```

### Dependency Resolution Flow

1. Parse `depends_on` entries, extracting repo prefix if present
2. For local deps (no prefix), resolve in current repo
3. For cross-repo deps (`repo:id`):
   a. Look up repo path in global config
   b. Load spec from that repo's `.chant/specs/` directory
   c. Check spec status
4. Spec is blocked if any dependency (local or cross-repo) is not completed

### Error Handling

- Missing repo in config: Error with suggestion to add to `~/.config/chant/config.yaml`
- Repo path doesn't exist: Error with path
- Spec not found in remote repo: Error with full path checked
- Circular cross-repo deps: Detect and error

## Acceptance Criteria

- [x] Global config supports `repos:` list with `path` and `name` fields
- [x] `depends_on` accepts `repo:spec-id` format
- [x] Cross-repo dependencies are resolved by loading specs from other repos
- [x] Spec marked `blocked` when cross-repo dependency incomplete
- [x] `chant show` displays cross-repo dependencies with repo prefix
- [x] `chant list --blocked` shows specs blocked by cross-repo deps
- [x] Error message when repo not in global config
- [x] Error message when cross-repo spec not found
- [x] Circular dependency detection works across repos
- [x] Tests cover cross-repo dependency scenarios
- [x] `just lint` passes with no warnings

## Notes

- Requires both repos to be checked out locally
- Cross-repo deps are read-only (can't modify specs in other repos)
- Consider caching remote spec status to avoid repeated filesystem reads