---
type: code
status: completed
target_files:
- tests/integration_tests.rs
- justfile
model: claude-haiku-4-5-20251001
---
# Add end-to-end test for new user workflow with ollama

## Problem

There is no integration test that validates the complete new user experience:
1. Creating a fresh git repository
2. Installing/initializing chant
3. Creating a spec
4. Executing the spec with a real AI provider

The existing `test_new_developer_experience` tests building chant from source, not the end-user workflow.

## Solution

Add a new ignored integration test `test_new_user_workflow_ollama` that:

1. **Creates a fresh git repository** in a temp directory
2. **Initializes chant** with `chant init`
3. **Creates a simple spec** that asks the AI to create a file (e.g., "Create a file called hello.txt with the text 'Hello, World!'")
4. **Executes the spec** using ollama provider
5. **Validates the result** - checks that the expected file was created

## Requirements

- Test should be `#[ignore]` by default (only runs when ollama is available)
- Skip gracefully if ollama is not installed or not running
- Use a simple, fast model (e.g., `qwen2.5-coder:1.5b` or similar small model)
- Clean up temp directory after test
- Add a `just` command for running this test easily

## Acceptance Criteria

- [x] New test `test_new_user_workflow_ollama` in integration_tests.rs
- [x] Test is ignored by default with clear run instructions in docstring
- [x] Test skips gracefully if ollama is unavailable (not a failure)
- [x] Test creates fresh git repo, inits chant, creates spec, runs with ollama
- [x] Test validates that the AI-generated output is correct
- [x] Add `just test-ollama` command to justfile for easy execution
- [x] Test passes when ollama is running with an appropriate model