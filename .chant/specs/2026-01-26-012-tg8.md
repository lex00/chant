---
type: code
status: completed
target_files:
- src/main.rs
- src/cmd/search.rs
- src/cmd/mod.rs
- Cargo.toml
- docs/reference/search.md
model: claude-haiku-4-5-20251001
---
# Add chant search command for simple text search of spec titles and body content

## Overview

Add a `chant search` command that performs case-insensitive text search across spec titles and body content. Searches both active and archived specs. Integrates with existing filter flags for combined queries.

## Interface

### Interactive Mode (Wizard)

When run without a query, launches an interactive wizard using `dialoguer`:

```bash
chant search
```

```
? Search query: auth
? Search in:
› Title + Body
  Title only
  Body only
? Date range:
› Any time
  Last 7 days (--since 7d)
  Last 2 weeks (--since 2w)
  Last month (--since 1m)
  Custom...
? Include archived specs? Yes
? Filter by status:
› Any
  pending
  ready
  in_progress
  completed
  failed
? Filter by type:
› Any
  code
  task
  documentation
  research

Searching...

● 2026-01-24-001-abc Add user authentication
● 2026-01-24-005-xyz Fix auth token refresh

Found 2 specs matching "auth"
```

Uses `dialoguer` crate:
- `Input` for search query
- `Select` for single-choice options (arrow keys + Enter)
- `Confirm` for yes/no (include archived)
- Option labels include CLI flag hints where useful (e.g., `--since 7d`)

### Direct Mode

```bash
chant search "authentication"           # Search title + body
chant search "auth" --title-only        # Search title only
chant search "TODO" --body-only         # Search body only
chant search "fix" --status pending     # Combine with status filter
chant search "api" --type code          # Combine with type filter
chant search "api" --label feature      # Combine with label filter
chant search "Auth" --case-sensitive    # Case-sensitive match
```

### Date Filtering

```bash
chant search "bug" --since 7d           # Last 7 days
chant search "feature" --since 2w       # Last 2 weeks
chant search "api" --since 1m           # Last 1 month
chant search "auth" --since 2026-01-20  # Since specific date
chant search "fix" --until 2026-01-15   # Until specific date
chant search "api" --since 1w --until 3d  # Between 1 week and 3 days ago
```

Date is based on spec ID date component (YYYY-MM-DD prefix).

### Archive Control

```bash
chant search "auth"                     # Search both active AND archived (default)
chant search "auth" --active-only       # Only .chant/specs/
chant search "auth" --archived-only     # Only .chant/archive/
```

## Implementation

1. Add `Search` variant to `Commands` enum in main.rs:
   ```rust
   Search {
       query: String,
       #[arg(long)]
       title_only: bool,
       #[arg(long)]
       body_only: bool,
       #[arg(long)]
       case_sensitive: bool,
       #[arg(long)]
       status: Option<String>,
       #[arg(long)]
       type_: Option<String>,
       #[arg(long)]
       label: Vec<String>,
       #[arg(long)]
       since: Option<String>,    // "7d", "2w", "1m", or "YYYY-MM-DD"
       #[arg(long)]
       until: Option<String>,
       #[arg(long)]
       active_only: bool,
       #[arg(long)]
       archived_only: bool,
   }
   ```

2. Create `src/cmd/search.rs` with `cmd_search()`:
   - Load specs from both `.chant/specs/` and `.chant/archive/`
   - Apply text filter: check if query appears in title/body
   - Apply date filter: parse spec ID date, compare to since/until
   - Apply status/type/label filters
   - Output matching specs in list format

3. Date parsing for `--since` and `--until`:
   - `Nd` = N days ago
   - `Nw` = N weeks ago
   - `Nm` = N months ago
   - `YYYY-MM-DD` = specific date

4. Interactive wizard (when no query provided):
   - Use `dialoguer` crate for prompts (already in Cargo.toml or add it)
   - Prompt for query (required)
   - Prompt for search scope (select: title+body, title, body)
   - Prompt for date range (select: any, 7d, 2w, 1m, custom)
   - Prompt for archive inclusion (confirm)
   - Prompt for status filter (select: any, pending, ready, etc.)
   - Prompt for type filter (select: any, code, task, etc.)

5. Search logic:
   - Default: case-insensitive
   - Default: search both title and body
   - Default: search both active and archived
   - Body = everything after frontmatter
   - Title = first `# ` heading or spec.title

## Output Format

Same as `chant list` but with archive indicator:
```
● 2026-01-24-001-abc Add user authentication
● 2026-01-24-005-xyz Fix auth token refresh
◌ 2026-01-20-003-def [archived] Old auth implementation
```

With no matches:
```
No specs found matching "nonexistent"
```

## Acceptance Criteria

### Core Functionality
- [x] `chant search <query>` searches title and body (case-insensitive)
- [x] `--title-only` restricts to title
- [x] `--body-only` restricts to body
- [x] `--case-sensitive` enables case-sensitive matching
- [x] `--status`, `--type`, `--label` filters work in combination
- [x] `--since` filters by date (supports Nd, Nw, Nm, YYYY-MM-DD)
- [x] `--until` filters by date
- [x] Searches both active and archived specs by default
- [x] `--active-only` and `--archived-only` control scope
- [x] Output format matches `chant list` with archive indicator

### Interactive Wizard
- [x] `chant search` (no args) launches interactive wizard
- [x] Wizard uses dialoguer: Input for query, Select for options, Confirm for yes/no
- [x] Wizard prompts for: query, search scope, date range, archive, status, type
- [x] Option labels include CLI flag hints where useful (e.g., "Last 7 days (--since 7d)")

### Tests
- [x] Unit tests for date parsing (7d, 2w, 1m, YYYY-MM-DD)
- [x] Unit tests for text matching (case-sensitive, case-insensitive)
- [x] Unit tests for filter combinations
- [x] Integration test for search across specs and archive

### Documentation
- [x] Add Search section to docs/reference/search.md
- [x] Document both direct and wizard modes
- [x] Include examples of date filtering and filter combinations

### Quality
- [x] All tests pass
- [x] Code formatted and linted