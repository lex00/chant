---
type: code
status: completed
model: claude-haiku-4-5-20251001
---
# Document MCP error codes and response structures

## Acceptance Criteria

- [x] Error codes documented in source code with comments
- [x] Response structures documented in source code
- [x] Error codes reference guide added to docs/reference/mcp.md
- [x] Tool-level error responses documented with examples
- [x] JSON-RPC protocol errors documented with examples
- [x] All tests passing
- [x] Code formatted and linted

## Summary

Comprehensive documentation of MCP error codes and response structures has been added:

### Source Code Documentation (src/mcp.rs)

- Added detailed doc comments to `JsonRpcError` struct with error code descriptions
- Added doc comments to `JsonRpcResponse` struct explaining success/error responses
- Documented `JsonRpcResponse::success()` and `JsonRpcResponse::error()` methods with parameter descriptions
- Added doc comments to `handle_request()` explaining error handling flow with all error codes
- Added doc comments to `mcp_ensure_initialized()` explaining tool-level error format vs JSON-RPC errors

### Reference Documentation (docs/reference/mcp.md)

Added comprehensive "Error Codes and Response Structures" section including:

- **JSON-RPC 2.0 Error Codes table**: -32700 (parse error), -32600 (invalid version), -32603 (server error)
- **Error Response Structure**: Shows complete JSON-RPC error format with all fields
- **Tool-Level Error Responses**: Explains how tools return errors with `isError: true` flag
- **Common Tool-Level Errors table**: 11 different error conditions and which tools produce them
- **Success Response Structure**: Documents the format of successful tool responses
- **Notifications**: Explains requests without IDs and currently supported notifications
- **Response Content Types**: Documents content type field options
- **Error Handling Best Practices**: 4 key practices for consuming MCP responses
- **Example Error Scenarios**: 3 detailed examples with full request/response JSON

All existing tests pass and code follows project standards.