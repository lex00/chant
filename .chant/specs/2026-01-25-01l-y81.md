---
type: code
status: completed
commits:
- e7f93b6
completed_at: 2026-01-25T23:03:00Z
model: haiku
---
# Document MCP error codes and response structures

## Acceptance Criteria

- [x] Error codes documented in source code with comments
- [x] Response structures documented in source code
- [x] Error codes reference guide added to docs/reference/mcp.md
- [x] Tool-level error responses documented with examples
- [x] JSON-RPC protocol errors documented with examples
- [x] All tests passing
- [x] Code formatted and linted

## Summary

Comprehensive documentation of MCP error codes and response structures has been added:

### Source Code Documentation (src/mcp.rs)

- Added detailed doc comments to `JsonRpcError` struct with error code descriptions
- Added doc comments to `JsonRpcResponse` struct explaining success/error responses
- Documented `JsonRpcResponse::success()` and `JsonRpcResponse::error()` methods with parameter descriptions
- Added doc comments to `handle_request()` explaining error handling flow with all error codes
- Added doc comments to `mcp_ensure_initialized()` explaining tool-level error format vs JSON-RPC errors

### Reference Documentation (docs/reference/mcp.md)

Added comprehensive "Error Codes and Response Structures" section including:

- **JSON-RPC 2.0 Error Codes table**: -32700 (parse error), -32600 (invalid version), -32603 (server error)
- **Error Response Structure**: Shows complete JSON-RPC error format with all fields
- **Tool-Level Error Responses**: Explains how tools return errors with `isError: true` flag
- **Common Tool-Level Errors table**: 11 different error conditions and which tools produce them
- **Success Response Structure**: Documents the format of successful tool responses
- **Notifications**: Explains requests without IDs and currently supported notifications
- **Response Content Types**: Documents content type field options
- **Error Handling Best Practices**: 4 key practices for consuming MCP responses
- **Example Error Scenarios**: 3 detailed examples with full request/response JSON

All existing tests pass and code follows project standards.

## Agent Output

2026-01-25T23:03:00Z

```
I'll start by reviewing the spec and reading the relevant code to understand what needs to be documented.
Now let me check what documentation already exists:
Let me read the existing MCP documentation:
Now I understand the context. Let me create a plan for documenting the MCP error codes and response structures. Let me first set up a todo list:
Now let me analyze the code to identify all error codes and response structures. Based on my reading of the code:

**Error Codes Found:**
- `-32700`: Parse error (JSON parsing failed)
- `-32600`: Invalid JSON-RPC version
- `-32603`: Server error (generic internal error)

**Response Structures:**
1. JsonRpcResponse - contains result, error, id, jsonrpc
2. JsonRpcError - contains code, message, data
3. Tool responses - content array with type and text

Let me update the documentation:
Now let me add documentation to the source code. I'll add detailed doc comments to the error-related code:
Now let me add documentation to the handle_request function to explain error codes:
Now let me add documentation to the mcp_ensure_initialized function to explain tool-level errors:
Let me update my todo list:
Now let me run cargo fmt and cargo clippy:
Let me check the clippy output:
Let me wait for clippy to finish:
Great! Both fmt and clippy passed. Now let me run the tests:
Excellent! All tests pass. Now let me update the todo list and verify the changes:
Now let me check the git status and commit the changes:
Let me check the spec file to see what needs to be updated:
Now let me update the spec file with acceptance criteria completion and the model field:
Now let me commit the changes:
Perfect! Let me verify the git status is clean:
Let me update the final todo:
Perfect! The spec has been completed successfully. Let me summarize what was accomplished:

## Summary

I've successfully documented the MCP error codes and response structures for the chant project. Here's what was delivered:

### Source Code Documentation (src/mcp.rs)

Added comprehensive doc comments explaining:
- **JsonRpcError struct**: Documents error codes (-32700, -32600, -32603) and their meanings
- **JsonRpcResponse struct**: Explains the response structure with success/error patterns
- **Response methods**: Detailed documentation of `success()` and `error()` constructors
- **request handler**: Full explanation of error handling flow and when each error code occurs
- **initialization checker**: Clarifies tool-level vs protocol-level errors

### Reference Documentation (docs/reference/mcp.md)

Added a new "Error Codes and Response Structures" section with:
- **JSON-RPC 2.0 Error Codes table**: Maps error codes to descriptions and when they occur
- **Error Response Structure**: Shows complete JSON format with all fields explained
- **Tool-Level Error Responses**: Documents the `isError: true` pattern used by tools
- **Common Tool Errors table**: 11 different error conditions with affected tools
- **Success Response Structure**: Documents tool response format
- **Notifications**: Explains notification requests without IDs
- **Best Practices**: 4 key practices for error handling
- **Example Scenarios**: 3 detailed request/response examples showing:
  - Parse error (-32700)
  - Missing parameter error
  - Not initialized error

### Quality Assurance

- ✅ All 121 unit tests pass
- ✅ All 138 integration tests pass  
- ✅ All 16 end-to-end tests pass
- ✅ Code formatted with `cargo fmt`
- ✅ Code linted with `cargo clippy` (no warnings)
- ✅ Changes committed with proper message

The documentation is now comprehensive and provides clear guidance for anyone using or integrating with the chant MCP server.```
