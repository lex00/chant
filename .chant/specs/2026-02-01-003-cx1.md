---
type: code
status: in_progress
---
# Fix MCP server using relative paths - specs written to wrong directory

MCP server uses relative path `.chant/specs` which resolves relative to the server's working directory, not the project directory. When Claude Code runs MCP from a different cwd, specs are written to wrong location.

## Bug Location

In `src/mcp.rs:517-530`:
```rust
fn mcp_ensure_initialized() -> Result<PathBuf, Value> {
    let specs_dir = PathBuf::from(SPECS_DIR);  // ".chant/specs" - RELATIVE!
    ...
}
```

## Fix

Discover project root by walking up from cwd looking for `.chant/` directory:

```rust
fn find_project_root() -> Option<PathBuf> {
    let mut current = std::env::current_dir().ok()?;
    loop {
        if current.join(".chant").is_dir() {
            return Some(current);
        }
        if !current.pop() {
            return None;
        }
    }
}

fn mcp_ensure_initialized() -> Result<PathBuf, Value> {
    let project_root = find_project_root()
        .ok_or_else(|| /* error: not in chant project */)?;
    let specs_dir = project_root.join(SPECS_DIR);
    ...
}
```

## Acceptance Criteria

- [x] Add `find_project_root()` function in src/mcp.rs
- [x] Update `mcp_ensure_initialized()` to use absolute path from project root
- [x] MCP tools work correctly when cwd differs from project directory
- [x] `cargo test` passes