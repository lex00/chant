---
type: code
status: completed
target_files:
- src/main.rs
- src/spec.rs
commits:
- fb0cc3a
completed_at: 2026-01-24T21:45:39Z
model: haiku
---
# Mark driver spec in_progress when member task starts

## Problem

When a member spec (e.g., `01e.1`) starts work, the driver spec (`01e`) should automatically transition from `pending` to `in_progress`.

Currently, driver specs stay `pending` even when their member tasks are being worked on, which doesn't accurately reflect the group's status.

## Behavior

When `chant work <member-id>` is called:
1. Detect if the spec is a member (has a `.N` suffix)
2. Find the driver spec (remove the `.N` suffix)
3. If driver exists and is `pending`, set it to `in_progress`
4. Save the driver spec

## Acceptance Criteria

- [x] Detect member specs by `.N` suffix pattern (e.g., `01e-o0l.1`)
- [x] Extract driver ID from member ID (e.g., `01e-o0l.1` â†’ `01e-o0l`)
- [x] When member starts work, set driver status to `in_progress` if currently `pending`
- [x] Don't change driver status if already `in_progress` or `completed`
- [x] Save driver spec after status change
- [x] Add test for driver status update when member starts
- [x] Handle case where driver spec doesn't exist (no error, just skip)

## Agent Output

2026-01-24T21:45:39Z

```
I'll implement this spec for marking driver specs as in_progress when member tasks start. Let me start by understanding the codebase structure and then plan the implementation.
Let me explore the codebase structure more broadly:
Let me read the spec file and relevant source code:
Now let me read the main.rs file to understand the work command:
Let me read the work command section:
Good! I can see where the spec status is set to InProgress at line 873. Now let me create a plan for this implementation:
Now let me understand the spec.rs file more carefully. I notice that:

1. There's already an `is_member_of` function (line 218-226) that checks if a spec ID is a member
2. There's a `load_all_specs` function that loads all specs from a directory
3. Specs have a save method

I need to:
1. Create a helper function to extract the driver ID from a member ID
2. Add logic in `cmd_work` to update the driver spec's status when a member starts
3. Add tests for this functionality

Let me start by implementing these changes:
Now I'll add a function to extract the driver ID from a member ID and a function to mark the driver as in_progress. Let me edit the spec.rs file:
Now I need to add tests for these new functions. Let me add them to the tests section:
Now let me add a more comprehensive test for the mark_driver_in_progress function:
Now I need to integrate this into the cmd_work function. Let me find the right place to call this function:
Perfect! I can see that at line 873-874, the spec status is updated to in_progress and saved. I should add the call to mark_driver_in_progress right after that. Let me edit the main.rs file:
Now let me run the tests to verify everything works:
Let me check what build tools are available:
Perfect! Let me run the tests using just:
I have a test failure. The issue is that my `extract_driver_id` function is not correctly handling nested member specs like `2026-01-22-001-x7m.2.1`. Let me fix the logic:
Now let's run the tests again:
Great! All tests pass. Now let me run the full build and linting:
Let me fix the clippy warning:
Excellent! Now let me check the formatting:
The formatting issues are in my code. Let me fix them:
Good! The formatting error in spec.rs is fixed. The other errors are in main.rs but they're not from my changes. Let me run the format command to fix the formatting:
Now let me verify the formatting is correct:
Great! Now let me run all checks:
This test failure is unrelated to my changes - it appears to be a pre-existing issue. Let me verify my changes don't affect that test by checking what it is:
The test failure appears to be pre-existing since it's in the main.rs test code and not related to my changes. Let me check if this test was failing before my changes by looking at the test directly:
Good - my changes to main.rs only added the call to mark_driver_in_progress, and the other changes are just formatting. Let me check if the test was failing before:
So there are pre-existing test failures. Let me restore my changes:
Now let me run only my tests to verify my implementation works:
Perfect! All my tests pass. Now let me build the project:
Excellent! The build is successful. Now let me update the acceptance criteria in the spec file and mark my tasks as completed:
Now let me update the acceptance criteria to mark them as complete:
Now I need to add the model and mark the spec as completed. Let me read the spec again to see the current status:
Now let me add the model to the frontmatter. Let me update the spec to add the model field:
Now let me update my todo list and commit the changes:
Now let me commit the changes:
Perfect! Let me verify the commit was created successfully:
Excellent! Let me mark the final todo as completed and verify everything is working:
Perfect! Let me verify my implementation one more time by reviewing what was done:
Perfect! Let me create a summary of what was implemented:

## Summary

I have successfully implemented the feature to mark driver specs as `in_progress` when member tasks start. Here's what was completed:

### Changes Made:

1. **Added `extract_driver_id()` function in `spec.rs`** (src/spec.rs:228-241)
   - Extracts the driver ID from a member ID by finding the first `.` and checking if what follows is numeric
   - Handles nested member specs (e.g., `01e-o0l.1` and `01e-o0l.2.1` both return `01e-o0l`)

2. **Added `mark_driver_in_progress()` function in `spec.rs`** (src/spec.rs:244-256)
   - Marks the driver spec as `in_progress` when a member starts work
   - Only updates status if driver exists and is currently `pending`
   - Safely handles case where driver doesn't exist (no error)
   - Saves the updated driver spec to disk

3. **Integrated into `cmd_work()` in `main.rs`** (src/main.rs:876-878)
   - Added call to `mark_driver_in_progress()` after updating member spec status
   - Ensures driver status is updated as soon as member work begins

4. **Added comprehensive tests** (src/spec.rs:397-405, 469-533)
   - `test_extract_driv

... (output truncated, 5986 chars total)```
