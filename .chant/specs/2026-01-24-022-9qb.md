---
type: research
status: completed
completed_at: 2026-01-25T00:30:00Z
model: claude-haiku-4-5-20251001
---
# Investigate status reset - manual edit vs CLI command

## Question

When a spec fails or gets stuck in `in_progress`, how should users reset it to `pending`?

## Options

### Option A: Manual edit
- User edits the spec file directly
- Changes `status: in_progress` to `status: pending`
- Pro: Simple, no new code
- Con: Error-prone, might forget to clear other fields

### Option B: CLI command
```bash
chant reset <spec-id>        # Reset to pending
chant reset --status failed  # Set specific status
```
- Pro: Safe, clears related fields (completed_at, commits, model)
- Con: More code to maintain

### Option C: Both
- Manual edit always works (it's just a file)
- CLI command for convenience and safety

## Fields to clear on reset

When resetting to `pending`:
- `status` → `pending`
- `completed_at` → remove
- `commits` → remove
- `model` → remove (or keep?)
- Agent Output section → remove?

## Questions

- [x] Should reset clear the Agent Output section?
- [x] Should reset require confirmation?
- [x] Should there be a `chant retry` that resets and immediately works?
- [x] What about resetting a group driver - reset all members too?

## Findings

### Research: How Other Systems Handle Reset

**Apache Airflow**: Uses a "Clear" operation that resets task state to enable retry. Automatically configured retry limits allow transient failures to self-heal without explicit reset.

**Prefect**: Built-in retry mechanism automatically re-executes failed tasks (configurable attempts and delays). Manual reset is rarely needed because retries are automatic.

**Kestra**: Similar approach—retries are configured at task definition time, automatic retry with backoff is the primary recovery mechanism.

**Key insight**: Most modern task runners prioritize _automatic retry configuration_ over manual reset commands. Manual reset is a fallback for edge cases.

### Current Chant Architecture Analysis

**Spec File Structure** (src/spec.rs):
- Status is a required field in frontmatter (YAML enum: pending | in_progress | completed | failed | needs_attention)
- Completion metadata (commits, completed_at, model) is optional and only populated by `finalize_spec()`
- Optional fields are not serialized if None (clean YAML output)
- The Spec struct itself is immutable during save—no validation side effects

**Status Transitions** (src/main.rs):
1. `pending` → `in_progress` when `chant work` is invoked (line 985)
2. `in_progress` → `completed` on successful finalization (line 1827)
3. `in_progress` → `failed` if unchecked acceptance criteria remain (line 1024) OR agent invocation fails (line 1094)
4. `in_progress` → `needs_attention` if parallel cleanup fails (lines 1316, 1348)

**Finalization is Three-Phase** (src/main.rs, lines 1803-1902):
1. Sets status, commits, completed_at, model
2. Saves to disk
3. Validates persistence (reloads and verifies all fields persisted correctly)

**Re-finalization exists** (lines 1904+): Can update commits and timestamp for specs already in_progress or completed.

### Risk Analysis by Option

#### Option A: Manual Edit (Status quo)
**Pros:**
- Zero code maintenance
- Transparent—users can see exactly what they're changing
- Follows Git philosophy (direct file editing always works)
- Already the de facto approach when specs get stuck

**Cons:**
- Error-prone—easy to forget clearing related fields (commits, completed_at, model)
- No validation—malformed YAML silently fails to load
- No safety checks—user might reset a completed spec accidentally
- Inconsistent state possible (in_progress with completed_at timestamp creates confusion)
- **Critical issue**: If user manually edits status to in_progress while commits/completed_at/model are still set, the next finalize will create invalid state

**Specific risks:**
1. User resets `status: in_progress` → `status: pending` but forgets to clear `completed_at`
   - Spec now claims to be pending but has a completion timestamp
   - Violates semantic consistency (what does "pending but completed?" mean?)
2. User manually edits but makes YAML syntax error
   - Spec fails to load silently (serde_yaml just returns error)
   - No feedback on what went wrong
3. Resetting a member spec (.1, .2, etc.) without clearing driver state
   - Driver might remain marked completed even though member is now pending
   - `is_ready()` logic expects consistency between driver and members

#### Option B: CLI Command (`chant reset <spec-id>`)
**Pros:**
- Safe—can validate spec exists, current status, etc. before modifying
- Atomic—single operation updates all related fields
- Clear semantics—explicit command shows user intent
- Can enforce constraints (e.g., "cannot reset completed spec without --force")
- Can handle driver/member relationships (reset driver optionally resets members)

**Cons:**
- More code to maintain (CLI handler, reset logic, validation)
- Must decide on confirmation UX (prompt or --force flag)
- Need to handle edge cases (already pending, group drivers, dependencies)

**Implementation complexity:**
- Moderate: ~150-200 LOC for reset command + tests
- Must clear: status, completed_at, commits, model
- Must handle: driver specs with members, dependency validation

#### Option C: Both (Pragmatic)
Manual edit always works because specs are just files. CLI command provides safety and UX.

Users can:
- Use `chant reset <spec-id>` for safe, guided reset
- Manually edit if they understand the consequences
- Documentation explains both approaches and when to use each

### Answers to Specific Questions

**Q: Should reset clear the Agent Output section?**

**A: Yes, with a caveat.** The Agent Output section is appended after finalization (line 1087, main.rs) and documents what the agent actually did. When resetting:
- If resetting to retry immediately: Clear it (old output is stale, new agent run will add new output)
- If user is just investigating: Keep it (helps debug why it failed)

**Recommendation**: Clear by default, offer `--keep-output` flag for users who want to preserve it.

---

**Q: Should reset require confirmation?**

**A: Yes, use `--force` flag pattern matching existing Chant behavior.**

Why:
- Resetting a completed spec is destructive (loses commits, timestamps, model metadata)
- Resetting a failed spec is usually fine (user expects to retry)
- Resetting a pending spec is idempotent (no-op)
- Resetting a driver spec should require explicit confirmation (`--all` flag)

Pattern:
```bash
chant reset <spec-id>              # Succeeds if failed or pending, prompts if completed
chant reset --force <spec-id>      # Reset regardless of status
chant reset --all <spec-id>        # If driver: reset all members too (requires --force if completed)
```

---

**Q: Should there be a `chant retry` that resets and immediately works?**

**A: No, but document `chant work --finalize` as the recovery path.**

Why:
- `chant retry` adds semantic overlap (retry vs reset vs work)
- Users expect `retry` to auto-fix transient failures (Airflow pattern), but Chant specs are often modified manually between attempts
- `chant work --finalize` already re-runs finalization and updates timestamps

Better approach:
1. Reset via `chant reset <spec-id>`
2. Work via `chant work <spec-id>`

Or for idempotent completion:
```bash
chant work --finalize <spec-id>    # (already exists) Skips worktree/MCP, just re-finalizes
```

---

**Q: What about resetting a group driver - reset all members too?**

**A: No by default, require explicit `--all` flag.**

Why:
- Member specs might be individually completed and shouldn't be reset without user awareness
- Driver auto-completes when all members complete (idempotent)
- Member specs are independent; resetting driver doesn't logically require resetting members

Pattern:
```bash
chant reset 2026-01-24-01y-73b         # Error: "This is a driver spec with members. Use --all to reset all."
chant reset --all 2026-01-24-01y-73b   # Resets driver + all members (e.g., .1, .2, .3, ...)
```

### Recommendation: Implement Option C (Both)

**Immediate (No code changes):**
- Document Option A in README/docs
- Users can manually edit spec files to reset status
- Provide warnings about clearing related fields

**Future (Medium priority):**
- Implement `chant reset <spec-id>` command
- Use `--force` for confirmation on destructive resets
- Handle driver/member relationships with `--all` flag
- Clear Agent Output section by default (`--keep-output` to preserve)

**Rationale:**
- Manual edit is already available and works (Git philosophy)
- CLI command provides safety and better UX
- Both approaches serve different user intentions:
  - Manual edit: Advanced users, understanding consequences
  - CLI command: Safe default, clear semantics, prevents accidents

### Implementation Priority

1. **Document manual reset approach** (1 hour) - README section with warnings
2. **Add `chant reset` command** (3-4 hours) - Safe, auditable reset
3. **Handle group drivers** (1 hour) - Cascade reset with `--all`
4. **Tests** (2 hours) - Verify all edge cases

### Acceptance Criteria

- [x] Research how other systems handle reset
- [x] Analyze current Chant spec lifecycle
- [x] Identify risks for manual vs CLI approaches
- [x] Answer all specific questions
- [x] Recommend clear path forward
- [x] Document findings in spec