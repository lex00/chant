---
type: code
status: pending
target_files:
- src/main.rs
---
# Ensure agent output transcript is committed after spec completion

## Problem

After a spec completes, chant:
1. Creates a commit with the spec changes
2. Appends the "Agent Output" transcript to the spec file

The transcript is appended AFTER the commit, leaving uncommitted changes in the spec file.

## Current Flow

```
1. Agent works on spec
2. finalize_spec() creates commit with spec status=completed
3. Agent output transcript appended to spec file  <-- NOT COMMITTED
4. User left with dirty working tree
```

## Proposed Solution

Add a second commit after the transcript is appended:

```
1. Agent works on spec
2. finalize_spec() creates commit with spec status=completed
3. Agent output transcript appended to spec file
4. Create follow-up commit: "chant: Record agent transcript for {spec-id}"
```

Alternatively, delay the main commit until after transcript is written.

## Acceptance Criteria

- [ ] After spec completion, working tree should be clean (no uncommitted spec changes)
- [ ] Agent output transcript should be included in commits
- [ ] Either append transcript before main commit, or create follow-up commit
- [ ] Works for both sequential and parallel execution
- [ ] All tests pass
