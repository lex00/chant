---
type: code
status: completed
target_files:
- src/main.rs
completed_at: 2026-01-25T15:30:00Z
model: claude-haiku-4-5-20251001
commits:
  - 2026-01-25-001-xud
---
# Ensure agent output transcript is committed after spec completion

## Problem

After a spec completes, chant:
1. Creates a commit with the spec changes
2. Appends the "Agent Output" transcript to the spec file

The transcript is appended AFTER the commit, leaving uncommitted changes in the spec file.

## Current Flow

```
1. Agent works on spec
2. finalize_spec() creates commit with spec status=completed
3. Agent output transcript appended to spec file  <-- NOT COMMITTED
4. User left with dirty working tree
```

## Proposed Solution

Add a second commit after the transcript is appended:

```
1. Agent works on spec
2. finalize_spec() creates commit with spec status=completed
3. Agent output transcript appended to spec file
4. Create follow-up commit: "chant: Record agent transcript for {spec-id}"
```

Alternatively, delay the main commit until after transcript is written.

## Acceptance Criteria

- [x] After spec completion, working tree should be clean (no uncommitted spec changes)
- [x] Agent output transcript should be included in commits
- [x] Either append transcript before main commit, or create follow-up commit
- [x] Works for both sequential and parallel execution
- [x] All tests pass