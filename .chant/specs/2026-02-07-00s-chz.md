---
type: code
status: blocked
depends_on:
- 2026-02-07-00p-q5s
labels:
- tests
- migration
target_files:
- tests/integration/config_test.rs
- tests/support/harness.rs
- tests/support/factory.rs
---
# Migrate config_test.rs to TestHarness/SpecFactory

## Context

`tests/integration/config_test.rs` (1,164 LOC, 14+ tests) tests enterprise config: required fields, env-based derivation, path-based derivation, regex validation. Currently uses `common.rs` for setup, manual git init, and hand-written config YAML.

After specs 00o and 00p, `TestHarness` has `with_config()`, `git_commit()`, `branch_exists()`, `run()`. `SpecFactory` has `as_markdown()`, `as_markdown_with_approval()`, `as_markdown_with_deps()`.

## Task

1. Replace `mod common { pub use crate::common::*; }` and `common::setup_test_repo()` / `common::cleanup_test_repo()` with `TestHarness::new()` or `TestHarness::with_config()`
2. Replace local `run_chant()` / `get_chant_binary()` with `harness.run()`
3. Replace hand-written spec YAML with SpecFactory methods
4. Replace manual `/tmp` paths with harness-managed paths
5. Remove manual `set_current_dir` + cleanup patterns (TestHarness auto-cleans via TempDir)
6. If enterprise config setup is needed repeatedly, add a `TestHarness::with_enterprise_config()` or helper method

**Important**: Do NOT modify other test files in this spec. Only touch config_test.rs and support/ files.

## Acceptance Criteria

- [ ] `integration/config_test.rs` uses TestHarness (no `common::` references)
- [ ] No hand-written spec YAML strings (use SpecFactory)
- [ ] No manual `/tmp` paths
- [ ] All config_test tests pass
- [ ] `cargo clippy` passes on the test file