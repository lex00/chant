---
type: code
status: completed
labels:
- bug
- ux
target_files:
- src/cmd/work.rs
commits:
- 0b5191b
completed_at: 2026-01-30T15:20:46Z
model: opus
---
# Reject multiple spec IDs without --chain or --parallel flag

## Problem

When a user runs `chant work spec1 spec2` without `--chain` or `--parallel`, the command silently takes only the first ID and ignores the rest. This is confusing - the user expects both specs to be worked.

Current behavior in `src/cmd/work.rs:344-346`:
```rust
} else {
    (ids[0].clone(), None, false)
};
```

## Solution

Add validation before line 316 to reject multiple IDs without the appropriate flag, with a helpful error message explaining how to use `--chain` or `--parallel`.

```rust
// Reject multiple IDs without --chain or --parallel
if ids.len() > 1 {
    anyhow::bail!(
        "Multiple spec IDs provided without --chain or --parallel.\n\
         Use --chain to execute specs sequentially: chant work --chain {} {}\n\
         Use --parallel to execute specs concurrently: chant work --parallel {} {}",
        ids[0], ids[1], ids[0], ids[1]
    );
}
```

## Acceptance Criteria

- [x] Add validation in `cmd_work()` to check `ids.len() > 1` when not in chain/parallel mode
- [x] Error message includes example usage for both `--chain` and `--parallel`
- [x] Error uses the actual spec IDs the user provided in the examples
- [x] Single ID still works as before (no regression)
- [x] All tests pass

## Agent Output

2026-01-30T15:20:46Z

```
I'll implement this spec to reject multiple spec IDs without `--chain` or `--parallel` flag. Let me start by reading the relevant code.
I can see the relevant code. The validation should be added before line 316, right after the chain mode check and before the wizard/ID handling. Let me also check where `parallel` mode is handled to understand the full picture.
Now I understand the flow:
1. If `parallel` flag is set, handle parallel mode (line 286-298)
2. If `chain` flag is set, handle chain mode (line 301-313)
3. Otherwise, handle single spec mode (line 316+)

The validation for multiple IDs should be added right after the chain check (after line 313) and before the single-spec handling begins (line 316). Let me implement this change.
Now let me run the formatting and linting tools, then run the tests.
Let me check the end of the test output to ensure all tests passed.
All tests pass. Now let me verify the implementation works by testing it manually.
The error message works correctly and includes the example usage with the actual spec IDs provided. Let me also verify that single ID still works.
Single ID passes validation and fails at the spec lookup stage as expected (no regression). Now let me update the spec file to check off the acceptance criteria.
Now I need to add the model to the frontmatter since all acceptance criteria are met.
Now let me commit the changes.
I see there are other modified spec files. Let me only commit the files related to this spec.
The changes for this spec are committed. The other modified spec files are unrelated to this spec.

## Summary

I successfully implemented the validation to reject multiple spec IDs without `--chain` or `--parallel` flag:

**Changes made to `src/cmd/work.rs`:**
- Added validation after the chain mode check (line 315) that checks if `ids.len() > 1`
- When multiple IDs are provided without `--chain` or `--parallel`, returns a helpful error message with example usage showing both options with the actual spec IDs the user provided

**Verification:**
- `cargo fmt` - passed
- `cargo clippy` - passed  
- `just test` - all 326 unit tests + 65 integration tests passed
- Manual test of `chant work spec1 spec2` shows the helpful error message
- Manual test of single ID still works (no regression)```
