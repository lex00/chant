---
type: code
status: pending
target_files:
  - tests/integration_tests.rs
---

# Add integration test for git_user derivation

## Problem

Git user derivation has no integration test verifying git config user.name and user.email are extracted during `chant add`.

**Gap:** Need to verify git commands are executed correctly and values populated.

## Solution

Add integration test that:
1. Creates test git repository with git config set
2. Sets up enterprise config with git_user derivation
3. Runs `chant add` and verifies author name/email derived from git config

## Test Implementation

```rust
#[test]
fn test_git_user_derivation_end_to_end() {
    let temp_dir = "/tmp/chant-test-git-user-deriv";
    setup_test_repo(temp_dir);

    // Set git user config
    Command::new("git")
        .args(["config", "user.name", "Alice Smith"])
        .current_dir(temp_dir)
        .output()
        .expect("Failed to set git user.name");

    Command::new("git")
        .args(["config", "user.email", "alice@example.com"])
        .current_dir(temp_dir)
        .output()
        .expect("Failed to set git user.email");

    // Create enterprise config
    let config = r#"
enterprise:
  derived:
    author_name:
      from: git_user
      pattern: "name"
    author_email:
      from: git_user
      pattern: "email"
"#;
    write_config(temp_dir, config);

    // Run chant add
    let output = Command::new(env!("CARGO_BIN_EXE_chant"))
        .args(["add", "Test spec"])
        .current_dir(temp_dir)
        .output()
        .expect("Failed to run chant add");

    assert!(output.status.success());

    // Verify derived fields
    let spec_content = read_latest_spec(temp_dir);
    assert!(spec_content.contains("author_name: Alice Smith"));
    assert!(spec_content.contains("author_email: alice@example.com"));
    assert!(spec_content.contains("derived_fields:\n  - author_name\n  - author_email"));
}
```

## Acceptance Criteria

- [ ] Add test to tests/integration_tests.rs
- [ ] Test sets git config user.name and user.email
- [ ] Test sets up enterprise config with git_user derivation
- [ ] Test uses literal "name" and "email" patterns (not regex)
- [ ] Test runs `chant add` command
- [ ] Test verifies spec contains values from git config
- [ ] Test verifies derived_fields tracking
- [ ] Test passes: `cargo test test_git_user_derivation_end_to_end`
- [ ] Cleanup temp directory after test