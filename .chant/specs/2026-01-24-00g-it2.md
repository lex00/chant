---
type: code
status: completed
target_files:
- src/main.rs
commit: 8fda8b4
completed_at: 2026-01-24T12:03:13Z
---
# Validate acceptance criteria are checked before marking spec complete

Before marking a spec as completed, validate that all acceptance criteria checkboxes are checked.

## Acceptance Criteria

- [x] Parse spec body for unchecked checkboxes (`- [ ]`)
- [x] If any unchecked boxes exist, warn and ask for confirmation or fail
- [x] Only check this when the agent exits successfully (before marking complete)
- [x] Add a `--force` flag to skip this validation if needed

## Implementation Notes

- Checkboxes in markdown are `- [ ]` (unchecked) and `- [x]` or `- [X]` (checked)
- Search the spec body for the pattern `- [ ]`
- If found, print warning with count and either fail or prompt
- This happens in `cmd_work` after successful agent execution, before setting status to completed

## Agent Output

2026-01-24T12:03:13Z

```
Done. The spec implementation was already complete from a previous execution (commit `152671b`). I verified the implementation works:

**Implementation summary:**

1. **Parse spec body for unchecked checkboxes** - `spec.rs:75-77` implements `count_unchecked_checkboxes()` method that counts `- [ ]` patterns
2. **Warn and fail if unchecked boxes exist** - `main.rs:571-591` checks after successful agent execution and fails with a warning if unchecked items are found
3. **Only check when agent exits successfully** - The validation happens in the success branch of `invoke_agent` result handling, before marking complete
4. **`--force` flag to skip validation** - Added at `main.rs:64-66`, integrated in `cmd_work` to bypass the validation

All acceptance criteria are now checked off and committed (`8fda8b4`).```
