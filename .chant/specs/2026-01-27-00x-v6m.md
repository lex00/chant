---
type: code
status: completed
target_files:
- src/cmd/lifecycle.rs
- src/main.rs
completed_at: 2026-01-27T23:23:19Z
model: opus
---
# Add chant merge --all-completed convenience flag

## Problem

**User Request:** "Would a `chant merge --all-completed` command be useful? Yes, very useful!"

After `chant work --parallel` completes multiple specs, users must manually list all spec IDs to merge them:

**Current workflow:**
```bash
$ chant work spec1 spec2 --parallel
✓ 2 specs completed work

$ chant merge spec1 spec2 --yes --delete-branch
# Manual: Have to type both spec IDs
```

**Desired workflow:**
```bash
$ chant work spec1 spec2 --parallel
✓ 2 specs completed work

$ chant merge --all-completed --yes --delete-branch
# Automatic: Merges all completed specs from parallel batch
```

**User Rationale:**
- "Would eliminate the need to list spec IDs manually"
- "Especially helpful after parallel execution where you know all completed successfully"
- Batch completion → merge all → start next batch feels cleaner
- Typical batch size: 2 specs

## Solution

Add `--all-completed` flag to `chant merge` command:

1. Find all specs with `status: completed`
2. Filter to only those with branches (chant/spec-id exists)
3. Merge each in dependency order (if any)
4. Support existing flags: `--yes`, `--delete-branch`, `--no-ff`

**Implementation:**

```rust
// In src/cmd/lifecycle.rs
pub fn cmd_merge(
    spec_ids: Vec<String>,
    all_completed: bool,
    yes: bool,
    delete_branch: bool,
    no_ff: bool,
) -> Result<()> {
    let specs_to_merge = if all_completed {
        find_completed_specs_with_branches()?
    } else {
        spec_ids.iter().map(|id| resolve_spec(id)).collect::<Result<Vec<_>>>()?
    };

    for spec in specs_to_merge {
        merge_spec_branch(&spec, no_ff)?;
        if delete_branch {
            delete_spec_branch(&spec)?;
        }
    }

    Ok(())
}

fn find_completed_specs_with_branches() -> Result<Vec<Spec>> {
    let all_specs = load_all_specs()?;
    let completed: Vec<Spec> = all_specs
        .into_iter()
        .filter(|s| s.status == SpecStatus::Completed)
        .filter(|s| branch_exists(&format!("chant/{}", s.id)))
        .collect();

    Ok(completed)
}
```

## Acceptance Criteria

- [ ] Add `--all-completed` flag to merge command CLI
- [ ] Implement find_completed_specs_with_branches() function
- [ ] Filter completed specs to only those with branches
- [ ] Support combining with `--yes`, `--delete-branch`, `--no-ff`
- [ ] Error if `--all-completed` used with explicit spec IDs
- [ ] Print which specs are being merged
- [ ] Add integration test: parallel work -> merge --all-completed
- [ ] Update docs: `chant merge --help`
- [ ] All existing tests pass