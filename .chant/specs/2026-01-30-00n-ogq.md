---
type: code
status: completed
labels:
- refactor
- cleanup
target_files:
- src/spec_group.rs
commits:
- 0c67010
completed_at: 2026-01-30T15:18:21Z
model: opus
---
# Cleanup debug output and audit dead code

## Problem

1. Debug `eprintln!` statements in `src/spec_group.rs` should be removed or converted to proper logging
2. 24+ `#[allow(dead_code)]` suppressions across the codebase need auditing

## Solution

1. Remove all debug `eprintln!("[DEBUG]` statements from `spec_group.rs`
2. Audit each `#[allow(dead_code)]` suppression:
   - If the code is actually unused, remove it
   - If the code is used, remove the suppression
   - If kept for future use, add a comment explaining why

## Acceptance Criteria

- [x] Remove all `eprintln!("[DEBUG]` statements from `spec_group.rs`
- [x] Audit each `#[allow(dead_code)]` - remove unused code or remove suppression if actually used
- [x] Document any dead code kept intentionally (for future use)
- [x] All tests pass
- [x] No new clippy warnings

## Changes Made

### Debug output removed:
- Removed all `eprintln!("[DEBUG]` statements from `src/spec_group.rs` (in `mark_driver_in_progress` and `auto_complete_driver_if_ready`)

### Dead code suppressions removed (code is actually used):
- `src/config.rs:256` - `prefix` field (used in `load_merged_from`)
- `src/config.rs:275` - `main_branch` field (used in merge.rs, lifecycle.rs)
- `src/git.rs:445` - `format_merge_summary()` (used in cmd/lifecycle.rs)
- `src/worktree.rs:180` - `success` field (used in cmd/work.rs)
- `src/spec.rs:692` - `apply_blocked_status_with_repos()` (called by `apply_blocked_status`)
- `src/cmd/work.rs:1440` - `ParallelResult` struct (extensively used)
- `src/cmd/work.rs:2520,2526` - `pitfall_type` and `PitfallType` (used in tests)
- `src/cmd/verify.rs:44` - `SpecVerificationResult` struct (used internally)

### Unused code removed:
- `src/cmd/git_ops.rs:44` - `push_branch()` function
- `src/cmd/finalize.rs:316` - `replay_finalize_spec()` function
- `src/cmd/agent.rs:112` - `invoke_agent_with_prefix()` function (superseded by `invoke_agent_with_command`)
- `tests/integration_tests.rs:63` - `create_spec_file()` test helper

### Dead code kept with documentation (for future use):
- `src/templates.rs:41` - `supports_mcp()` - Used in tests
- `src/provider.rs:84` - `fn name()` - Trait method used in tests
- `src/diagnose.rs:61,66` - `all_passed()`, `failed_checks()` - Public API for tests
- `src/agent.rs:68` - `role` field - Required for serde deserialization
- `src/merge.rs:87` - `validate_spec_can_merge()` - Public API used in tests
- `src/cmd/activity.rs:52` - `commit` field - For deduplication/debugging
- `src/cmd/commits.rs:737` - `commit_hash` field - For debugging/future tooling
- `src/cmd/commits.rs:819,851` - Agent detection functions - For future approval workflow
- `src/cmd/verify.rs:45-48` - `spec_id`, `spec_title`, `total_criteria` fields - For future detailed output
- `src/cmd/work.rs:2519` - `pitfall_type` field - Used in tests
- `src/cmd/work.rs:2528` - `UncommittedChanges` variant - Reserved for future detection
- `tests/integration_tests.rs` - Conflict resolution test helpers - For future tests

## Agent Output

2026-01-30T15:18:21Z

```
Let me start by reading the relevant files to understand the current state.
I see the debug statements in `spec_group.rs`. Let me read the full grep output to understand all the `#[allow(dead_code)]` locations.
Now I have a clear picture. Let me read the relevant source files to check if the dead code is actually used or not. Let me start by removing the debug statements from `spec_group.rs` and then audit each `#[allow(dead_code)]` suppression.

First, let me remove the debug statements from `spec_group.rs`:
Now let me audit each `#[allow(dead_code)]` suppression. I need to check each file to determine if the code is actually used or not.
Let me continue checking more usages:
Now let me read some of the files to understand the context better and determine what to do with each dead code suppression:
Let me check the remaining files:
Now let me check the spec.rs, git_ops.rs, merge.rs and agent.rs files:
Now I have a clear picture. Based on my analysis, here's the summary of all `#[allow(dead_code)]` suppressions:

1. **`src/templates.rs:41` - `supports_mcp()`** - Used in tests only. Comment says it's for docs/tests. Keep with documentation.

2. **`src/provider.rs:84` - `fn name()`** - Trait method used in tests. Keep - part of the trait API.

3. **`src/diagnose.rs:61,66` - `all_passed()` and `failed_checks()`** - Used only in tests. These are useful public API methods. Keep with docs.

4. **`src/config.rs:256` - `prefix` field** - Used in `load_merged_from()` at line 494. Remove the suppression!

5. **`src/config.rs:275` - `main_branch` field** - Used extensively in merge.rs, lifecycle.rs, etc. Remove the suppression!

6. **`src/git.rs:445` - `format_merge_summary()`** - Used in cmd/lifecycle.rs:1541. Remove the suppression!

7. **`src/worktree.rs:180` - `success` field** - Used in tests and in cmd/work.rs. Remove the suppression!

8. **`src/spec.rs:692` - `apply_blocked_status_with_repos()`** - Called by `apply_blocked_status()` at line 687. Remove the suppression!

9. **`src/agent.rs:68` - `role` field** - Part of deserialization, the field is populated but not read. Keep for serde completeness.

10. **`src/merge.rs:87` - `validate_spec_can_merge()`** - Used only in tests. Keep for API completeness.

11. **`tests/integration_tests.rs:63` - `create_spec_file()`** - Test helper function, not used. Remove it entirely.

12. **`src/cmd/work.rs:1440` - `ParallelResult` struct** - Actually used extensively. Remove the suppression!

13. **`src/cmd/work.rs:2520` - `pitfall_type` field** - Used in tests and detection code. Remove the suppression!

14. **`src/cmd/work.rs:2526` - `PitfallType` enum** - Used extensively. Remove the suppression!

15. **`src/cmd/git_ops.rs:44` - `push_branch()`** - Not used anywhere. Remove the function.

16. **`src/cmd/finalize.rs:316` - `replay_finalize_spec()`** - Not used anywhere. Remove the function.

17. **`src/cmd/activity.rs:52` - `commit` field** - Part of the `Activity` struct, not currently read but useful for deduplication. Keep with docs.

18. **`src/cmd/commits.rs:737` - `commit_hash` field** - Part of public API, useful for debugging. Keep with docs.

19. **`src/cmd/commits.rs:819,851` - `detect_agents_in_spec_commits()` and `has_agent_coauthorship()`** - Not used, but designed for future approval workflow. Keep with docs.

20. **`src/cmd/verify.rs:44` - `SpecVerificationResult` struct** - Used internally in verify.rs. Remove the suppression!

21. **`src/cmd/agent.rs:112` - `invoke_agent_with_prefix()`** - Not used (superseded by `invoke_agent_with_command`). Remove the function.

Let me now make the changes:
Now let me remove unused functions. First, let me read and remove `push_branch` from git_ops.rs:
Now let me remove `replay_finalize_spec` from finalize.rs:
Now let me remove `invoke_agent_with_prefix` from cmd/agent.rs:
Now let me remove `create_spec_file` from integration_tests.rs:
Now let me add documentation comments for the remaining intentionally kept dead code. Let me update the files:
The `supports_mcp` function already has a comment explaining why it's kept. Let me update a few more with better documentation:
Now let me run cargo fmt, clippy, and tests:
I see there are still a few dead code warnings. Let me check them and add proper suppressions:
The `SpecVerificationResult` struct fields are never read but the struct itself is used. Let me check the usages:
The struct fields are populated but only `passed` is read. I need to add `#[allow(dead_code)]` to the unused fields or suppress at struct level:
Now let me handle the `pitfall_type` and `UncommittedChanges` warnings:
The `pitfall_type` is set but never read, and `UncommittedChanges` variant is never constructed. These are part of a diagnostic system that's partially implemented. Let me add proper documentation:
Now let me run clippy again:
No warnings. Now let me run the tests:
All tests pass. There are some warnings about unused test helper functions in integration_tests.rs, but those are minor. Let me a

... (output truncated, 7082 chars total)```
