---
type: code
status: in_progress
target_files:
- src/templates.rs
- src/main.rs
---
# Fix Windows CI test failures - trailing newline mismatch in template injection tests

## Problem

Windows CI is failing with 2 tests after the 4al template simplification:
- `templates::tests::test_inject_chant_section_idempotent`
- `tests::test_init_force_reinstalls_agents`

The issue is trailing newline mismatch:
- Expected: `<!-- chant:end -->\r\n`
- Actual: `<!-- chant:end -->\r\n\r\n` (extra blank line)

## Root Cause

The simplified template in `templates/chant-section-mcp.md` likely has different trailing newlines that manifest differently on Windows vs Unix.

## Acceptance Criteria

- [x] Identify the trailing newline issue in template files or injection logic
- [x] Fix the newline handling to be consistent across platforms
- [x] Ensure `test_inject_chant_section_idempotent` passes on Windows
- [x] Ensure `test_init_force_reinstalls_agents` passes on Windows
- [x] Verify tests still pass on Unix (macOS/Linux)