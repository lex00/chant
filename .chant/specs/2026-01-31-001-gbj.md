---
type: code
status: completed
commits:
- a063cd1
completed_at: 2026-01-31T08:59:17Z
model: sonnet
---
# Simplify target_files mismatch warning - make it concise and less alarming

## Problem

The current warning is overwhelming and confusing:
- Too verbose (20+ lines)
- Lists 5 possible causes when usually it's just "agent predicted wrong files"
- The breakdown of "with changes" vs "no changes" is hard to parse

## Solution

Make it a simple 2-3 line warning:

```
Note: Spec 41u predicted changes to src/cmd/work.rs but actual changes were in src/spec.rs
      (This is normal - agent predictions aren't always accurate)
```

Or for multiple files:
```
Note: Spec 2mk predicted [src/main.rs] but changed [src/templates.rs]
      (Prediction mismatch - implementation is fine)
```

## Acceptance Criteria

- [x] Warning is 3 lines or less
- [x] Uses "Note:" instead of "Warning:" (less alarming)
- [x] Shows predicted vs actual files concisely
- [x] Includes brief reassurance that this is normal
- [x] Remove the long "This may indicate" list

## Agent Output

2026-01-31T08:59:17Z

```
I'll implement the spec to simplify the target_files mismatch warning. Let me start by creating a todo list and then reading the relevant code.
Let me search for where this warning is implemented.
Let me search for the specific warning text about target_files.
Let me search more broadly for where this warning is generated.
Perfect! I found the warning function at line 704. Let me read that specific function more carefully.
Good! I found the function at src/cmd/lifecycle.rs:704. Now let me simplify it according to the spec. The current warning is very verbose, and I need to make it concise (2-3 lines) with a "Note:" prefix instead of "Warning:".
Now I need to update the tests to match the new simplified format. Let me check the test that uses this function.
Now let me look at the other test:
Now I need to update both tests to match the new simplified format. Let me update the first test:
Now update the second test:
Now let me run cargo fmt:
Now let me run cargo clippy:
I see! The `files_with_changes` field is no longer used in my simplified implementation. Let me check if it's used elsewhere or if I should remove it from the struct:
The field is still being populated in the `verify_target_files` function and used in tests. It's just not used in my new warning formatter. However, I should keep the field because it's part of the verification structure and might be useful for other purposes. Let me update my implementation to use it so we don't break the API:
I need to use the `files_with_changes` field to avoid the dead code warning. Let me update the implementation to include files that were correctly predicted:
Now let me run clippy again:
Now let me run the tests:
Let me check if all tests passed:
Good! All tests passed. Let me update the todo and then update the acceptance criteria in the spec file:
Now let me update all the acceptance criteria to be checked:
Now let me commit the changes:
Perfect! I've successfully completed the spec. Here's a summary of what was done:

## Summary

I've simplified the target_files mismatch warning in `src/cmd/lifecycle.rs:704-725` to make it concise and less alarming.

### Changes Made

1. **Reduced the warning from 20+ lines to 2 lines**:
   - Old format had multiple sections listing files with/without changes, net additions, and 5 possible causes
   - New format is a simple one-liner with explanation

2. **Changed tone from "Warning:" to "Note:"** to be less alarming

3. **Concise format**: Shows predicted vs actual files in brackets
   ```
   Note: Spec {id} predicted [{predicted_files}] but changed [{actual_files}]
         (Prediction mismatch - implementation is fine)
   ```

4. **Removed the long "This may indicate" list** with 5 possible causes and the "To fix" suggestion

5. **Updated tests** to match the new simplified format

### All Acceptance Criteria Met

- [x] Warning is 3 lines or less (now 2 lines)
- [x] Uses "Note:" instead of "Warning:"
- [x] Shows predicted vs actual files concisely
- [x] Includes brief reassurance that this is normal
- [x] Removed the long "This may indicate" list

The implementation passed all tests (`cargo fmt`, `cargo clippy`, `just test`) and has been committed with message `chant(2026-01-31-001-gbj): Simplify target_files mismatch warning to be concise and less alarming`.```
