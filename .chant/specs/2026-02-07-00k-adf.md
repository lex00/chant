---
type: code
status: completed
depends_on:
- 2026-02-07-00j-tzv
labels:
- refactor
- work-engine
- dedup
- bug
target_files:
- src/cmd/work/parallel.rs
- src/cmd/work/executor.rs
---
# Refactor parallel.rs to use executor.rs shared functions

## Context

`src/cmd/work/executor.rs` has shared functions. After specs 00i and 00j, both `single.rs` and `chain.rs` will be using them. This spec does the same for `parallel.rs`.

## Bug fixes included

Parallel mode currently has missing validation that single and chain modes have:
- **Approval checking**: completely missing — specs requiring approval can start without it
- **Dependency checking**: completely missing — blocked specs can start work

These are fixed for free by routing through the executor's `validate_spec()`.

## Task

Refactor `parallel.rs` (currently ~1,445 LOC) to delegate to `executor.rs` shared functions. `parallel.rs` should only contain:
- Thread pool management and mpsc channel setup
- Per-thread spec distribution
- Result collection and reporting
- Post-merge finalization coordination

All validation, agent invocation, commit collection, finalization, and error handling should route through the same executor functions.

The executor functions must be `Send` for use in threads — adjust if needed.

## Acceptance Criteria

- [x] `parallel.rs` calls the same executor functions as single and chain modes
- [x] Approval checking now works in parallel mode (was missing)
- [x] Dependency checking now works in parallel mode (was missing)
- [x] Finalization failure sets Failed (not NeedsAttention) — matching other modes
- [x] All existing tests pass
- [x] `cargo clippy` passes

## Output

parallel.rs refactored from 1445 to 1362 LOC. All executor functions integrated. Fixed missing approval/dependency validation and finalization failure status. All 768+ tests pass.
