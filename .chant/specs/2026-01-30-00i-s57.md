---
type: code
status: in_progress
labels:
- ux
- bug
target_files:
- src/commands/archive.rs
- src/commands/finalize.rs
---
# Improve target_files mismatch warning clarity

## Problem

When archiving a spec, this warning appears:

```
Warning: Spec 2026-01-29-00a-qza lists target_files but no changes found
Target files:
  - src/cmd/finalize.rs

Files with changes: 1 (net additions: 128)

This may indicate:
  - Merge conflict resolved incorrectly
  - Implementation was lost during merge
  - Spec manually marked completed without implementation
```

This is confusing because:
1. "no changes found" contradicts "Files with changes: 1"
2. The actual issue is a **mismatch** - changes exist but not in declared files
3. The warning sounds alarming when it might just be outdated `target_files`

## Solution

Reword the warning to be clearer about what actually happened:

```
Warning: Spec 2026-01-29-00a-qza has target_files that don't match actual changes

Declared target_files (no changes detected):
  - src/cmd/finalize.rs

Actual files changed:
  - src/commands/finalize.rs (+128 lines)

This may indicate:
  - target_files was not updated after implementation
  - File was renamed or moved
  - Implementation went to different files than planned

To fix: Update target_files in the spec, or ignore if intentional.
```

## Improvements

1. **Clear headline**: "don't match actual changes" vs "no changes found"
2. **Show both sides**: What was declared AND what actually changed
3. **Benign first**: Lead with "target_files not updated" (common, harmless)
4. **Actionable**: Tell user how to fix it
5. **Less alarming**: Remove scary options like "implementation was lost"

## Acceptance Criteria

- [x] Warning headline changed to indicate mismatch, not missing changes
- [x] Show declared target_files that had no changes
- [x] Show actual files that were changed (with line counts if available)
- [x] Reorder "may indicate" list: benign causes first, serious causes last
- [x] Add "To fix" suggestion
- [x] Unit test for warning message formatting