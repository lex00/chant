---
type: code
status: completed
target_files:
- .github/workflows/release.yml
commits:
- 48ad911
completed_at: 2026-01-26T00:03:36Z
model: haiku
---
# Fix homebrew formula install method

## Problem

The homebrew formula template in `.github/workflows/release.yml` has a broken `install` method:

```ruby
def install
  bin.install "chant-#{os.kernel_name.downcase}-#{hardware.platform_cpu}" => "chant"
end
```

The variable `os` doesn't exist in Homebrew formula context, causing:
```
NameError: undefined local variable or method 'os'
```

## Solution

Since each platform downloads only one binary file, use glob to find it:

```ruby
def install
  bin.install Dir["chant-*"].first => "chant"
end
```

## Acceptance Criteria

- [x] Formula install method fixed in release.yml
- [x] Code linted

## Agent Output

2026-01-26T00:03:36Z

```
I'll help you fix the homebrew formula install method. Let me start by reading the relevant file and understanding the current implementation.
Now let me read the spec file to check the acceptance criteria:
Perfect! I can see the issue. The current install method on line 139 uses `os.kernel_name.downcase` and `hardware.platform_cpu` which don't exist in the Homebrew formula context. I need to replace it with the glob-based approach. Let me fix this:
Now let me verify the change was applied correctly:
Excellent! The fix is applied. Now let me check if there's any linting to do. Since this is a YAML file with embedded Ruby, I should verify it's properly formatted. Let me run the linting command:
Great! The linting passed. Now let me run the full test suite to ensure everything is working:
Perfect! All tests pass. Now let me update the spec file to mark the acceptance criteria as complete:
Now let me add the model field to the frontmatter since all acceptance criteria are complete:
Now let me commit the work:
Perfect! Let me verify the final state:
Excellent! Let me verify the fix one more time by reviewing the changes:
Perfect! The spec has been completed successfully. Here's a summary of what was done:

## Summary

✅ **Fixed homebrew formula install method** (spec: 2026-01-26-001-qus)

### Changes Made
1. **Updated `.github/workflows/release.yml`** (line 139)
   - Replaced the broken install method that used undefined `os` and `hardware` variables
   - Changed from: `bin.install "chant-#{os.kernel_name.downcase}-#{hardware.platform_cpu}" => "chant"`
   - Changed to: `bin.install Dir["chant-*"].first => "chant"`

### Verification
✅ All acceptance criteria met:
- [x] Formula install method fixed in release.yml
- [x] Code linted

✅ All 259 tests passing
✅ Git status clean
✅ Spec marked as completed with model attribution

The new glob-based approach is more reliable since each platform downloads only one binary file, eliminating the `NameError` that occurred with undefined variables in the Homebrew formula context.```
