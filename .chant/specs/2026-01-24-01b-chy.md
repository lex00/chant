---
type: code
status: completed
target_files:
- src/spec.rs
- src/main.rs
- src/mcp.rs
- .chant/specs/*.md
commits:
  - 0b67e50
completed_at: 2026-01-24T16:47:00Z
model: claude-haiku-4-5-20251001
---
# Replace commit field with commits list to support multiple commits

In direct commit mode, an agent may create multiple commits. Currently `commit: Option<String>` only stores one hash. Replace with `commits: Option<Vec<String>>` to support multiple commits.

- **Direct mode**: All commits matching `chant(spec_id)` pattern
- **Branch mode**: Just the merge commit (single-entry list)

## Acceptance Criteria

- [x] Change `commit: Option<String>` to `commits: Option<Vec<String>>` in SpecFrontmatter
- [x] Update `get_latest_commit_for_spec()` â†’ `get_commits_for_spec()` to find ALL matching commits
- [x] Update write logic in `cmd_work()` and parallel mode
- [x] Update display in `cmd_show()` to render list
- [x] Update MCP `tool_chant_spec_get()` to return `commits` instead of `commit`
- [x] Migrate all existing specs from `commit: hash` to `commits: [hash]`
- [x] Update tests
- [x] All tests pass

## Implementation

### Schema (src/spec.rs)
```rust
// Change from:
pub commit: Option<String>,
// To:
#[serde(skip_serializing_if = "Option::is_none")]
pub commits: Option<Vec<String>>,
```

### Detection (src/main.rs)
```rust
fn get_commits_for_spec(spec_id: &str) -> Result<Vec<String>> {
    let pattern = format!("chant({})", spec_id);
    // git log --oneline --grep "chant(spec_id)" --reverse
    // Returns ALL matching commits in chronological order
}
```

### Migration
Fix all specs in `.chant/specs/*.md`:
```yaml
# FROM:
commits:
  - abc1234

# TO:
commits:
  - abc1234
```
