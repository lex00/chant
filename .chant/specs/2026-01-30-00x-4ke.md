---
type: code
status: completed
depends_on:
- 2026-01-30-00t-48u
target_files:
- src/cmd/spec/lint.rs
commits:
- ef8849f
completed_at: 2026-01-30T21:16:20Z
model: sonnet
---
# Add unit tests for validate_spec_type: documentation missing tracks, documentation missing target_files, research missing fields, driver empty members, driver with members ok.

## Acceptance Criteria

- [x] Add test for documentation spec missing 'tracks' field
- [x] Add test for documentation spec missing 'target_files' field
- [x] Add test for research spec missing both 'informed_by' and 'origin' fields
- [x] Add test for driver/group spec with empty 'members' array
- [x] Add test for driver/group spec with non-empty 'members' array (should pass)

## Agent Output

2026-01-30T21:16:20Z

```
I'll implement the unit tests for `validate_spec_type` according to the spec. Let me start by reading the relevant code and planning my approach.
Now I can see the code structure. Looking at `validate_spec_type` in lint.rs:516-568, I need to add unit tests for the following cases:
1. Documentation spec missing `tracks`
2. Documentation spec missing `target_files`
3. Research spec missing both `informed_by` and `origin` fields
4. Driver/group spec with empty `members` array
5. Driver/group spec with non-empty `members` array (OK case)

Let me update the todo and implement the tests.
Based on my analysis, I'll add these test cases:

1. **Documentation missing tracks**: Spec with type="documentation" but no `tracks` field
2. **Documentation missing target_files**: Spec with type="documentation" but no `target_files` field  
3. **Research missing fields**: Spec with type="research" but missing both `informed_by` and `origin`
4. **Driver empty members**: Spec with type="driver" and empty `members` array
5. **Driver with members OK**: Spec with type="driver" and non-empty `members` array (should have no warnings)
All tests passed! Now I'll check off the acceptance criteria in the spec file.
Perfect! I have successfully completed all the tasks for this spec. Here's a summary of what was implemented:

## Summary

I added comprehensive unit tests for the `validate_spec_type` function in `src/cmd/spec/lint.rs:516-568`. The tests cover all the requested scenarios:

### Tests Added:

1. **test_validate_spec_type_documentation_missing_tracks** - Tests that documentation specs without a `tracks` field generate a warning
2. **test_validate_spec_type_documentation_missing_target_files** - Tests that documentation specs without a `target_files` field generate a warning
3. **test_validate_spec_type_research_missing_fields** - Tests that research specs missing both `informed_by` and `origin` fields generate a warning
4. **test_validate_spec_type_driver_empty_members** - Tests that driver/group specs with an empty `members` array generate a warning
5. **test_validate_spec_type_driver_with_members_ok** - Tests that driver/group specs with a non-empty `members` array pass validation (no warnings)

All tests:
- Verify the correct `LintRule::Type` is used
- Check for `Severity::Warning` level diagnostics
- Validate that the diagnostic messages contain the expected text
- Ensure the correct number of diagnostics are generated

The implementation passed all existing tests (350 library tests + 262 binary tests + 65 integration tests) as well as the new tests. The code has been formatted with `cargo fmt`, checked with `cargo clippy`, and committed with the proper message format.```
