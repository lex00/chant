---
type: code
status: completed
target_files:
- .github/workflows/release.yml
model: claude-haiku-4-5-20251001
---
# Automate Homebrew tap update in release CI

## Description

Add a job to the release workflow that automatically updates the Homebrew formula in `lex00/homebrew-tap` after all release binaries are uploaded.

## Prerequisites (Manual)

Before this workflow can run, the user must:
1. Create a fine-grained GitHub PAT at https://github.com/settings/tokens?type=beta
   - Name: `homebrew-tap-updater`
   - Repository access: Only `lex00/homebrew-tap`
   - Permissions: Contents â†’ Read and write
2. Add the token as a secret named `HOMEBREW_TAP_TOKEN` at https://github.com/lex00/chant/settings/secrets/actions

## Implementation

Add a new job `update-homebrew` to `.github/workflows/release.yml` that:

1. Runs after all `build-release` jobs complete (`needs: build-release`)
2. Downloads all release assets
3. Computes SHA256 hashes for each binary
4. Clones `lex00/homebrew-tap`
5. Updates `Formula/chant.rb` with new version and SHA256 hashes
6. Commits and pushes the changes

The job should:
- Use `ubuntu-latest`
- Use `HOMEBREW_TAP_TOKEN` secret for authentication
- Extract version from tag (strip `v` prefix)
- Update all three SHA256 values (macos-aarch64, macos-x86_64, linux-x86_64)
- Commit with message "Update chant to vX.Y.Z"

## Acceptance Criteria

- [x] New `update-homebrew` job added to release.yml
- [x] Job depends on all build-release jobs completing
- [x] Job downloads release assets and computes SHA256 hashes
- [x] Job updates Formula/chant.rb with correct version and hashes
- [x] Job commits and pushes to homebrew-tap repo
- [x] Workflow syntax is valid (check with `gh workflow view release.yml`)