---
type: code
status: in_progress
model: claude-opus-4-5-20251101
---
# Rejection action handlers - manual, dependency, group modes

## Problem

When a spec is rejected, what happens next? Different teams have different workflows:
- Some want to manually handle fixes (manual mode)
- Some want to track fix as dependency (dependency mode)
- Some want to convert to driver with fix sub-specs (group mode)

We need configurable rejection handling that supports all three patterns.

## Solution

Add `approval.rejection_action` config option with three modes:

### 1. Manual mode (default)
- Rejection leaves spec in rejected state
- User manually addresses concerns
- Someone eventually approves after discussion

### 2. Dependency mode
- When rejected, prompt to create fix spec
- Original spec becomes blocked, waiting for fix
- Use `depends_on:` frontmatter to link them
- Once fix completes, original can be re-approved

Example workflow:
```bash
$ chant reject 001-cic --by alice --reason "Too broad"
Spec 001-cic rejected.

Create fix spec? (Y/n): y
$ chant add "Split approval into smaller pieces"
Created spec 002-xyz

$ # Automatically updates 001-cic frontmatter:
# depends_on: [002-xyz]
# status: blocked
```

### 3. Group mode (preferred, user's choice)
- When rejected, automatically convert to driver
- Create numbered member specs for fixes
- Original becomes parent, tracks completion
- More structured than dependency mode

Example workflow:
```bash
$ chant reject 001-cic --by alice --reason "Too broad"
Spec 001-cic rejected. Converting to driver...

Created members:
  001-cic-1: Approval frontmatter schema
  001-cic-2: Approve/reject commands
  001-cic-3: Work validation

$ # Updates 001-cic frontmatter:
# type: driver
# members: [001-cic-1, 001-cic-2, 001-cic-3]
```

### Configuration

Add to `.chant/config.md`:
```markdown
## approval

- `rejection_action`: Action to take on rejection (default: manual)
  - `manual` - Leave rejected, user handles it
  - `dependency` - Prompt to create fix spec, original becomes blocked
  - `group` - Convert to driver with numbered members
```

## Acceptance Criteria

- [x] Add `approval.rejection_action` config option to config schema
- [x] Support `manual` mode (default) - no automatic action
- [x] Support `dependency` mode:
  - [x] Prompt to create fix spec after rejection
  - [x] Add `depends_on:` to original spec frontmatter
  - [x] Update original spec status to `blocked`
- [x] Support `group` mode:
  - [x] Convert rejected spec to `type: driver`
  - [x] Create numbered member specs (e.g., 001-cic-1, 001-cic-2)
  - [x] Add `members:` array to driver frontmatter
  - [x] Distribute acceptance criteria across members
- [x] Parse config file to read rejection_action setting
- [x] Update `chant reject` command to trigger configured action
- [x] Handle all three modes correctly
- [x] Update spec validation to support new frontmatter fields
- [x] All tests passing
- [x] Code linted and formatted