---
type: code
status: pending
depends_on:
- 2026-01-26-00f-xhl.2
target_files:
- src/replay.rs
- src/worktree.rs
- src/spec.rs
---
# Implement core replay execution flow

Implement the main replay logic that resets spec status to `in_progress`, executes via the normal work flow in a worktree, and handles success/failure outcomes. This reuses existing work flow infrastructure but with replay-specific handling.

### Acceptance Criteria

- [ ] Resets spec status to `in_progress` before execution
- [ ] Executes spec via existing work flow (reuse work command logic)
- [ ] On success, updates status back to `completed`
- [ ] On failure, keeps status as `in_progress` or sets to `failed`
- [ ] Passes through `--branch` and `--pr` options to work flow

### Edge Cases

- Work flow fails mid-execution: Should preserve partial state and allow resume
- Spec has target_files that no longer exist: Agent should handle as part of replay
- Concurrent replay attempts: Should prevent via worktree locking
- User cancels during execution: Should clean up worktree and reset status

### Example Test Cases

For this feature, verify:
- Successful replay returns spec to `completed` status
- Failed replay leaves spec in `in_progress` for resume
- `--branch` creates feature branch for replay work
- Work flow isolation via worktree functions correctly