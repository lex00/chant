---
type: code
status: completed
target_files:
- src/main.rs
commit: 5be2be3
completed_at: 2026-01-24T11:13:01Z
---
# Ensure git hash is in frontmatter after completion

The commit hash should always be recorded in the spec frontmatter after completion.

## Acceptance Criteria

- [x] After agent completion, get the commit hash from git log
- [x] The `get_latest_commit_for_spec` function should work reliably
- [x] If no commit found with spec ID pattern, try getting HEAD commit
- [x] Log warning if no commit can be found

## Implementation Notes

- Current implementation looks for `chant(spec-id)` in commit messages
- Fallback: if not found, check if HEAD commit was made after work started
- Store the short hash (7 chars) in `spec.frontmatter.commit`

## Agent Output

2026-01-24T11:13:01Z

```
Done! I've implemented the spec for ensuring git hash is in frontmatter after completion.

## Summary of changes

Modified `src/main.rs` - the `get_latest_commit_for_spec` function now:

1. **Looks for spec-specific commit**: Searches for commits matching `chant(spec_id)` pattern
2. **Falls back to HEAD**: If no spec-specific commit is found, retrieves the HEAD commit hash (7 chars)
3. **Logs warnings**: 
   - When falling back to HEAD, logs: `"⚠ No commit with 'chant(...)' found, using HEAD: <hash>"`
   - When no commit can be found at all, logs: `"⚠ Could not find any commit for spec '...'"`

All acceptance criteria have been checked off and the changes committed with message: `chant(2026-01-24-00i-x54): Ensure git hash is in frontmatter after completion````
