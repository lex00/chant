---
type: code
status: completed
labels:
  - bugfix
  - ux
target_files:
  - src/merge.rs
  - src/cmd/lifecycle.rs
  - src/prompt.rs
  - src/cmd/spec.rs
  - tests/integration_tests.rs
model: claude-haiku-4-5-20251001
---

# Fix merge command prompting that confuses agents in non-interactive contexts

The `chant merge` command prompts "Proceed with merging X spec(s)? (y/n)" which causes issues when agents run in worktrees. Agents cannot respond to interactive prompts, causing the command to hang or fail.

## Problem

When an agent executes in a worktree and tries to run `chant merge`, the interactive prompt blocks execution:

```
Proceed with merging 3 spec(s)? (y/n): Please enter 'y' or 'n'.
Proceed with merging 3 spec(s)? (y/n): Please enter 'y' or 'n'.
... (repeats indefinitely)
```

## Solution

Detect non-interactive (non-TTY) contexts and auto-skip confirmation:

1. Check if stdin is a TTY using `atty::is(atty::Stream::Stdin)` or similar
2. If not a TTY, proceed without prompting (like `--yes` was passed)
3. Log a message indicating confirmation was skipped due to non-interactive mode

## Acceptance Criteria

- [x] Merge command detects non-TTY stdin
- [x] When non-interactive, merge proceeds without prompting
- [x] Message logged: "Non-interactive mode detected, proceeding without confirmation"
- [x] Interactive mode still prompts as before
- [x] `--yes` flag continues to work as expected
- [x] Tests verify TTY detection behavior
- [x] `just lint` passes with no warnings (pre-existing lint errors unrelated to this change)

## Notes

- Consider using `atty` crate or `std::io::IsTerminal` (Rust 1.70+)
- This pattern should be applied consistently across other commands with prompts (delete, cancel, etc.)
- Alternative: Add guidance to agent prompts to always use `--yes` flags
