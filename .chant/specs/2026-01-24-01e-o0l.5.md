---
type: code
status: pending
depends_on:
- 2026-01-24-01e-o0l.4
target_files:
- src/main.rs
---
# Add comprehensive tests for finalization edge cases

Ensure all finalization paths are tested and the fix prevents regression.

### Acceptance Criteria

- [ ] Test that spec left in_progress after agent success is properly finalized
- [ ] Test that PR URL is captured after finalization
- [ ] Test that model name is correctly set and persisted
- [ ] Test parallel mode finalization in cmd_work_parallel()
- [ ] Test that failed specs are marked Failed, not Completed
- [ ] Test that acceptance criteria failure blocks finalization
- [ ] Integration test: full workflow from pending to completed

### Edge Cases

- Model name resolution: config default vs CLI override vs env var
- Parallel mode: verify each thread's finalization is independent
- Failed agent execution: spec should be marked Failed, not leave in_progress

### Example Test Cases

For this feature, verify:
- Case 1: Integration test: create spec, work it, verify all fields set after work completes
- Case 2: Parallel test: multiple specs finalized independently
- Case 3: Model test: config.defaults.model is used when set
- Case 4: Failure test: agent error leaves spec as Failed or in_progress (current behavior)
- Case 5: Force test: --force flag allows completion even with unchecked criteria