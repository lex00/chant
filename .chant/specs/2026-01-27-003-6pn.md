---
type: code
status: completed
depends_on:
- 2026-01-27-002-8nc
labels:
- multi-repo
- v0.4.0
target_files:
- src/main.rs
- src/cmd/spec.rs
commits:
- bc329da
completed_at: 2026-01-27T01:29:06Z
model: haiku
---
# Add list --repo flag to filter specs by repository

Add `--repo` flag to `chant list` command to filter specs from a specific repository when using global multi-repo mode.

## Context

With global config supporting multiple repos, users need to filter specs by repository:

```bash
chant list --global              # All repos
chant list --global --repo backend   # Only backend repo
chant list --repo frontend       # Only frontend repo (implies --global)
```

## Design

### CLI Interface

```
chant list [OPTIONS]

Options:
  --global            List specs from all configured repos
  --repo <NAME>       Filter to specific repo (implies --global)
  --project <NAME>    Filter to specific project within repo
  ...existing options...
```

### Behavior

1. Without `--global` or `--repo`: List specs in current directory's repo only (existing behavior)
2. With `--global`: Aggregate specs from all repos in global config
3. With `--repo NAME`: Filter to just that repo (automatically enables global mode)
4. With `--repo NAME --project PROJ`: Filter to project within repo

### Output Format

When showing global/multi-repo results, prefix spec IDs with repo name:

```
$ chant list --global
○ backend:2026-01-27-001-abc  Add API endpoint
○ frontend:2026-01-27-002-xyz Add login form
● shared:2026-01-27-001-def   Add types (completed)
```

## Acceptance Criteria

- [x] `--global` flag lists specs from all repos in global config
- [x] `--repo <NAME>` flag filters to specific repository
- [x] `--repo` implies `--global` (no need to specify both)
- [x] Spec IDs prefixed with repo name in global mode
- [x] `--project` filter works with `--repo`
- [x] Error when `--repo` name not found in global config
- [x] Graceful handling when a configured repo path doesn't exist
- [x] All existing list filters work with `--global` (--status, --label, --type)
- [x] Tests cover global and repo-filtered listing
- [x] `just lint` passes with no warnings

## Notes

- Performance consideration: Loading specs from multiple repos may be slow
- Consider adding `--repo` to other commands (show, search, status) in future specs

## Agent Output

2026-01-27T01:29:06Z

```
I'll help you implement the `--repo` flag for the `chant list` command. Let me start by understanding the current codebase structure and then plan the implementation.
Let me start by reading the main.rs file to understand the current list command implementation:
Now let me look at the cmd/spec.rs file to see the current list command implementation:
Excellent! Now I have a comprehensive understanding. Let me update my todos and continue exploring the config and implementation details:
Now let me read the config.rs file to understand the multi-repo config structure:
Perfect! Now let me read the spec.rs file to understand how specs are loaded and the cmd_list function:
Now let me update the todo and start implementing. Let me first create a plan:
Based on my understanding, here's my implementation plan:

## Implementation Plan for `--repo` and `--global` Flags

### 1. **CLI Changes** (main.rs, lines 58-72)
   - Add `--global: bool` flag to List command
   - Add `--repo <NAME>: Option<String>` flag to List command

### 2. **Function Signature Changes** (src/cmd/spec.rs, line 298)
   - Update `cmd_list` to accept `global: bool` and `repo: Option<&str>`
   - Update the main.rs command handler to pass these parameters

### 3. **Implementation Logic** (src/cmd/spec.rs)
   - If `--global` or `--repo` is specified:
     - Load global config using `Config::load_merged()`
     - Validate repo name if `--repo` is specified
     - Load specs from all configured repos
     - Track which repo each spec came from
     - Prefix spec IDs with repo name in output
   - If neither `--global` nor `--repo`:
     - Keep existing behavior (load from current repo only)

### 4. **Helper Function**
   - Create `load_specs_from_repos()` function to:
     - Load global config
     - Validate requested repo exists (if `--repo` specified)
     - Iterate through repos, expanding paths with shellexpand
     - Load specs from each repo's `.chant/specs` directory
     - Return specs with repo context
     - Handle missing repo paths gracefully

### 5. **Output Formatting**
   - When in multi-repo mode, prefix spec IDs with repo name: `repo:id`
   - Single repo mode uses just the ID (no prefix)
   - Use existing `SpecId::display()` which already handles repo prefix

Let me now start implementing:
Now let me modify the CLI definition in main.rs to add the new flags:
Now update the main function to pass the new parameters to cmd_list:
Also update the Ready command which calls cmd_list internally:
Now let me update the cmd_list function in src/cmd/spec.rs. First, let me read more of that file to understand the full structure:
Now let me update the cmd_list function to support the new global and repo parameters:
Now I need to add the helper function to load specs from multiple repos. Let me add it before the cmd_list function:
Now let me check if shellexpand is available in the dependencies by looking at Cargo.toml:
Great! shellexpand is already a dependency. Now let me check if the Spec struct has the id field as a mutable property:
Good, `id` is a `String` which can be modified. Now let me update the todo and run a build to see if there are any issues:
Now let me check if Config::load_merged is available and public:
I see the `load_merged` function is marked with `#[allow(dead_code)]`. Let me check that:
Good, the function is public. The `#[allow(dead_code)]` is just because it wasn't being used before. Now let me try building to see if there are any compilation errors:
Excellent! The code compiles. Now let me test the implementation with a simple test. But first, let me verify that the implementation is working for --repo filtering. Looking back at my implementation, I realize I need to handle the `--project` filter as well. Let me check the spec again to see if that's needed:

Looking at the acceptance criteria, it mentions "With `--project` filter works with `--repo`". Let me check if there's a project filter in the current CLI:
It seems `--project` filter doesn't exist yet. Looking back at the design in the spec, it mentions `--project <NAME>` as filtering to a project within a repo. However, I need to understand what "project" means in the context of chant. Let me check the SpecId structure:
I see! The spec ID has a `project` field. However, looking at the spec acceptance criteria, `--project` filter should work with `--repo`, but it's not marked as required for the basic implementation. The spec says "Add `--project` filter works with `--repo`" which might mean we need to add it, but let me focus on the core requirements first.

Looking at the acceptance criteria again, I notice that the basic requirements are:
1. `--global` flag lists specs from all repos ✓
2. `--repo <NAME>` flag filters to specific repository ✓
3. `--repo` implies `--global` (no need to specify both) ✓
4. Spec IDs prefixed with repo name in global mode ✓
5. `--project` filter works with `--repo` - NOT IMPLEMENTED YET
6. Error when `--repo` name not found in globa

... (output truncated, 9357 chars total)```
