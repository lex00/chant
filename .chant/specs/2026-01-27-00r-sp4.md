---
type: code
status: completed
target_files:
- src/cmd/work.rs
- src/cmd/finalize.rs
completed_at: 2026-01-27T21:23:02Z
model: haiku
---
# Fix spec status not updating to completed after work

## Problem

**User Report:** "Completed specs sometimes still showed as ○ ready instead of ● completed in chant list, making it confusing which specs were actually pending."

After `chant work` completes successfully, the spec status doesn't update to `completed`, causing:
- User confusion about which specs need work
- Double-execution attempts
- Inaccurate progress tracking
- List output showing ready (○) when should show completed (●)

**Example:**
```bash
$ chant work 2026-01-27-001-abc
# Agent completes successfully, all criteria checked

$ chant list
○ 2026-01-27-001-abc Add feature X  # Should be ●
```

## Root Cause

**User Investigation Confirmed:**
- Sequential `chant work` updates status properly (shows ● completed)
- Parallel `chant work --parallel` does NOT update status (shows ○ ready)
- Spec file frontmatter still shows `status: pending` after parallel completion
- Missing fields: `commits`, `completed_at`, `model`
- The parallel agents committed code but didn't update spec metadata
- User did NOT run `chant finalize` manually (assumed automatic)

**Conclusion:** Parallel execution path skips finalization that sequential path performs.

## Solution

Ensure status is updated after successful completion:

1. **Check current flow:** Trace where spec status is set after agent execution
2. **Verify auto-finalize:** Confirm `finalize_spec` is called in work.rs
3. **Check file write:** Ensure spec.save() is called after status change
4. **Add logging:** Show when status transitions occur
5. **Fix race conditions:** Ensure parallel specs don't overwrite each other

**Code Review Points:**
- src/cmd/work.rs: Does it call finalize after agent success?
- src/cmd/finalize.rs: Does finalize_spec update status field?
- src/spec.rs: Does save() persist all frontmatter changes?

## Acceptance Criteria

- [ ] Identify where spec status should be updated after work
- [ ] Verify finalize_spec is called automatically
- [ ] Ensure status field is set to Completed in frontmatter
- [ ] Verify spec.save() writes status to disk
- [ ] Add logging: "Updated spec status to completed"
- [ ] Test: chant work -> chant list shows completed (●)
- [ ] Test: parallel work -> all specs show completed status
- [ ] Add integration test verifying status update
- [ ] All existing tests pass