---
type: code
status: in_progress
model: claude-opus-4-5-20251101
---
# Add approval workflow for agent-assisted commits

PROBLEM:
When an AI agent (Claude, etc.) assists with code changes and creates commits, there's currently no built-in mechanism to require human review before those changes go live. This creates risk:
- Agent-written code may have subtle bugs
- Security issues could be introduced
- Business logic could be misunderstood
- No forcing function for code review

USER NEED:
A flag/toggle that makes commits with agent co-authorship automatically require approval before they can be merged or deployed.

PROPOSED SOLUTION:

Option A: Automatic approval requirement detection
- Scan commit messages for 'Co-Authored-By: Claude' or other agent signatures
- Automatically set spec frontmatter 'approval: required: true' when agent commit detected
- Existing approval system (chant approve/reject) handles the review

Option B: Config flag for agent review policy
- Add config setting: 'require_approval_for_agent_work: true'
- When enabled, any spec worked by agent requires approval
- Can be set per-project or globally

Option C: Git hook integration
- Pre-merge hook checks for agent co-authorship
- Blocks merge unless spec has approval: status=approved
- Works with existing git workflow

RECOMMENDED: Option A + B combined
- Auto-detect agent work (Option A)
- Allow config override to require/skip (Option B)
- Use existing approval system (no new commands needed)

## Acceptance Criteria

- [x] Detect agent co-authorship in commits (Co-Authored-By: Claude, GPT, Copilot, Gemini, etc.)
- [x] Auto-set approval requirement when agent detected during finalization
- [x] Config setting `approval.require_approval_for_agent_work` to enable/disable auto-requirement
- [x] Work with existing chant approve/reject commands (no changes needed - uses existing Approval struct)
- [x] Clear messaging when approval is required (shows message during finalize and merge)
- [x] Prevent merge without approval when required (merge command checks `requires_approval()`)
- [x] Tests for detection and enforcement (unit tests for agent detection, config parsing)