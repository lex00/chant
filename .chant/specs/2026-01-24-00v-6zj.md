---
type: code
status: completed
target_files:
- src/main.rs
commit: a9d7f2f
completed_at: 2026-01-24T12:59:00Z
---
# Save full agent conversation logs

Currently only the agent summary is appended to the spec after work. The full agent output/conversation should be saved to a log file for debugging and audit purposes.

## Acceptance Criteria

- [x] Create `.chant/logs/` directory when first log is written
- [x] Save full agent output to `.chant/logs/{spec-id}.log`
- [x] Add `.chant/logs/` to `.chant/.gitignore` when logs dir is created
- [x] Spec file continues to show only the summary (current behavior)
- [x] Log file includes timestamp header
- [x] Log file is overwritten on replay (or append with separator)

## File Structure

```
.chant/
  logs/
    2026-01-24-001-x7m.log    # Full agent output
    2026-01-24-002-abc.log
  specs/
    2026-01-24-001-x7m.md     # Summary only in ## Agent Output
  .gitignore                  # Contains: logs/
```

## Log File Format

```
# Agent Log: 2026-01-24-001-x7m
# Started: 2026-01-24T15:30:00Z
# Prompt: standard

[Full agent stdout/stderr output here...]
```

## Implementation Notes

- Modify `invoke_agent` to also write to log file
- Create logs dir with `std::fs::create_dir_all`
- Check if .gitignore exists, append `logs/` if not present
- The summary in spec file is still useful for quick review
- Full logs are useful for debugging failed specs or understanding agent reasoning

## Agent Output

2026-01-24T12:59:00Z

```
The implementation is complete. Here's a summary of what was done:

## Summary

Implemented saving full agent conversation logs to `.chant/logs/{spec-id}.log` for debugging and audit purposes.

### Changes made to `src/main.rs`:

1. **Added `ensure_logs_dir()` function** (line 1069-1097): Creates the `.chant/logs/` directory on first use and adds `logs/` to `.chant/.gitignore` if not already present.

2. **Added `write_agent_log()` function** (line 1100-1117): Writes the full agent output to a log file with a header containing the spec ID, timestamp, and prompt name. The log file is overwritten on replay.

3. **Modified `invoke_agent()`** (line 924): Added `prompt_name` parameter and calls `write_agent_log()` after execution (regardless of success/failure).

4. **Modified `invoke_agent_with_prefix()`** (line 880): Added `prompt_name` parameter, now captures output while streaming (previously only streamed), and calls `write_agent_log()` after execution.

### Log file format:
```
# Agent Log: 2026-01-24-00v-6zj
# Started: 2026-01-24T15:30:00Z
# Prompt: standard

[Full agent stdout/stderr output here...]
```

All acceptance criteria have been checked off and the commit `a9d7f2f` has been created.```
