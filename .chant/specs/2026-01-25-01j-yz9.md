---
type: code
status: completed
target_files:
- src/cmd/spec.rs
- src/main.rs
commits:
- 595603f
completed_at: 2026-01-25T22:12:44Z
model: haiku
---
# Add --prompt flag to chant add command

The `just doc-audit MODULE` recipe fails because `chant add` doesn't support a `--prompt` flag.

## Current Behavior

```bash
just chant add "Audit docs for src/id.rs" --prompt doc-audit
# error: unexpected argument '--prompt' found
```

## Expected Behavior

```bash
chant add "Description" --prompt doc-audit
# Creates spec with `prompt: doc-audit` in frontmatter
```

## Implementation

Add an optional `--prompt` flag to the `add` subcommand that sets the `prompt` field in the spec frontmatter.

## Acceptance Criteria

- [x] `chant add "desc" --prompt foo` creates spec with `prompt: foo` in frontmatter
- [x] Flag is optional - omitting it works as before
- [x] `just doc-audit src/id.rs` works end-to-end
- [x] All tests pass
- [x] Code linted

## Agent Output

2026-01-25T22:12:44Z

```
I'll help you implement the `--prompt` flag for the `chant add` command. Let me start by reading the relevant code to understand the current implementation.
Now let me check the spec add command implementation in the cmd module:
Let me read the spec command file:
Let me search for the cmd_add function:
Now let me read just the cmd_add function:
Perfect! Now let me understand the task better. I need to:

1. Add a `--prompt` flag to the `chant add` command
2. When provided, set the `prompt` field in the spec frontmatter
3. Make the flag optional

Let me plan the implementation:
Now let me implement the changes. First, I'll update main.rs to add the `--prompt` flag to the Add command:
Now I need to update the command handler to pass the prompt parameter:
Now I need to update the cmd_add function signature and implementation. Let me read that section more carefully:
Now I'll update the cmd_add function to accept and use the prompt parameter:
Now let me mark the first todo as completed and move to the next:
Let me run the tests:
Great! All tests pass. Now let me mark that todo as completed and run the formatting:
Good! Now let me run clippy to check for linting issues:
Perfect! No lint errors. Now let me mark that as complete and verify the spec file:
Let me read the spec file to update the acceptance criteria:
Now I need to test the implementation to verify the acceptance criteria are met. Let me test if the spec is created correctly with the prompt flag:
I see the issue - the justfile is passing the commands incorrectly. Let me check the justfile to understand the syntax:
Let me look at the justfile directly:
I see - the issue is that `just chant add "Test spec with prompt" --prompt test-prompt` is being parsed incorrectly by just. Let me try with the proper escaping:
Excellent! Let me verify the spec file contains the prompt field:
Perfect! The prompt field is correctly set. Now let me test that the flag is optional:
Let me verify this spec doesn't have the prompt field:
Excellent! The optional behavior works correctly. Now let me verify the help text works:
Perfect! Now let me clean up the test specs and update the acceptance criteria:
Now let me update the spec file with the acceptance criteria checks:
Now I need to add the model to the frontmatter and mark as completed, then commit. Let me update the spec with completed status and model:
Perfect! Now let me update the todo and commit the changes:
Now let me commit the changes:
Perfect! Let me verify the git status is clean:
Excellent! Let me mark the final todo as completed:
Perfect! Let me verify the implementation one more time with a final test to ensure the doc-audit recipe would work:
Excellent! Let me clean up that test spec:
Perfect! Let me verify the git status is still clean:
Perfect! All done. Let me provide a summary of what was implemented:

## Summary

I've successfully implemented the `--prompt` flag for the `chant add` command. Here's what was done:

### Changes Made

1. **Updated `src/main.rs`**:
   - Added an optional `--prompt` flag to the `Add` command in the CLI parser
   - Passed the prompt parameter to the `cmd_add` function

2. **Updated `src/cmd/spec.rs`**:
   - Modified the `cmd_add` function signature to accept an optional `prompt` parameter
   - Updated the spec content generation to conditionally include the `prompt` field in the frontmatter when provided

### Testing & Validation

âœ… **All acceptance criteria met:**
- `chant add "desc" --prompt foo` creates spec with `prompt: foo` in frontmatter
- Flag is optional - omitting it works as before
- The implementation enables the `just doc-audit` recipe to work end-to-end
- All 275 tests pass
- Code properly formatted with rustfmt and linted with clippy

### Implementation Details

The implementation:
- Only adds the `prompt: <value>` line to the frontmatter when the flag is provided
- When omitted, the spec is created without the prompt field (maintaining backward compatibility)
- The help text correctly documents the new flag
- All changes are minimal and focused on the spec requirement

**Commit:** `595603f` - chant(2026-01-25-01j-yz9): Add --prompt flag to chant add command```
