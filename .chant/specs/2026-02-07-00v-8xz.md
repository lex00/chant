---
type: code
status: pending
labels:
- docs
- internals
- architecture
target_files:
- docs/architecture/patterns.md
- docs/SUMMARY.md
model: sonnet
---
# Add architecture patterns documentation

## Context

Chant's 18K LOC codebase implements ~20 well-known software patterns across its layers. There's no documentation mapping the code to these patterns — making it hard for contributors to navigate.

## Content to Document

Create `docs/architecture/patterns.md` with ASCII diagrams mapping chant's architecture to software patterns. Cover:

1. **State Machine** (TransitionBuilder) — composable preconditions via Builder pattern
2. **Execution Engine** (executor.rs) — Template Method + Strategy across single/chain/parallel
3. **Worktree Isolation** — Sandbox pattern with Mutex for serialized creation
4. **Dependency Graph** — DAG with topological sort and cycle detection
5. **Merge Driver** — Declarative Rules Engine (field → strategy table)
6. **MCP Interface** — Command pattern with self-describing tool registry
7. **Provider Abstraction** — Strategy pattern for pluggable AI backends
8. **Spec Groups** — Composite pattern (driver/member hierarchy)
9. **Watch Service** — Observer via polling with crash recovery
10. **Operations Layer** — Facade/Service Layer shared by CLI and MCP
11. **Config** — Layered Configuration merge (global → project → agent)
12. **Output** — Strategy + Adapter for Human/JSON/Quiet modes
13. **Score/Lint** — Composite scorer aggregating independent metrics

For each pattern: name it, show where in the code it lives (file paths), and include an ASCII diagram showing the structure or flow.

## Task

1. Create `docs/architecture/patterns.md` with the content above
2. Add it to `docs/SUMMARY.md` under the Architecture section (after "Agent Protocol")

## Acceptance Criteria

- [ ] `docs/architecture/patterns.md` exists with all 13 patterns documented
- [ ] Each pattern has: name, code location, ASCII diagram, brief explanation
- [ ] Added to SUMMARY.md under Architecture section
- [ ] `mdbook build docs/` succeeds (if mdbook is available, otherwise verify markdown is valid)