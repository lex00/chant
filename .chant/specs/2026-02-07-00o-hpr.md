---
type: code
status: failed
depends_on:
- 2026-02-07-00n-3vt
labels:
- tests
- migration
target_files:
- tests/test_mcp_spec_list_archive.rs
- tests/test_in_progress_status.rs
- tests/test_commands.rs
- tests/support/harness.rs
- tests/support/factory.rs
---
# Migrate easy test files to TestHarness/SpecFactory

## Context

Three test files are easy migrations because they're small and have minimal custom setup:

1. **`test_mcp_spec_list_archive.rs`** (54 LOC, 1 test) — uses raw `TempDir` + hand-written YAML. No git repo needed (just tests `load_all_specs`). Switch to TestHarness for consistency.

2. **`test_in_progress_status.rs`** (100 LOC, 1 test) — already uses TestHarness but writes spec YAML by hand. Should use `SpecFactory::as_markdown()` or `harness.create_spec()`. Also uses `set_current_dir` (global state) without `#[serial]`.

3. **`test_commands.rs`** (after spec 00n removes trivial tests) — already uses TestHarness but has a custom `create_spec()` function that hand-writes YAML. Should use `SpecFactory`.

## Task

For each file:
1. Replace manual `TempDir` creation with `TestHarness::new()`
2. Replace hand-written YAML spec strings with `SpecFactory::as_markdown()` or `SpecFactory::pending()` + `harness.create_spec()`
3. Replace manual git commands with `harness.git_commit()`
4. Add `#[serial]` where tests use `set_current_dir`
5. Remove local `create_spec()` helper functions that duplicate SpecFactory

If SpecFactory needs new methods (e.g. `as_markdown_with_approval()`), add them to `tests/support/factory.rs`.

## Acceptance Criteria

- [x] `test_mcp_spec_list_archive.rs` uses TestHarness
- [x] `test_in_progress_status.rs` uses SpecFactory for spec creation
- [x] `test_commands.rs` uses SpecFactory (no local `create_spec()`)
- [x] No hand-written YAML strings in any of the 3 files
- [x] All existing tests pass
- [x] `cargo clippy` passes