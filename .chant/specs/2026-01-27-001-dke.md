---
type: code
status: completed
labels:
- ux
- bugfix
target_files:
- src/main.rs
- src/cmd/lifecycle.rs
model: claude-haiku-4-5-20251001
---
# Archive command should commit changes or use git mv to stage moves

When `chant archive` moves completed specs to the archive directory, the changes are left unstaged, requiring manual `git add` and `git commit`. This breaks the workflow when running multiple commands in sequence.

## Problem

```bash
$ chant archive 001-abc
Archived 2026-01-27-001-abc to .chant/archive/2026-01-27/

$ git status
 D .chant/specs/2026-01-27-001-abc.md
?? .chant/archive/2026-01-27/2026-01-27-001-abc.md

# User must manually commit
$ git add -A && git commit -m "Archive spec"
```

This caused issues during the v0.3.0 release when archived specs blocked the release script's "clean working directory" check.

## Solution

Use `git mv` instead of `fs::rename` when moving specs to archive. This:
1. Stages the move automatically
2. Preserves git history for the file
3. Follows the pattern used elsewhere in chant

Optionally, add `--commit` flag to auto-commit the archive operation.

## Acceptance Criteria

- [x] `chant archive` uses `git mv` to move specs (stages changes automatically)
- [x] Archive works in non-git directories (falls back to fs::rename)
- [x] `--commit` flag creates a commit with message "Archive completed specs"
- [x] `--no-stage` flag uses fs::rename instead of git mv (for special cases)
- [x] Existing archive tests pass
- [x] `just lint` passes with no warnings

## Notes

- Check if directory is a git repo before using git mv
- Consider adding `--commit` to other commands that modify specs (cancel, delete)