---
type: research
status: completed
target_files:
- src/main.rs
---
# Investigate why 006 was prematurely marked complete

## Problem

Spec 006 (archive folder organization) was marked as completed by the agent, but it appears the work may have been incomplete or premature.

## Investigation Questions

1. **What was the completion criteria?**
   - Review the acceptance criteria in the spec
   - Were all criteria actually met?

2. **What triggered the completion?**
   - Did the agent mark it complete manually?
   - Did finalize_spec() run?
   - Was there a commit with the spec ID?

3. **What was missing or incomplete?**
   - Review the git diff for the spec
   - Check if all acceptance criteria checkboxes were validated
   - Were there untested edge cases?

4. **Root cause analysis**
   - Is this a problem with the standard prompt?
   - Is this a problem with finalize_spec() validation?
   - Should acceptance criteria be automatically validated?

## Investigation Findings

### What was Incomplete about 006

Spec 006's acceptance criterion states: **"`chant show` finds specs in archive subfolders"**

This criterion was marked as complete, but the implementation is **broken**:
- Archived specs exist in `.chant/archive/YYYY-MM-DD/` subdirectories (e.g., `.chant/archive/2026-01-24/2026-01-24-001-cxn.md`)
- The `chant show` command CANNOT find these archived specs
- Testing: `just chant show 2026-01-24-001-cxn` returns `Error: Spec not found: 2026-01-24-001-cxn`

### Root Cause Analysis

The issue is in how `resolve_spec()` works:

1. `resolve_spec()` is called with `specs_dir` (the `.chant/specs/` directory)
2. It calls `load_all_specs(specs_dir)` to get all specs
3. `load_all_specs()` was updated to recursively load specs from subdirectories
4. **However**: The archive is in a different location (`.chant/archive/`) and `load_all_specs()` is only called with the specs directory

**The fix requires**: `resolve_spec()` should also search archived specs, not just specs in the specs directory.

### Why This Wasn't Caught

The agent that completed spec 006:
1. Created tests for nested archive structure but only for `load_all_specs()` called with the archive directory directly
2. Ran `just test` and saw all tests pass (tests were incomplete - they didn't test the actual use case)
3. Marked the acceptance criteria as complete without actually validating the `chant show` command works with archived specs

### Root Cause Category

**Insufficient Validation**: The spec was marked complete based on:
- Tests passing (but tests were incomplete)
- Architectural change implemented correctly (but integration was missing)
- Manual testing was incomplete (didn't test the actual user-facing functionality)

The standard prompt did not emphasize validating that acceptance criteria work from the **user's perspective** (using CLI commands), only from the code/test perspective.

## Acceptance Criteria

- [x] Document what was incomplete about 006
- [x] Identify root cause of premature completion
- [x] Recommend fix (prompt change, code change, or both)
- [x] Create follow-up spec if code changes needed

## Recommendations

### Code Fix Required
A code fix is needed (created spec 2026-01-25-00a-u8k to address this). The `resolve_spec()` function must also search the archive directory to find archived specs.

### Prompt Enhancement
The standard prompt should emphasize:
1. **Validate acceptance criteria from user perspective**: Not just "tests pass" but "the actual CLI command works as expected"
2. **Manual validation required**: Run the actual commands that users would use, not just unit tests
3. **End-to-end testing**: If a criterion says "command X works with feature Y", actually test that specific command