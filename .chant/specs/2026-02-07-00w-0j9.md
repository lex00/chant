---
type: code
status: pending
labels:
- docs
- internals
- architecture
target_files:
- docs/architecture/operations-layer.md
- docs/SUMMARY.md
model: sonnet
---
# Add operations layer documentation

## Context

The `src/operations/` module (create, finalize, reset, update) provides shared business logic used by both CLI commands and MCP handlers. This prevents the common pattern where MCP re-implements CLI logic with subtle differences. There's no documentation explaining this layer or how to add new operations.

## Content to Document

Create `docs/architecture/operations-layer.md` covering:

1. **Problem**: Before the operations layer, MCP handlers duplicated CLI command logic. Bug fixes in one didn't reach the other.

2. **Architecture**: Show how CLI and MCP both route through operations:
   ```
   CLI (clap)  ──┐
                  ├──▶ operations/ ──▶ domain layer
   MCP (JSON-RPC)─┘
   ```

3. **Current Operations**: Document each module:
   - `create.rs` — spec creation (ID generation, template, file write)
   - `finalize.rs` — spec completion (validation, merge, status update)
   - `reset.rs` — failure recovery (status revert, optional restart)
   - `update.rs` — field mutations (selective updates, preservation)

4. **How to Add a New Operation**: Step-by-step guide for contributors

5. **What Goes Where**: Decision guide — when to put logic in operations/ vs cmd/ vs domain

## Task

1. Create `docs/architecture/operations-layer.md` with the content above
2. Add it to `docs/SUMMARY.md` under Architecture section

## Acceptance Criteria

- [ ] `docs/architecture/operations-layer.md` exists
- [ ] Covers problem, architecture diagram, all 4 current operations, contributor guide
- [ ] Added to SUMMARY.md under Architecture section
- [ ] `mdbook build docs/` succeeds (if available)