---
type: code
status: completed
model: claude-haiku-4-5-20251001
---
# Fix Windows CI test_get_model_for_invocation_from_chant_model env var pollution

## Problem

The test `test_get_model_for_invocation_from_chant_model` is failing on Windows CI:

```
assertion `left == right` failed
  left: "haiku"
 right: "claude-opus-4-5"
```

The test sets `CHANT_MODEL=claude-opus-4-5` but "haiku" is being returned instead. This is caused by environment variable pollution from parallel test execution.

## Solution

Add `#[serial]` attribute from `serial_test` crate to tests that manipulate environment variables, or add `#[cfg(unix)]` to skip on Windows if simpler.

## Acceptance Criteria

- [x] Test passes on Windows CI
- [x] No environment variable pollution between tests