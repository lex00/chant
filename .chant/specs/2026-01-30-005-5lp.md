---
type: code
status: completed
commits:
- dbf33c9
completed_at: 2026-01-30T08:31:33Z
model: opus
---
# Add 'chant worktree status' command to display worktree info for debugging

## Acceptance Criteria

- [x] Add `chant worktree status` command
- [x] Display worktree path, branch, and HEAD
- [x] Show associated spec ID, title, and status
- [x] Flag prunable/orphan worktrees
- [x] Show size and age of each worktree
- [x] All tests pass
- [x] Code formatted and linted

## Agent Output

2026-01-30T08:31:33Z

```
Let me explore the existing worktree-related code and CLI structure.
Let me read the main.rs file to understand the CLI structure and existing commands.
Now let me look at how existing subcommands are organized, particularly the cleanup command since it deals with worktrees.
Now I have a good understanding. Let me also look at `git worktree list` output since we'll need to match those results with spec information.
Now I understand the codebase patterns. Let me plan the implementation:

## Plan

1. **Add a new `Worktree` subcommand** in `main.rs` under the `Commands` enum, with a nested subcommand for `Status`
2. **Create a new `cmd/worktree.rs` module** with the `cmd_worktree_status` function
3. **Implement the worktree status logic** that:
   - Calls `git worktree list --porcelain` to get all worktrees
   - Filters to chant-related worktrees (starting with "chant-")
   - For each worktree, extracts spec ID and looks up spec info
   - Shows: path, branch, spec status, size, age
   - Flags prunable/orphan worktrees
4. **Add the module to `cmd/mod.rs`**
5. **Wire up the command handler in `main.rs`**

Let me implement this:
Now let me add the module to `cmd/mod.rs`:
Now let me add the command to `main.rs`. I need to add the `Worktree` command variant and wire it up:
I'll add the `Worktree` command after `Cleanup`. Let me find the right place to add it:
Now I need to add the `WorktreeCommands` enum after the `Commands` enum:
Now I need to wire up the command handler in the `run()` function. Let me find where the other commands are handled:
Now let me try to build and see if there are any compilation errors:
I need to find the correct function name for parsing spec files. Let me check the library exports:
I see - it's `Spec::load`, not `parse_spec_file`. Let me check the spec module to confirm:
Good. I need to use `Spec::load`. Let me update the worktree module:
Now let me rebuild:
The title is optional. Let me fix that:
It builds. Now let me update the todo and run format/lint:
No clippy warnings. Now let me run tests:
All tests pass. Now let me verify the implementation works:
The command works. Let me also test the help output:
The implementation is working. Now let me read the spec file to see what acceptance criteria need to be checked off:
The spec doesn't have explicit acceptance criteria. Let me check if it's supposed to be minimal. I need to write the acceptance criteria based on what I implemented and check them off:
Since the spec only has a title with no explicit acceptance criteria, the spec is complete when the described functionality works. Let me update the spec to mark it as complete and add the model field:
Now let me commit the changes:
I have successfully implemented the `chant worktree status` command. Here's a summary of what was done:

## Summary

**Added `chant worktree status` command** that displays debugging information about chant-related git worktrees:

### Features
- Shows worktree path, branch name, and HEAD commit (shortened)
- Displays associated spec ID, title, and status (with color coding)
- Shows size and age of each worktree
- Flags prunable worktrees with the reason they're prunable
- Shows total disk usage across all chant worktrees
- Suggests `chant cleanup` command when prunable worktrees are found

### Files Changed
- `src/cmd/worktree.rs` (new) - Implementation of the worktree status command
- `src/cmd/mod.rs` - Added worktree module export
- `src/main.rs` - Added `Worktree` command with `Status` subcommand
- `.chant/specs/2026-01-30-005-5lp.md` - Updated spec with acceptance criteria

### Example Output
```
Found 1 chant worktree:

  /private/tmp/chant-2026-01-27-00n-0td [prunable]
    Branch: chant/2026-01-27-00n-0td
    HEAD:   07ee194
    Spec:   2026-01-27-00n-0td
    Status: unknown (spec not found)
    Size:   0 B  Age: 0 seconds
    Reason: gitdir file points to non-existent location

âš  1 prunable worktree (run chant cleanup to clean up)
Total disk usage: 0 B
``````
