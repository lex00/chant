---
type: code
status: pending
target_files:
  - src/main.rs
  - src/cmd/cleanup.rs
  - src/cmd/mod.rs
  - docs/reference/cli.md
model: claude-haiku-4-5-20251001
---

# Add chant cleanup command to remove orphan worktrees and stale artifacts

## Overview

Add a `chant cleanup` command to remove orphan worktrees from /tmp and clean up other stale artifacts.

## Interface

```bash
chant cleanup              # Interactive - show what would be cleaned, prompt to confirm
chant cleanup --yes        # Auto-confirm cleanup
chant cleanup --dry-run    # Show what would be cleaned without doing it
```

### Output

```
Scanning for orphan worktrees...

Found 15 orphan worktrees in /tmp:
  chant-2026-01-25-01g-v2e  (234 MB, 2 days old)
  chant-2026-01-25-01l-c41  (234 MB, 2 days old)
  ...

Total: 5.6 GB

? Clean up these worktrees? [Y/n]

Removing chant-2026-01-25-01g-v2e... done
Removing chant-2026-01-25-01l-c41... done
...
Running git worktree prune... done

Cleaned up 5.6 GB
```

## Implementation

- Create `src/cmd/cleanup.rs` module
- Scan /tmp for `chant-*` directories
- Check if they're valid git worktrees or orphans
- Show size and age of each
- Run `git worktree prune` after removal
- Optionally clean old logs (--logs flag, default off)

## Acceptance Criteria

- [x] `chant cleanup` shows orphan worktrees with sizes
- [x] `chant cleanup --dry-run` shows without removing
- [x] `chant cleanup --yes` removes without prompting
- [x] Runs `git worktree prune` after cleanup
- [x] Shows total space reclaimed
- [x] Tests for cleanup detection logic
- [x] Documentation updated
