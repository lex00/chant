---
type: code
status: completed
target_files:
- src/main.rs
- src/cmd/cleanup.rs
- docs/reference/cli.md
completed_at: 2026-01-26T22:26:49Z
model: haiku
---
# Add chant cleanup command to remove orphan worktrees and stale artifacts

## Overview

Add a `chant cleanup` command to remove orphan worktrees from /tmp and clean up other stale artifacts.

## Interface

```bash
chant cleanup              # Interactive - show what would be cleaned, prompt to confirm
chant cleanup --yes        # Auto-confirm cleanup
chant cleanup --dry-run    # Show what would be cleaned without doing it
```

### Output

```
Scanning for orphan worktrees...

Found 15 orphan worktrees in /tmp:
  chant-2026-01-25-01g-v2e  (234 MB, 2 days old)
  chant-2026-01-25-01l-c41  (234 MB, 2 days old)
  ...

Total: 5.6 GB

? Clean up these worktrees? [Y/n]

Removing chant-2026-01-25-01g-v2e... done
Removing chant-2026-01-25-01l-c41... done
...
Running git worktree prune... done

Cleaned up 5.6 GB
```

## Implementation

- Create `src/cmd/cleanup.rs` module
- Scan /tmp for `chant-*` directories
- Check if they're valid git worktrees or orphans
- Show size and age of each
- Run `git worktree prune` after removal
- Optionally clean old logs (--logs flag, default off)

## Acceptance Criteria

- [ ] `chant cleanup` shows orphan worktrees with sizes
- [ ] `chant cleanup --dry-run` shows without removing
- [ ] `chant cleanup --yes` removes without prompting
- [ ] Runs `git worktree prune` after cleanup
- [ ] Shows total space reclaimed
- [ ] Tests for cleanup detection logic
- [ ] Documentation updated