---
type: code
status: in_progress
---
# Bootstrap prompt with prep script

## Problem

The current prompt assembly embeds the full spec content directly into the CLI argument passed to Claude. This causes:
1. Large initial prompts that may trigger aggressive rate limiting
2. Claude attempts to process everything at once, making many parallel tool calls
3. On replay/resume, the spec may contain stale agent conversation that confuses the agent

## Solution

### 1. Bootstrap Prompt

Create a new `bootstrap` prompt that:
- Is minimal - just tells the agent to run a prep command
- Does NOT embed `{{spec.description}}` or `{{spec}}`
- Instructs the agent to call `chant prep <spec-id>` to get the work

Example bootstrap prompt:
```markdown
You are implementing spec {{spec.id}} for {{project.name}}.

Run this command to get your instructions:
\`\`\`
chant prep {{spec.id}}
\`\`\`

Follow the instructions returned by that command.
```

### 2. Prep Command (`chant prep <spec-id>`)

New CLI command that outputs the spec content, with preprocessing:
- Reads the spec file
- If `--clean` or by default: strips any "## Agent Conversation" or similar sections that may have been added during previous runs
- Outputs clean spec content for the agent to read
- Could add other preprocessing in future (inject context, check dependencies, etc.)

### 3. Spawn Jitter

Change `stagger_delay_ms` to use jitter instead of exact interval:
- Add `stagger_jitter_ms` config option (default: 20% of delay)
- Actual delay = `stagger_delay_ms + random(-jitter, +jitter)`
- Prevents synchronized bursts when multiple agents finish/start at similar times

## Acceptance Criteria

- [x] New `bootstrap` prompt in `.chant/prompts/bootstrap.md`
- [x] New `chant prep <spec-id>` command that outputs cleaned spec content
- [x] Prep command strips agent conversation sections from spec body
- [x] `stagger_jitter_ms` config option added to parallel config
- [x] Spawn delay uses jitter: `delay + random(-jitter, +jitter)`
- [x] Documentation updated for new prompt and prep command
- [x] `just lint` passes