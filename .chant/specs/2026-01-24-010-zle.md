---
type: code
status: in_progress
depends_on:
- 2026-01-24-00v-6zj
- 2026-01-24-00x-1fz
target_files:
- src/main.rs
model: claude-opus-4-5-20251101
---
# Stream agent output to log file during work execution

Currently `chant work` only writes the log file after the agent completes. This makes `chant log -f` useless during execution. Stream output to the log file in real-time.

## Acceptance Criteria

- [x] Write log file header before agent starts
- [x] Stream stdout to log file as it arrives (not buffered until end)
- [x] `chant log -f` works during active `chant work` execution
- [x] Log file still contains complete output after execution

## Current Behavior

```
chant work 001  # Agent runs, output goes to stdout
                # Log file written AFTER agent exits
chant log 001 -f  # Nothing to see until work completes
```

## Expected Behavior

```
# Terminal 1
chant work 001  # Agent runs, streams to stdout AND log file

# Terminal 2 (simultaneously)
chant log 001 -f  # See output in real-time as agent works
```

## Implementation Notes

- Open log file before spawning agent
- Use `BufWriter` with frequent flushes or unbuffered writes
- Write each line to both stdout and log file as it arrives
- Consider using `tee` pattern: read from agent stdout, write to both destinations
- May need to flush after each line for real-time visibility