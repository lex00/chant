---
type: code
status: cancelled
depends_on:
- 2026-02-07-00y-qqd
labels:
- operations
- architecture
target_files:
- src/operations/mod.rs
- src/operations/cancel.rs
- src/operations/archive.rs
- src/operations/pause.rs
- src/operations/verify.rs
- src/mcp/handlers.rs
---
# Add missing operations: cancel, archive, pause, verify

## Context

The operations layer (`src/operations/`) only has 4 of ~8 mutating operations: create, finalize, reset, update. The missing ones — cancel, archive, pause, verify — are implemented inline in both `src/mcp/handlers.rs` and various `src/cmd/` files with **divergent behavior**:

**Cancel:**
- MCP (`handlers.rs:1624-1683`): calls `spec.set_status()` + `spec.save()` inline
- CLI (`cmd/spec/delete.rs`): same pattern but separate file

**Archive:**
- MCP (`handlers.rs:1685-1747`): uses `std::fs::rename` — no git, no date subdirectories
- CLI (`cmd/lifecycle/archive.rs`): uses `git mv`, date-based subdirectories, target file verification, auto-commit

**Pause:**
- MCP (`handlers.rs:2159-2221`): inline PID management + status change
- CLI (`cmd/pause.rs`): separate PID management + `--force` flag behavior

**Verify:**
- MCP (`handlers.rs` — tool_chant_verify): inline verification logic
- CLI (`cmd/verify.rs`): full verification with detailed output

## Task

For each missing operation:

1. Create the operation module in `src/operations/` with an Options struct and a public function
2. Extract the shared logic from the CLI implementation (it's the more complete one)
3. Update the MCP handler to call the new operation function
4. Update the CLI command to call the new operation function
5. Re-export from `src/operations/mod.rs`

**Important constraints:**
- Archive operation must use git-aware archiving (not bare `fs::rename`)
- Pause operation must handle PID management correctly
- Verify operation needs the verification runner logic accessible from library crate
- Keep MCP and CLI handlers as thin wrappers around the operations

## Acceptance Criteria

- [ ] `src/operations/cancel.rs` exists and is used by both MCP `tool_chant_cancel` and CLI
- [ ] `src/operations/archive.rs` exists and is used by both MCP `tool_chant_archive` and CLI
- [ ] `src/operations/pause.rs` exists and is used by both MCP `tool_chant_pause` and CLI
- [ ] `src/operations/verify.rs` exists and is used by both MCP `tool_chant_verify` and CLI
- [ ] MCP archive produces same result as CLI archive (date subdirectories, git staging)
- [ ] No inline spec mutation logic remains in MCP handlers for these 4 operations (handlers are thin wrappers)
- [ ] `cargo test` passes
- [ ] `cargo clippy -- -D warnings` passes