---
type: code
status: failed
labels:
- refactor
- work-engine
- dedup
target_files:
- src/cmd/work/single.rs
- src/cmd/work/executor.rs
---
# Refactor single.rs to use executor.rs shared functions

## Context

`src/cmd/work/executor.rs` already exists with shared functions extracted from the original spec 00b work:
- `validate_spec()` — lint, approval, dependency, quality checks
- `invoke_agent_for_spec()` — agent selection with rotation
- `collect_commits_for_spec()` — commit fetching
- `handle_acceptance_criteria()` — unified AC policy
- `finalize_completed_spec()` — finalization logic
- `cleanup_completed_spec()` — output and transcript
- `handle_spec_failure()` — error status transitions

These functions currently have `#[allow(dead_code)]` because no mode file uses them yet.

## Task

Refactor `single.rs` (currently ~1,000 LOC) to delegate to `executor.rs` shared functions. `single.rs` should only contain:
- Spec selection (wizard or direct ID)
- Worktree creation
- Calling executor functions in sequence
- Single-mode-specific UX (interactive prompts, quality score display)

All duplicated validation, agent invocation, commit collection, finalization, and error handling should route through executor functions.

## Acceptance Criteria

- [x] `single.rs` is under 500 LOC (reduced from ~1000 to ~434)
- [x] `single.rs` calls executor shared functions for validation, agent invocation, commit collection, finalization, and error handling
- [x] Approval checking uses executor's `validate_spec()`
- [x] Dependency checking uses executor's `validate_spec()`
- [x] All existing tests pass
- [x] `cargo clippy` passes