---
type: code
status: completed
labels:
- refactor
- utilities
target_files:
- src/git.rs
- src/cmd/spec.rs
- src/cmd/template.rs
- src/cmd/derive.rs
commits:
- a6998a7
completed_at: 2026-01-30T14:42:09Z
model: opus
---
# Extract Git utilities to src/git.rs

## Problem

Git config reading code is duplicated in 3 files:
- `src/cmd/spec.rs` (lines ~54-71)
- `src/cmd/template.rs` (lines ~315-330)
- `src/cmd/derive.rs` (lines ~90-107)

Each file has its own implementation of reading git user.name and user.email config values.

## Solution

Add utility functions to `src/git.rs` and update all callers to use them. This consolidates the duplicated code into a single location.

## Acceptance Criteria

- [x] Add `get_git_config(key: &str) -> Option<String>` to `src/git.rs`
- [x] Add `get_git_user_info() -> (Option<String>, Option<String>)` to `src/git.rs`
- [x] Update `src/cmd/spec.rs` to use new utilities
- [x] Update `src/cmd/template.rs` to use new utilities
- [x] Update `src/cmd/derive.rs` to use new utilities
- [x] Remove duplicated code from all three files
- [x] All tests pass

## Agent Output

2026-01-30T14:42:09Z

```
I'll implement this spec to extract Git utilities to `src/git.rs`. Let me start by reading the relevant files to understand the current implementation.
I've found the duplicated code in all three files. They all have nearly identical implementations for reading `git config user.name` and `git config user.email`. Now let me add the utility functions to `src/git.rs`.
Now let me read more context from each file to see the imports and update them properly.
Now I can see that all three files already have `use chant::git;` and `use std::process::Command;`. I need to update them to use the new git utilities and remove the `Command` import if it's no longer needed. Let me update each file.

First, let me update `src/cmd/spec.rs`:
Now let me update `src/cmd/template.rs`. Let me first check if `Command` is used elsewhere in that file.
The file has other uses of `Command` besides the git config reads, so I can't remove the import. Let me update the git user info code.
Now let me check if `Command` is used elsewhere in `derive.rs`:
`Command` is only used for the git config reads in `derive.rs`, so I can remove that import.
Now let me run `cargo fmt`, `cargo clippy`, and the tests to verify everything works.
I see - `Command` is used elsewhere in `spec.rs` (in test code). Let me restore the import for spec.rs. The clippy errors about existing code are pre-existing issues, not from my changes.
There are `Command` usages outside of tests in spec.rs. Let me check the non-test code in the file to see where `Command` is used.
I see - there are many uses of `Command` both inside and outside of tests. I need to restore the unconditional import. Let me fix it.
The build is successful. The clippy warnings about pre-existing code in `git.rs` tests and `conflict.rs` tests are outside my scope. Let me now run the tests to verify everything works correctly.
All tests pass. Let me now update the spec file to check off the acceptance criteria and then commit the changes.
Now let me commit the changes.
The spec has been completed successfully. Here's a summary of what was done:

## Summary

**Spec:** 2026-01-30-00k-di7 - Extract Git utilities to src/git.rs

### Changes Made

1. **Added to `src/git.rs`:**
   - `get_git_config(key: &str) -> Option<String>` - Generic function to read any git config value
   - `get_git_user_info() -> (Option<String>, Option<String>)` - Convenience function that returns both user.name and user.email

2. **Updated `src/cmd/spec.rs`:**
   - Replaced 18 lines of duplicated git config reading code with 4 lines using the new utilities

3. **Updated `src/cmd/template.rs`:**
   - Replaced 16 lines of duplicated code with 4 lines using the new utilities

4. **Updated `src/cmd/derive.rs`:**
   - Replaced 18 lines of duplicated code with 4 lines using the new utilities
   - Removed the now-unused `std::process::Command` import

### Results
- All acceptance criteria checked off
- Code formatted with `cargo fmt`
- Build passes
- All 391 tests pass
- Changes committed with message: `chant(2026-01-30-00k-di7): Extract git config utilities to src/git.rs````
