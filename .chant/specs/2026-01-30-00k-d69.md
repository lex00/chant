---
type: code
status: in_progress
target_files:
- src/templates.rs
---
# Fix Windows CI - test_inject_chant_section_idempotent still failing after 2mk fix

## Problem

The 2mk fix normalized line endings in `existing_section` but not in the template `section` when comparing for idempotency. On Windows, when Git checks out files with CRLF (autocrlf), the `include_str!` macro reads template files with `\r\n` line endings. This causes the comparison to fail because:

1. `existing_normalized` = normalized to `\n` (line 221)
2. `section` = still has `\r\n` from the template file
3. Comparison fails even though content is logically identical

## Solution

Normalize both strings before comparison by also converting `section` line endings from `\r\n` to `\n`.

## Acceptance Criteria

- [x] Normalize both `existing_section` and `section` before comparison
- [x] Ensure test_inject_chant_section_idempotent passes locally
- [x] Run cargo fmt
- [x] Run cargo clippy
- [x] Run all tests with just test
- [x] Commit with proper message
model: sonnet