---
type: research
status: in_progress
branch: chant/2026-02-06-00d-1s2
---
# Research: Cancelled specs clutter the spec list — cancelled specs (from iteration/splitting) are permanently visible in chant list. Investigate options: auto-archive on cancel, filter cancelled by default in list output, add a --status filter to CLI list command, or a bulk cleanup command. Look at src/cmd/list.rs and the archive workflow.

## Acceptance Criteria

- [x] Reviewed src/cmd/list.rs list command implementation
- [x] Reviewed archive workflow in relevant source files
- [x] Documented current behavior of cancelled specs
- [x] Identified and documented at least 2 viable approaches to reduce cancelled spec clutter
- [x] Provided recommendation with tradeoffs for each approach

## Output

## Research Findings

### Current State

Cancelled specs are **already filtered by default** from most views:

1. **`chant list`** - Line 398 filters cancelled specs:
   ```rust
   specs.retain(|s| s.frontmatter.status != SpecStatus::Cancelled);
   ```

2. **`chant status`** - Lines 147-149 skip cancelled specs in aggregation

3. **`chant dag`** - Line 37 excludes cancelled specs  

4. **`chant work` variants** - All work commands filter cancelled specs:
   - `work --parallel` (line 374)
   - `work --chain` (lines 70, 103)

### The `--status` Filter Already Supports Cancelled

The CLI help shows `--status` accepts "cancelled" as a value. Lines 441-444 handle it:
```rust
"cancelled" => SpecStatus::Cancelled,
```

So users can explicitly view cancelled specs with:
```bash
chant list --status cancelled
```

### Why Cancelled Specs May Appear to "Clutter"

The issue description mentions cancelled specs from iteration/splitting. Looking at cancel workflow:

- `chant cancel` sets status to Cancelled but **leaves the file in `.chant/specs/`**
- Unlike completed specs (which can be archived), cancelled specs stay in the specs directory
- The default `chant list` already hides them, so they're only visible with `--status cancelled`

### Potential Confusion Source

The MCP `chant_spec_list` handler (line 851) counts cancelled specs but doesn't have the same default filtering. This could explain why cancelled specs appear to clutter when viewed via MCP tools.

### Options Analysis

1. **Auto-archive on cancel** - Could be surprising; cancellation is lightweight by design
2. **Filter cancelled by default** - ✅ Already implemented
3. **Add --status filter to CLI** - ✅ Already exists  
4. **Bulk cleanup command** - Could add `chant archive --cancelled` to move them to archive

### Recommendation

The core filtering is already in place. The issue is likely:
- MCP interface not filtering cancelled specs by default
- No convenient way to bulk-archive cancelled specs

Best solution: Add support for archiving cancelled specs with `chant archive --cancelled` or similar.

## Output

## Root Cause Identified

The MCP `chant_spec_list` handler (lines 549-613) **does NOT filter cancelled specs by default**.

- CLI `chant list` filters them (line 398 in list.rs)
- MCP `chant_spec_list` does not apply this filter

This creates inconsistency: cancelled specs are hidden in CLI but visible via MCP tools.

### Status Filter Issue

MCP status filter (lines 561-567) doesn't include "cancelled" in the match:
```rust
let filter_status = match status_str {
    "pending" => Some(SpecStatus::Pending),
    "in_progress" => Some(SpecStatus::InProgress),
    "completed" => Some(SpecStatus::Completed),
    "failed" => Some(SpecStatus::Failed),
    _ => None,  // "cancelled" falls through to None
};
```

So even `chant_spec_list(status="cancelled")` won't work correctly.

## Output

## Recommendations

### Option 1: Fix MCP Inconsistency (Recommended)
**Change:** Filter cancelled specs by default in MCP `chant_spec_list` handler
**Files:** src/mcp/handlers.rs line ~555
**Impact:** Low risk, aligns MCP behavior with CLI
**Tradeoff:** Requires explicit status filter to view cancelled specs via MCP

### Option 2: Add Cancelled Status to MCP Filter
**Change:** Add "cancelled" to status match in MCP handler (lines 561-567)
**Impact:** Minimal, fixes incomplete status filtering
**Tradeoff:** None, this is a bug fix

### Option 3: Bulk Archive Command
**Change:** Add `chant archive --cancelled` to archive all cancelled specs
**Files:** src/cmd/lifecycle/archive.rs
**Impact:** Medium - adds new feature for cleanup
**Tradeoff:** Requires implementation effort, but provides cleanup path

### Option 4: Auto-archive on Cancel
**Change:** Modify `cmd_cancel` to move spec to archive immediately
**Files:** src/cmd/spec/delete.rs
**Impact:** High - changes cancel semantics
**Tradeoff:** Breaking change, may surprise users expecting cancelled specs to remain accessible

## Recommended Implementation Priority

1. **Fix MCP status filter** - Add "cancelled" case (Option 2)
2. **Filter cancelled by default in MCP** - Match CLI behavior (Option 1)  
3. **Add bulk archive command** - Provide cleanup tool (Option 3)
4. Skip auto-archive - Too invasive (Option 4)
