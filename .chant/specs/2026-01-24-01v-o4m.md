---
type: code
status: completed
target_files:
- src/main.rs
model: claude-haiku-4-5-20251001
---
# Archive command should wait for all group members to complete

## Problem

The archive command doesn't respect spec groups. It can:
1. Archive a driver spec while its members are still pending/in_progress
2. Archive member specs while the driver is still pending

This breaks the group relationship and can leave orphaned specs.

## Expected Behavior

1. **Driver specs**: Only archive if ALL member specs are completed (or already archived)
2. **Member specs**: Only archive if the driver is also being archived (or already archived)
3. **Archive group together**: When archiving a driver, also archive all its completed members

## Implementation

In `cmd_archive()`, before adding a spec to `to_archive`:

1. If spec is a driver (type: group), check all members are completed
2. If spec is a member, check driver is also being archived or already archived
3. Add `--include-members` flag to archive driver + all members together

## Acceptance Criteria

- [x] Skip driver specs if any member is not completed (log warning)
- [x] Skip member specs if driver is not being archived (unless driver already archived)
- [x] Add `--include-members` flag to archive driver and all its members together
- [x] When archiving a driver with `--include-members`, archive all completed members too
- [x] Add warning when skipping specs due to group constraints
- [x] Test: driver with incomplete members is not archived
- [x] Test: driver with all complete members IS archived
- [x] Test: `--include-members` archives driver and members together