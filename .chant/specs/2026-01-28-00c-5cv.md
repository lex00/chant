---
type: code
status: completed
model: claude-opus-4-5-20251101
completed_at: 2026-01-28
---
# Fix integration test failures - relative path breaks after directory change

## Problem

15 integration tests are failing in CI with "No such file or directory" errors. The issue:

1. Tests build chant with `cargo build --bin chant`
2. Store binary path as **relative** `PathBuf::from("target/debug/chant")`
3. Change current directory with `std::env::set_current_dir(&repo_dir)` to `/tmp/test-*`
4. Try to execute `chant_binary` which is still `target/debug/chant`
5. Fail because `target/debug/chant` doesn't exist relative to `/tmp/test-*`

Example failing test:
```rust
let chant_binary = CHANT_BINARY.get_or_init(|| {
    // ...build...
    PathBuf::from("target/debug/chant")  // ← Relative path!
});
std::env::set_current_dir(&repo_dir).expect(...);  // ← Change to /tmp/test-*
Command::new(chant_binary)  // ← Fails: /tmp/test-*/target/debug/chant doesn't exist
```

Affected tests:
- `test_dependency_chain_updates_after_completion`
- `test_dependency_chain_updates`
- `test_force_flag_bypasses_dependency_check`
- `test_dependency_status_after_direct_file_edit`
- `test_invalid_regex_pattern_graceful_failure`
- `test_no_derivation_when_config_empty`
- `test_partial_env_vars_available`
- `test_parallel_work_and_merge_workflow`
- `test_silent_mode_branch_warning`
- `test_force_flag_shows_skipped_dependencies`
- `test_driver_auto_completes_with_real_commits`
- `test_silent_mode_exclude_file_structure`
- `test_no_derivation_when_enterprise_derived_empty`
- `test_parallel_dependency_resolution`
- `test_silent_mode_init_on_tracked_fails`

## Solution

Convert relative paths to **absolute paths** before changing directories:

```rust
let chant_binary = CHANT_BINARY.get_or_init(|| {
    let output = Command::new("cargo")
        .args(["build", "--bin", "chant"])
        .output()
        .expect("Failed to build chant");
    assert!(output.status.success(), "Failed to build chant");

    // Convert to absolute path BEFORE changing directories
    std::env::current_dir()
        .expect("Failed to get current dir")
        .join("target/debug/chant")
});
```

Or use the existing `get_chant_binary()` helper which already handles this correctly.

## Acceptance Criteria

- [x] Read failing tests and identify all that use relative `PathBuf::from("target/debug/chant")`
- [x] Fix each test to use absolute path via `std::env::current_dir().join("target/debug/chant")`
- [x] Alternatively, replace custom binary resolution with existing `get_chant_binary()` helper
- [x] Run all integration tests locally and verify they pass
- [x] Verify clippy and fmt still pass
- [x] All tests passing
- [x] Code linted and formatted