---
type: code
status: in_progress
target_files:
- src/cmd/work.rs
---
# Auto-finalize in chant work after agent exits, based on lint results

## Problem

Agents forget to call `chant finalize`, leaving specs in bad states (failed with unchecked criteria, or in_progress forever). We have `chant finalize` but it relies on agents remembering to call it.

## Solution

After the agent exits in `chant work`:

1. Check if agent made a commit (indicates work was done)
2. Run lint checks on the spec
3. If all criteria checked and lint passes → auto-finalize
4. If criteria unchecked → fail with clear message telling agent what's missing
5. If lint has warnings → show them but still allow finalize if criteria checked

Flow:
```
Agent exits
    ↓
Check for commit? ──no──→ Mark failed (no work done)
    ↓ yes
Lint spec
    ↓
Criteria checked? ──no──→ Mark failed + show unchecked list
    ↓ yes
Auto-finalize → Mark completed with model/timestamp/commits
```

## Acceptance Criteria

- [ ] After agent exits, work.rs checks for chant commit
- [ ] If commit found, lint the spec
- [ ] If criteria all checked, auto-finalize
- [ ] If criteria unchecked, fail with clear message
- [ ] Remove manual "unchecked criteria" check since auto-finalize handles it
- [ ] `just lint` passes
- [ ] `just test` passes