---
type: code
status: completed
depends_on:
- 2026-02-07-00s-chz
labels:
- tests
- migration
target_files:
- tests/integration/dependency_test.rs
- tests/support/factory.rs
---
# Migrate dependency_test.rs to TestHarness/SpecFactory

## Context

`tests/integration/dependency_test.rs` (1,493 LOC, 17+ tests) tests dependency chains, resolution, cascade updates, and `--skip-deps`. Currently uses `common.rs`, manual git init, and custom helpers: `create_spec_with_dependencies()`, `update_spec_status()`, `run_chant_list()`.

After previous specs, TestHarness has git helpers and SpecFactory has `blocked_by()` and `as_markdown_with_deps()`.

## Task

1. Replace `common::setup_test_repo()` / `common::cleanup_test_repo()` with `TestHarness::new()`
2. Replace local `run_chant()` with `harness.run()`
3. Replace `create_spec_with_dependencies()` with SpecFactory's `as_markdown_with_deps()` + `harness.create_spec()`
4. Replace `update_spec_status()` with loading spec, updating status, and saving
5. Replace manual `/tmp` paths with harness-managed paths
6. Remove manual cleanup patterns

**Important**: Do NOT modify other test files. Only touch dependency_test.rs and support/ files.

**Note**: There are 2 pre-existing test failures (`test_force_flag_bypasses_dependency_check` and `test_force_flag_shows_skipped_dependencies`) caused by a worktree cleanup bug unrelated to this migration. These should remain failing â€” do not try to fix them.

## Acceptance Criteria

- [x] `integration/dependency_test.rs` uses TestHarness (no `common::` references)
- [x] No hand-written spec YAML strings (use SpecFactory)
- [x] No manual `/tmp` paths
- [x] All dependency_test tests pass (except the 2 pre-existing failures)
- [x] `cargo clippy` passes on the test file

## Output

Migrated dependency_test.rs to TestHarness/SpecFactory. All tests pass except 2 pre-existing failures.
