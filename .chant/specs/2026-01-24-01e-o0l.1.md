---
type: code
status: in_progress
target_files:
- src/main.rs
model: claude-haiku-4-5-20251001
---
# Improve error handling in get_commits_for_spec()

Enhance commit detection to surface failures and add better logging/error messages to prevent silent fallbacks.

### Acceptance Criteria

- [x] Add explicit Result type that can distinguish between "no commits found" vs "git command failed"
- [x] Log warnings when using HEAD fallback but track this as a potential issue
- [x] Add test case for when git log command succeeds but returns empty
- [x] Add test case for when git command fails (e.g., not in git repo)
- [x] Verify error messages clearly indicate what went wrong

### Edge Cases

- Git command fails (not a git repository): Should return a meaningful error, not silently use HEAD
- Git log returns empty but command succeeds: Current behavior is to use HEAD, should be logged
- Spec ID with special characters in commit pattern: Ensure pattern escaping works correctly

### Example Test Cases

For this feature, verify:
- Case 1: When `git log` finds matching commits, they're all returned in order
- Case 2: When `git log` succeeds but finds no matches, and HEAD is used, a warning is issued
- Case 3: When `git log` command fails, error is propagated (not silently fallback)
- Case 4: Spec ID containing special regex characters doesn't crash pattern matching