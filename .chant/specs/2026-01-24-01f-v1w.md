---
type: code
status: pending
target_files:
- src/main.rs
---
# Add chant diagnose command to check spec execution status

Diagnose why a spec might be stuck in `in_progress` or having issues.

## Usage

```bash
chant diagnose <spec-id>
```

## Output

```
Spec: 2026-01-24-01a-75r
Status: in_progress
Last Activity: 2026-01-24T15:39:09Z (2 hours ago)

Checks:
  ✓ Spec file exists
  ✓ Log file exists (1.2 KB)
  ✓ Log last modified: 2 hours ago
  ✗ No running process found
  ✓ Commit found: 8dcefda
  ✗ Status mismatch: in_progress but has commit

Diagnosis: Spec appears complete but wasn't finalized.
Suggestion: Run `chant finalize 01a` to fix.
```

## Checks to Perform

1. **Spec file** - Does it exist? Is it valid YAML?
2. **Log file** - Exists? Size? Last modified time?
3. **Running process** - Check for claude process with CHANT_SPEC_ID env var
4. **Lock file** - Is there a .chant/locks/{spec-id}.lock?
5. **Git commit** - Does a commit with `chant(spec-id)` exist?
6. **Status consistency** - Does status match evidence (commit exists but status != completed)?
7. **Acceptance criteria** - Are all checked but status != completed?

## Acceptance Criteria

- [ ] Add `Diagnose` subcommand to CLI
- [ ] Check spec file validity
- [ ] Check log file existence and recency
- [ ] Check for running processes (optional - may need platform-specific code)
- [ ] Check for matching git commits
- [ ] Detect status mismatches
- [ ] Provide actionable suggestions
- [ ] All tests pass
