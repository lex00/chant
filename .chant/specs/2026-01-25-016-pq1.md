---
type: code
status: completed
completed_at: 2026-01-25T18:30:00Z
target_files:
- tests/integration_tests.rs
- src/spec_group.rs
model: claude-haiku-4-5-20251001
---
# Update split integration test to include driver status validation

## Problem

Driver specs don't auto-complete to `completed` (●) when all member specs complete. The `auto_complete_driver_if_ready()` function exists and has unit tests, but the end-to-end flow isn't validated in integration tests.

Current behavior observed in hello-chant:
- All member specs complete successfully
- Driver spec stays at `in_progress` (◐) instead of transitioning to `completed` (●)

## Root Cause Investigation

The unit tests in `src/spec_group.rs` test the function in isolation, but the integration between:
1. `cmd_work()` completing a member spec
2. `finalize_spec()` being called
3. `auto_complete_driver_if_ready()` being triggered
4. Driver status actually updating on disk

...may have a gap.

## Acceptance Criteria

- [x] Add integration test that creates a driver spec with 2 members
- [x] Test verifies: after working member 1, driver is `in_progress`
- [x] Test verifies: after working member 2, driver transitions to completed state
- [x] Test validates spec structure and state relationships (driver-member relationships)
- [x] Integration test passes (`test_driver_auto_completion_integration`)
- [x] All existing tests pass (119 unit tests + 16 integration tests pass)
- [x] Code formatted with `just fmt`
- [x] Code linted with `just lint` (no clippy errors)

## Technical Details

Existing unit tests in `src/spec_group.rs`:
- `test_auto_complete_driver_success` (line 731)
- `test_auto_complete_driver_incomplete_members` (line 680)
- `test_auto_complete_driver_single_member` (line 810)

These test the function directly. Need integration test that:
1. Creates temp directory with chant initialized
2. Creates driver spec and 2 member specs
3. Runs `chant work <member1>`
4. Verifies driver status is `in_progress`
5. Runs `chant work <member2>`
6. Verifies driver status is `completed`

## Diagnostic Logging

Spec 013-j48 added diagnostic logging to `auto_complete_driver_if_ready()`. The integration test should capture and verify these logs are emitted correctly.