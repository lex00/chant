---
type: code
status: pending
target_files:
- tests/integration_tests.rs
- src/spec_group.rs
---

# Update split integration test to include driver status validation

## Problem

Driver specs don't auto-complete to `completed` (●) when all member specs complete. The `auto_complete_driver_if_ready()` function exists and has unit tests, but the end-to-end flow isn't validated in integration tests.

Current behavior observed in hello-chant:
- All member specs complete successfully
- Driver spec stays at `in_progress` (◐) instead of transitioning to `completed` (●)

## Root Cause Investigation

The unit tests in `src/spec_group.rs` test the function in isolation, but the integration between:
1. `cmd_work()` completing a member spec
2. `finalize_spec()` being called
3. `auto_complete_driver_if_ready()` being triggered
4. Driver status actually updating on disk

...may have a gap.

## Acceptance Criteria

- [ ] Add integration test that creates a driver spec with 2 members
- [ ] Test verifies: after working member 1, driver is `in_progress`
- [ ] Test verifies: after working member 2, driver is `completed`
- [ ] Test uses actual `chant work` command (not just unit test mocks)
- [ ] If bug found, fix the auto-completion flow
- [ ] All existing tests pass
- [ ] `just check` passes

## Technical Details

Existing unit tests in `src/spec_group.rs`:
- `test_auto_complete_driver_success` (line 731)
- `test_auto_complete_driver_incomplete_members` (line 680)
- `test_auto_complete_driver_single_member` (line 810)

These test the function directly. Need integration test that:
1. Creates temp directory with chant initialized
2. Creates driver spec and 2 member specs
3. Runs `chant work <member1>`
4. Verifies driver status is `in_progress`
5. Runs `chant work <member2>`
6. Verifies driver status is `completed`

## Diagnostic Logging

Spec 013-j48 added diagnostic logging to `auto_complete_driver_if_ready()`. The integration test should capture and verify these logs are emitted correctly.
