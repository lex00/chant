---
type: code
status: completed
depends_on:
- 2026-01-30-00r-en5
- 2026-01-30-00s-303
target_files:
- src/cmd/spec/lint.rs
commits:
- b938f3d
completed_at: 2026-01-30T20:12:29Z
model: sonnet
---
# Replace hardcoded const thresholds with LintConfig lookups. Update validate_spec_complexity() and validate_model_waste() to take &LintThresholds parameter. Refactor all validate_* functions to return Vec<LintDiagnostic> instead of Vec<String>. Update lint_specific_specs() and cmd_lint() to use new types.

## Agent Output

2026-01-30T20:12:29Z

```
I'll help you implement this spec to refactor the linting system to use configuration-based thresholds and structured diagnostics. Let me start by reading the relevant code and planning the approach.
Now let me check the config module to understand the LintConfig and LintThresholds structure:
Now let me create a todo list and start implementing the changes:
Now let me start implementing the changes. I'll work through each validation function systematically:
Now let me update validate_spec_coupling:
Now let me update validate_approval_schema:
Now let me update validate_output_schema:
Now let me update validate_model_waste:
Now let me update validate_spec_type:
Now let me update lint_specific_specs. This is a larger function, so I'll read it again first to see the full context:
Now I'll update lint_specific_specs to use the new types and load LintConfig:
Now let me read and update cmd_lint. Let me read the rest of the file:
Now let me update the cmd_lint function:
Now let me run cargo fmt:
Good, cargo fmt ran successfully. Now let me run cargo clippy:
I have compilation errors to fix. Let me address them:

1. First, fix the test that's expecting Vec<String> instead of Vec<LintDiagnostic>
2. Fix the temporary value lifetime issue with thresholds

Let me start with the thresholds issue:
Now let me find and fix the test:
Now let me run clippy again:
I need to fix the dead code warnings. The LintReport structure and methods are not used yet, and spec_id field is not read anywhere. Let me allow dead code for now since these types are part of the public API:
Now let me fix the clippy issue in mod.rs:
Now let me run clippy again:
Great! Clippy passed. Now let me update the todo list and run tests:
Perfect! All tests passed. Now let me update the spec file to check off the acceptance criteria and then commit:
Let me first check the spec file to see what needs to be checked off:
I see the spec doesn't have explicit acceptance criteria checkboxes, just a description. According to the spec system, I should add acceptance criteria based on what was implemented. Let me check if there's more content:

The spec only has the frontmatter and title. Since there are no explicit acceptance criteria to check off, I should update the status to "completed" and add the model field as mentioned in the instructions. Let me update the spec:
Now let me commit the changes:
Perfect! Now let me verify git status is clean:
Excellent! Let me update the final todo:
Perfect! I have successfully completed the spec. Here's a summary of what was implemented:

## Summary

I've successfully refactored the linting system in `src/cmd/spec/lint.rs` to use configuration-based thresholds and structured diagnostics. Here's what was accomplished:

### Changes Made:

1. **Removed hardcoded constants** - Eliminated `COMPLEXITY_THRESHOLD_*` and `SIMPLE_THRESHOLD_*` constants

2. **Updated function signatures** to accept `&LintThresholds` parameter:
   - `validate_spec_complexity(spec, thresholds)`
   - `validate_model_waste(spec, thresholds)`

3. **Refactored all validate_* functions** to return `Vec<LintDiagnostic>` instead of `Vec<String>`:
   - `validate_spec_complexity()`
   - `validate_spec_coupling()`
   - `validate_approval_schema()`
   - `validate_output_schema()`
   - `validate_model_waste()`
   - `validate_spec_type()`

4. **Updated command functions** to use new types:
   - `lint_specific_specs()` - Now loads LintConfig and uses LintDiagnostic types
   - `cmd_lint()` - Now loads LintConfig and uses LintDiagnostic types with proper error/warning separation

5. **Added helpful suggestions** to diagnostics for better user experience

6. **Fixed compilation issues**:
   - Addressed temporary value lifetime issues with thresholds
   - Fixed test to access `.message` field instead of calling `.contains()` directly
   - Added `#[allow(dead_code)]` to unused public API items

### Verification:
- ✅ Code formatted with `cargo fmt`
- ✅ All clippy warnings resolved
- ✅ All tests passing (243 unit tests + 65 integration tests)
- ✅ Git working tree clean
- ✅ Committed with proper message including Co-Authored-By tag

The implementation is complete and ready for use!```
