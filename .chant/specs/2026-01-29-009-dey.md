---
type: code
status: in_progress
---
# Diagnose and fix chant list performance issue

## Problem

`chant list` rendering is slow (~0.867 seconds) even for 11 specs. Used to be instant (hundreds of specs printed immediately).

**Key insight from user:**
- `chant list | grep` is fast (data loading is fine)
- Full output rendering is slow (terminal display bottleneck)

**Observed:**
- Takes ~0.9 seconds to display 11 specs
- Used to be instant
- Output has emoji (üë§ ‚óè ‚Ü©), colors, and formatting

**Suspect causes:**
1. Terminal rendering overhead (emoji, colors, unicode)
2. Expensive formatting per spec (time ago calculation, git author lookup)
3. Flushing output per spec instead of batching
4. Recent code changes that added per-spec display operations

## Investigation Needed

1. **Profile git operations in list:**
   - List shows author (üë§ username) and activity time (‚Ü© 1h)
   - Are these running `git log` or `git show` per spec?
   - Count actual git subprocess calls

2. **Find recent changes:**
   - When was author/activity display added?
   - What commit introduced the slowdown?
   - Git blame on list display code

3. **Batch git operations:**
   - Can author lookups be batched?
   - Can we get all spec commits in one git command?
   - Cache git results across specs?

4. **Consider lazy loading:**
   - Only lookup author/activity when needed
   - Add `--simple` flag for fast list without metadata
   - Or make author/activity opt-in with `--verbose`

## Acceptance Criteria

- [x] Identify root cause of slowdown
- [x] Implement fix
- [x] Verify `chant list` is fast (<0.1s for 11 specs)
- [x] Add tests if needed
- [x] All tests passing

## Solution

**Root Cause:** Each spec in the list triggered 2 separate git subprocess calls:
- `get_file_creator()` - runs `git log --diff-filter=A --format=%an --follow -- <file>`
- `get_file_last_modified()` - runs `git log -1 --format=%aI -- <file>`

For 11 specs, this meant 22 git subprocess invocations, each with ~40ms overhead = ~0.9 seconds.

**Fix:** Replaced per-spec git calls with a batch loading approach:
1. Added `batch_load_spec_git_metadata()` function that uses a single git command to get metadata for all spec files
2. Limited git history traversal to last 200 commits for speed (sufficient for active specs)
3. Creator info only fetched when `--created-by` filter is used (requires full history scan)

**Performance:**
- Before: ~0.9 seconds for 11 specs
- After: ~0.055 seconds for 11 specs (16x faster)