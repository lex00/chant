---
type: code
status: completed
target_files:
- src/cmd/work.rs
model: claude-haiku-4-5-20251001
---
# Force branch mode internally for parallel execution

## Context

Parallel execution requires branch isolation to avoid merge race conditions. The fix in `01x-c70` serialized merges, but parallel still needs each spec to work in its own branch to function correctly.

## Requirement

When `chant work --parallel` is invoked:
1. Internally force branch mode for each spec, regardless of user's config
2. Each spec gets its own branch (`spec/{spec-id}`)
3. After all work completes, merge branches sequentially (already implemented in 01x-c70)
4. User's config (`defaults.branch`) is not modified
5. This behavior is transparent - user doesn't need to know or care

## Current Behavior

```bash
# User in direct-commit mode (defaults.branch: false)
chant work --parallel
# Specs try to commit directly to main, causing race conditions
```

## Expected Behavior

```bash
# User in direct-commit mode (defaults.branch: false)
chant work --parallel
# Internally: each spec works on spec/{id} branch
# After all complete: branches merged sequentially to main
# Result: clean commits on main, no race conditions
```

## Implementation

In `cmd_work_parallel()`:
- Override `is_branch_mode = true` for all parallel workers
- Create branch per spec as normal
- Sequential merge phase already handles the rest (from 01x-c70)

## Acceptance Criteria

- [x] Parallel mode creates branches even when user config has `branch: false`
- [x] Branches are named `spec/{spec-id}`
- [x] User's config is not modified
- [x] Sequential merge after all work completes (already done)
- [x] All tests pass
- [x] Code linted