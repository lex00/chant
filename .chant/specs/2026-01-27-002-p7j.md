---
type: code
status: pending
labels:
  - ux
  - agent-compat
target_files:
  - src/main.rs
  - src/cmd/search.rs
  - src/cmd/spec.rs
  - src/prompt.rs
---

# Improve non-TTY error messages to show usage instead of TTY requirement

When commands with interactive wizard modes are run without required arguments in a non-TTY context, they should show helpful usage information instead of errors about TTY requirements. This prevents AI agents from incorrectly concluding that chant requires interactive mode.

## Problem

Current behavior when agent runs `chant search` (no query, no TTY):
```
Error: Interactive wizard requires a TTY
```

Agent interprets this as "chant requires interactive mode" and tells users chant can't be used non-interactively. This is incorrect - chant works fine with explicit arguments.

## Solution

When a command would launch a wizard but stdin is not a TTY:
1. Detect the non-TTY condition
2. Instead of erroring about TTY, print helpful usage information
3. Exit with code 0 (not an error) or a distinct exit code

### Example: `chant search` (no args, no TTY)

**Before:**
```
Error: Interactive wizard requires a TTY
```

**After:**
```
Usage: chant search <QUERY>

Examples:
  chant search "authentication"
  chant search --status pending "api"
  chant search --label bugfix

Run 'chant search --help' for all options.
```

### Example: `chant export` (no format, no TTY)

**Before:**
```
Error: Interactive wizard requires a TTY
```

**After:**
```
Usage: chant export --format <FORMAT>

Formats: json, csv, markdown

Examples:
  chant export --format json
  chant export --format csv --output specs.csv
  chant export --format markdown --status completed

Run 'chant export --help' for all options.
```

### Example: `chant work` (no spec, no TTY)

**Before:**
```
Error: Interactive spec picker requires a TTY
```

**After:**
```
Usage: chant work <SPEC_ID>

Examples:
  chant work 001-abc
  chant work 2026-01-27-001-abc
  chant work --parallel

Run 'chant work --help' for all options.
```

## Commands to Update

| Command | Wizard Trigger | Non-TTY Behavior |
|---------|---------------|------------------|
| `search` | No query arg | Show search usage |
| `export` | No format arg | Show export usage |
| `work` | No spec ID (picker mode) | Show work usage |
| `merge` | Confirmation prompt | Already handled (auto-proceeds) |

## Implementation

1. Create a helper function `print_usage_hint(command, examples)` in a shared location
2. In each command's wizard trigger point, check `atty::is(atty::Stream::Stdin)`
3. If not TTY, call the usage hint function instead of launching wizard
4. Exit with code 0 (informational) not error code

## Acceptance Criteria

- [ ] `chant search` (no args, no TTY) prints usage hint, not TTY error
- [ ] `chant export` (no format, no TTY) prints usage hint, not TTY error
- [ ] `chant work` (no spec, no TTY) prints usage hint, not TTY error
- [ ] Usage hints include concrete examples
- [ ] Exit code is 0 (not error) for usage hints
- [ ] Interactive mode still works when TTY is available
- [ ] `just lint` passes with no warnings

## Notes

- The `atty` crate is already used elsewhere in the codebase
- This is specifically for agent compatibility - humans with TTY get the wizard
- Consider adding a `--no-interactive` flag in future for explicit control
