---
type: code
status: in_progress
model: claude-opus-4-5-20251101
---
# Add worktree context to agent prompts - tell agents their execution environment (worktree path, branch, isolation)

## Acceptance Criteria

- [x] Add `WorktreeContext` struct to `prompt.rs` with worktree path, branch name, and isolation flag
- [x] Add `assemble_with_context()` function that accepts worktree context for prompt assembly
- [x] Add template variables: `{{worktree.path}}`, `{{worktree.branch}}`, `{{worktree.isolated}}`
- [x] Inject "Execution Environment" section into prompts when running in isolated worktree
- [x] Update parallel execution in `work.rs` to use `assemble_with_context()` with actual worktree info
- [x] Add tests for worktree context substitution
- [x] All tests pass
- [x] Code formatted with `cargo fmt` and passes `cargo clippy`