---
type: code
status: completed
depends_on:
- 2026-01-30-00e-y44.7
target_files:
- src/score/traffic_light.rs
commits:
- e29cf1c
completed_at: 2026-01-31T17:43:31Z
model: sonnet
---
# Traffic Light Logic and Suggestions

Combine dimension grades into traffic light status and generate actionable suggestions.

### Inherited Context

- Traffic light determines readiness: Ready (green), Review (yellow), Refine (red)
- Suggestions should be specific and actionable

### Acceptance Criteria

- [x] Implement `determine_status(score: &SpecScore) -> TrafficLight` function
- [x] Ready: Complexity â‰¤ B AND Confidence â‰¥ B AND AC Quality â‰¥ B
- [x] Refine: Any dimension is D OR Confidence is D
- [x] Review: All other cases (any dimension is C)
- [x] Implement `generate_suggestions(score: &SpecScore) -> Vec<String>` function
- [x] Suggestions based on failing dimensions (e.g., "Add more specific acceptance criteria" for low AC quality)

### Edge Cases

- If multiple dimensions fail, return multiple suggestions
- Isolation grade (optional) should not affect traffic light but can add suggestions
- Suggestions should be unique (no duplicates)

### Example Test Cases

- All grades A â†’ Ready, no suggestions
- Complexity B, Confidence C, AC A â†’ Review, suggestion: "Improve spec structure (add more bullets)"
- Complexity D â†’ Refine, suggestion: "Reduce criteria count or split spec"

### Requires

- Uses `SpecScore` and all grade types from Member 1
- Uses scoring functions from Members 2-7

### Provides

- `determine_status(score: &SpecScore) -> TrafficLight` - Returns traffic light status
- `generate_suggestions(score: &SpecScore) -> Vec<String>` - Returns actionable feedback

## Agent Output

2026-01-31T17:43:31Z

```
I'll implement the traffic light logic and suggestions for the chant spec scoring system. Let me start by reading the relevant code to understand the existing structure.
Good! I can see the structure. Now I need to implement the two functions: `determine_status` and `generate_suggestions`. Let me check if there are any other scoring functions I should be aware of.
Perfect! I can see there are separate modules for different scoring dimensions. Now let me update the TodoWrite and implement the functions.
Now I'll implement the `determine_status` function. Based on the spec requirements:
- Ready: Complexity â‰¤ B AND Confidence â‰¥ B AND AC Quality â‰¥ B
- Refine: Any dimension is D OR Confidence is D
- Review: All other cases (any dimension is C)
I noticed I made an error in the confidence and ac_quality match arms - I accidentally used `ComplexityGrade` instead of the correct types. Let me fix that:
Now let me add tests for these functions at the end of the test module:
I need to fix the clippy warning by using `is_some_and` instead of `map_or`:
Let me check the full output to see if there were any failures:
Perfect! All tests passed. Now I need to check off the acceptance criteria in the spec file and verify the implementation matches all requirements.
I notice that the target file in the spec is `src/score/traffic_light.rs`, but I implemented the functions in `src/scoring.rs`. Let me check if there's a `src/score/traffic_light.rs` file:
I see the pattern - there are separate modules. Let me check the mod.rs to see what's exported:
I see - I should create a new `traffic_light.rs` file in `src/score/` as specified in the spec. Let me look at one of the existing score modules to match the pattern:
Good! Now I understand the pattern. I need to create a new file `src/score/traffic_light.rs` with the functions I implemented, and move them from `src/scoring.rs`. Let me create the new file:
Now I need to update the mod.rs to export this module:
Now I need to remove the duplicate functions from src/scoring.rs since they're now in the proper location:
Let me find where these functions end so I can remove them:
Now let me remove the duplicate functions and their tests from scoring.rs. First, let me check where the tests for these functions are:
Now I'll remove the duplicate functions and tests from scoring.rs:
Now I need to remove the duplicate tests:
Wait, I see I accidentally left tests for determine_status in scoring.rs. Let me check what tests remain:
I need to remove those tests too. Let me find where they start:
Now let me run the tests and format the code again:
Great! All tests pass. Now let me update the spec file to check off the acceptance criteria:
Now I need to update the status to completed and add the model field:
Now let me commit the changes:
I need to also add the modified scoring.rs file. Let me check if it was modified:
Good, it seems scoring.rs wasn't tracked or was already committed. Now let me add the relevant files and commit:
Perfect! The git status is clean except for an untracked spec file which is not related to my work. Let me update the todo list:
Excellent! I have successfully completed the spec. Let me provide a summary of what was implemented:

## Summary

I have successfully implemented the traffic light logic and suggestions for the chant spec scoring system (spec 2026-01-30-00e-y44.8).

### What was implemented:

1. **Created `src/score/traffic_light.rs`** with two main functions:
   - `determine_status(score: &SpecScore) -> TrafficLight` - Combines dimension grades into an overall status:
     - **Ready (ðŸŸ¢)**: Complexity â‰¤ B AND Confidence â‰¥ B AND AC Quality â‰¥ B
     - **Refine (ðŸ”´)**: Any dimension is D
     - **Review (ðŸŸ¡)**: All other cases (any dimension is C)
   
   - `generate_suggestions(score: &SpecScore) -> Vec<String>` - Generates actionable feedback based on failing dimensions:
     - Complexity suggestions (reduce criteria count, split spec)
     - Confidence suggestions (improve structure, add details)
     - AC Quality suggestions (rewrite criteria to be imperative/testable)
     - Splittability suggestions (reduce coupling, break into subsections)
     - Isolation suggestions (reduce cross-references between members)

2. **Updated `src/score/mod.rs`** to export the new traffic_light module

3. **Comprehensive test coverage** with 11 tests covering:
   - All traffic light status transitions
   - Single and multiple dimension failures
   - Edge cases (no suggestions for all-A grades, isolation being optional)
   - Deduplication of suggestions

### All acceptance criteria met:
- âœ… Implemented `determine_status` function
- âœ… Ready logic: Complexity â‰¤ B AND Confidence â‰¥ B AND AC Quality â‰¥ B
- âœ… Refine logic: Any dimension is D
- âœ… Review logic: All other cases
- âœ… Implemented `generate_suggestions` function
- âœ… Suggestions based on failing dimensions

### Verification:
- âœ… Code formatted with `cargo fmt`
- âœ… No clippy warnings
- âœ… All

... (output truncated, 5148 chars total)```
