---
type: code
status: completed
depends_on:
- 2026-01-24-01e-o0l.3
target_files:
- src/main.rs
completed_at: 2026-01-24T23:00:00Z
commits:
- chant(2026-01-24-01e-o0l.4)
model: haiku
---
# Add idempotent re-finalization capability

Create a way to re-finalize a spec that may have been left in an incomplete state (like spec 01a-75r).

### Acceptance Criteria

- [x] Create a new function `re_finalize_spec()` that can be called on an in_progress or completed spec
- [x] re_finalize_spec() finds current commits and updates the spec (idempotent)
- [x] re_finalize_spec() can be called multiple times safely with same result
- [x] Add --finalize flag to `work` command to explicitly re-finalize a spec
- [x] Add confirmation prompt before re-finalizing (unless --force is used)
- [x] Test that re-finalizing updates commits and timestamps correctly

### Edge Cases

- Re-finalizing a spec that was left in_progress: Should complete it
- Re-finalizing a spec that's already completed: Should update commits/timestamp if new ones found
- Re-finalizing with no new commits: Should still update timestamp to current time
- Force flag bypasses confirmation prompt

### Example Test Cases

For this feature, verify:
- Case 1: Re-finalize an in_progress spec completes it
- Case 2: Re-finalize a completed spec updates the timestamps to now
- Case 3: Re-finalize is idempotent: running twice gives same result (except timestamps)
- Case 4: --force flag skips confirmation prompt
- Case 5: Partial spec ID matching still works with --finalize flag