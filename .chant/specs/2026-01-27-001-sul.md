---
type: code
status: pending
labels:
  - multi-repo
  - v0.4.0
target_files:
  - src/id.rs
  - src/spec.rs
  - src/main.rs
---

# Implement repo prefix parsing for cross-repo spec references

Add support for parsing spec IDs with an optional `repo:` prefix to enable cross-repository spec references.

## Context

The multi-repo design (see `docs/scale/multi-project.md`) requires spec IDs to optionally include a repository prefix:

```
backend:2026-01-22-001-x7m      # repo:id format
backend:auth-2026-01-22-001-x7m # repo:project-id format
2026-01-22-001-x7m              # local (no prefix)
```

The `repo:` prefix is optional - only needed when referencing specs in other repos.

## Design

### SpecId Struct Enhancement

```rust
pub struct SpecId {
    pub repo: Option<String>,      // NEW: Optional repo name
    pub project: Option<String>,   // Existing: Optional project prefix
    pub date: NaiveDate,
    pub sequence: String,
    pub suffix: String,
    pub member: Option<u32>,
}
```

### Parsing Rules

1. If ID contains `:`, split on first `:` to extract repo prefix
2. Repo names are alphanumeric with hyphens/underscores (e.g., `backend`, `my-repo`)
3. After extracting repo, parse remainder as normal spec ID
4. Validate repo name exists in global config (warn if not)

### Display Format

```rust
impl Display for SpecId {
    fn fmt(&self, f: &mut Formatter) -> fmt::Result {
        if let Some(repo) = &self.repo {
            write!(f, "{}:", repo)?;
        }
        // ... rest of existing format
    }
}
```

## Acceptance Criteria

- [ ] `SpecId` struct has optional `repo` field
- [ ] Parser handles `repo:id` format (e.g., `backend:2026-01-27-001-abc`)
- [ ] Parser handles `repo:project-id` format (e.g., `backend:auth-2026-01-27-001-abc`)
- [ ] Parser handles local IDs without prefix (backwards compatible)
- [ ] `SpecId::to_string()` includes repo prefix when present
- [ ] Invalid repo names (special chars, empty) return parse error
- [ ] Unit tests cover all parsing scenarios
- [ ] `just lint` passes with no warnings

## Notes

- This spec only adds parsing support - actual cross-repo resolution comes in 002-8nc
- Global config repos validation is optional (warn, don't fail)
- Keep backwards compatibility with all existing spec ID formats
