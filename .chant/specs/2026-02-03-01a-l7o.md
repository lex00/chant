---
type: code
status: in_progress
---
# Feature: Add `chant takeover` command and MCP tool for mid-work intervention

## Summary
Allow users to intervene when a `chant work` session isn't going well. The user's agent session can "takeover" the spec, stopping the autonomous agent and continuing with human guidance.

## User Story
"I see chant working on a spec but it's going in the wrong direction. I want to tell my agent to take over, analyze what went wrong, and continue with my guidance."

## Implementation

### CLI Command: `chant takeover <spec-id>`
```bash
chant takeover 019-gus
```

### What it does:
1. **Stop running work** - Kill the agent process working on this spec
   - Need new `chant stop <id>` or extend cancel: `chant cancel --stop` (soft stop, doesn't change status)
   - Set status back to `pending` or new `paused` status
2. **Read and analyze log** - Parse `.chant/logs/<spec-id>.log`
3. **Generate analysis** - Summarize what the agent attempted, where it got stuck
4. **Update spec** - Append analysis to spec body as `## Takeover Analysis` section
5. **Return control** - Spec is ready for manual work or re-execution

### MCP Tool: `chant_takeover`
```json
{
  "name": "chant_takeover",
  "params": { "id": "spec-id" },
  "returns": {
    "spec": "updated spec content",
    "analysis": "what went wrong",
    "log_tail": "last N lines of log",
    "suggestion": "recommended next steps"
  }
}
```

### Flow for MCP user (Cursor/Claude):
1. User: "This spec is going wrong, take it over"
2. Agent calls `chant_takeover` via MCP
3. Gets analysis and updated spec
4. Agent continues working on spec in current session
5. When done, calls `chant_finalize` or `chant merge`

### Stopping mechanism
Options:
- A) New `chant stop <id>` command - stops work without cancelling
- B) `chant cancel --pause` - stops and sets status to `paused`
- C) Use PID file in `.chant/pids/<spec-id>.pid` for process control

Recommend option A or B.

### Status considerations
- New status `paused`? Or just revert to `pending`?
- Need to preserve partial work (commits on branch)
- Log file should be preserved for analysis

## Acceptance Criteria

- [ ] Add `chant stop <spec-id>` command to stop running work
- [ ] Add `chant takeover <spec-id>` command
- [ ] Implement log analysis (parse log, identify last actions, errors)
- [ ] Update spec body with takeover analysis section
- [ ] Add `chant_takeover` MCP tool
- [ ] Preserve branch and partial commits during takeover
- [ ] Handle case where spec isn't currently running
- [ ] Add --force flag to takeover even if not running