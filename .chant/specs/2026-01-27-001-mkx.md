---
type: code
status: completed
target_files:
- src/config.rs
model: claude-haiku-4-5-20251001
---
# Add enterprise config schema and parsing

## Problem

The enterprise derived frontmatter feature requires configuration schema to define:
- Field derivation rules (which fields to derive, from what source, using what pattern)
- Validation rules (enum checking, required fields)
- This configuration must integrate with existing Config system

Currently, the `Config` struct in `src/config.rs` has no enterprise-specific fields.

## Solution

Extend the configuration system to support enterprise features with these structures:

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct EnterpriseConfig {
    #[serde(default)]
    pub derived: HashMap<String, DerivedFieldConfig>,
    #[serde(default)]
    pub required: Vec<String>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct DerivedFieldConfig {
    pub from: DerivationSource,
    pub pattern: String,
    #[serde(default)]
    pub validate: Option<ValidationRule>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum DerivationSource {
    Branch,
    Path,
    Env,
    GitUser,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(rename_all = "snake_case")]
pub enum ValidationRule {
    Enum { values: Vec<String> },
}
```

Add `enterprise` field to main `Config` struct and ensure it defaults to empty (no-op).

## Acceptance Criteria

- [x] Add `EnterpriseConfig` struct with `derived` and `required` fields
- [x] Add `DerivedFieldConfig` struct with `from`, `pattern`, `validate` fields
- [x] Add `DerivationSource` enum (Branch, Path, Env, GitUser)
- [x] Add `ValidationRule` enum with Enum variant
- [x] Add `enterprise` field to main `Config` struct with proper defaults
- [x] Config parsing handles missing enterprise section (defaults to empty)
- [x] Add unit tests for parsing enterprise config from YAML
- [x] Add unit tests that config works when enterprise section is omitted
- [x] All existing tests still pass