---
type: code
status: pending
depends_on: []
target_files:
- src/cmd/watch.rs
- .chant/logs/watch.log
---
# Structured logging with timestamps and file output

Implement logging infrastructure for watch command, with structured stdout messages and persistent log file in `.chant/logs/watch.log`.

### Acceptance Criteria

- [x] `WatchLogger` with `log_event(message)` writes to stdout and file
- [x] Timestamp format: `[HH:MM:SS]` prefix for all messages
- [x] Log file: `.chant/logs/watch.log`, append mode, create dir if missing
- [x] Structured messages: "Watching X specs", "Spec Y completed → finalizing", etc.
- [x] Flush file on each write (ensure visibility during long runs)

### Edge Cases

- `.chant/logs/` directory missing: Create it
- Log file unwritable (permissions): Error clearly, fall back to stdout-only
- Very long spec IDs: Truncate in stdout, full in file
- Rapid events (many specs completing): Ensure interleaved logs are readable

### Example Test Cases

- Log 3 events → stdout and file both contain all 3 with timestamps
- Log directory missing → creates directory, writes file
- Simulate file permission error → logs warning, continues with stdout


- `WatchLogger` struct or logging functions
- `log_event(message: &str)` - Writes to stdout and file
- `init_watch_logger() -> Result<WatchLogger>` - Errors if log setup fails