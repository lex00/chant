---
type: code
status: pending
target_files:
  - src/cmd/work.rs
  - src/spec.rs
model: claude-opus-4-5-20251101
---

# Improve blocked spec error messages with blocker status

## Problem

When a spec is blocked, the error message doesn't show which dependencies are blocking it or their current status, making debugging difficult.

**Current Error:**
```
Error: Spec 2026-01-27-00t-bfs is not ready
```

**What Users Need:**
```
Error: Spec 2026-01-27-00t-bfs is blocked by dependencies

Blocking dependencies:
  ● 2026-01-27-00s-c9e Assemble complete nodes.edn schema
    Status: completed
    Completed at: 2026-01-27T18:50:18Z
    ⚠️  This dependency is complete but spec still shows as blocked - this may be a bug

Next steps:
  1. Run 'chant refresh' to update dependency status
  2. Use 'chant work 00t-bfs --force' to override dependency checks
  3. Check 'chant show 00s-c9e' to verify dependency completion

Tip: If the dependency is truly complete, this is likely a dependency resolution bug
```

## Solution

Add helper method to Spec to get blocking dependencies with their status:

```rust
// In src/spec.rs
impl Spec {
    pub fn get_blocking_dependencies(&self, all_specs: &[Spec]) -> Vec<BlockingDependency> {
        let mut blockers = vec![];

        for dep_id in &self.frontmatter.depends_on {
            if let Some(dep_spec) = all_specs.iter().find(|s| s.id == *dep_id) {
                let dep_spec_fresh = Spec::load(&format!(".chant/specs/{}.md", dep_id))
                    .unwrap_or_else(|_| dep_spec.clone());

                blockers.push(BlockingDependency {
                    spec_id: dep_spec_fresh.id.clone(),
                    title: dep_spec_fresh.title.clone(),
                    status: dep_spec_fresh.status.clone(),
                    completed_at: dep_spec_fresh.frontmatter.completed_at.clone(),
                });
            } else {
                blockers.push(BlockingDependency {
                    spec_id: dep_id.clone(),
                    title: None,
                    status: SpecStatus::Unknown,
                    completed_at: None,
                });
            }
        }

        blockers
    }
}

pub struct BlockingDependency {
    pub spec_id: String,
    pub title: Option<String>,
    pub status: SpecStatus,
    pub completed_at: Option<String>,
}
```

Update error message in cmd_work:

```rust
// In src/cmd/work.rs
if !spec.is_ready(&all_specs) {
    let blockers = spec.get_blocking_dependencies(&all_specs);

    eprintln!("Error: Spec {} is blocked by dependencies\n", spec.id);
    eprintln!("Blocking dependencies:");

    for blocker in blockers {
        let status_indicator = match blocker.status {
            SpecStatus::Completed => "●",
            SpecStatus::InProgress => "◐",
            _ => "○",
        };

        eprintln!("  {} {} {}",
                  status_indicator,
                  blocker.spec_id,
                  blocker.title.unwrap_or_default());

        eprintln!("    Status: {:?}", blocker.status);

        if let Some(completed_at) = blocker.completed_at {
            eprintln!("    Completed at: {}", completed_at);
            eprintln!("    ⚠️  This dependency is complete but spec still shows as blocked");
        }
    }

    eprintln!("\nNext steps:");
    eprintln!("  1. Run 'chant refresh' to update dependency status");
    eprintln!("  2. Use 'chant work {} --force' to override checks", spec.id);
    eprintln!("  3. Check dependency details with 'chant show <dep-id>'");

    bail!("Spec blocked by dependencies");
}
```

## Acceptance Criteria

- [x] Add BlockingDependency struct to spec.rs
- [x] Add get_blocking_dependencies() method to Spec
- [x] Method reloads dependency specs from disk for fresh status
- [x] Update cmd_work error message to use new format
- [x] Show dependency status indicator (●○◐)
- [x] Show dependency title
- [x] Show current status
- [x] Show completed_at if dependency is completed
- [x] Add warning if dependency is complete but spec still blocked
- [x] Include actionable next steps in error
- [x] Add unit test for get_blocking_dependencies()
- [x] Add integration test: blocked spec shows detailed error
- [x] All existing tests pass