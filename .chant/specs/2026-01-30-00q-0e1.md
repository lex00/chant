---
type: code
status: pending
labels:
  - bug
  - ux
target_files:
  - src/main.rs
---

# Bug: fresh init skips provider prompt in some scenarios

## Problem

User reports: running `chant init` on a new project prompted for project name but NOT for provider. Had to run init again to configure provider.

Expected: Fresh init wizard should prompt for all essential config (name, provider, model, agent).

## Investigation

The init flow has two paths:

1. **Fresh init** (no `.chant/`): Full wizard with provider prompt (line ~1618)
2. **Existing init** (`.chant/` exists): Menu with "What would you like to configure?"

Potential causes:
- Partial `.chant/` from previous aborted init → triggers menu path
- Menu defaults to "Exit (no changes)" → easy to accidentally skip
- Config created without provider during partial init

## Root Cause Hypothesis

If user runs init, it creates `.chant/config.md` early in the flow. If they Ctrl+C or error occurs mid-wizard, the directory exists but config is incomplete.

Next `chant init` sees `.chant/` exists → shows menu instead of full wizard → user selects wrong option or exits.

## Solution

1. **Atomic init**: Don't create `.chant/` until wizard completes successfully
2. **Or**: Detect incomplete config and re-run full wizard
3. **Or**: Menu should show "Re-run full setup wizard" option for existing projects

## Acceptance Criteria

- [ ] Identify exact scenario that skips provider prompt
- [ ] Fresh init on truly empty project always prompts: name → templates → silent → provider → model → agent
- [ ] Partial/incomplete `.chant/` triggers full wizard, not menu
- [ ] Add "Re-run full setup" option to existing project menu
- [ ] Test: Ctrl+C during init, then re-run → should complete full wizard
- [ ] All tests pass
