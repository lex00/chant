---
type: code
status: completed
target_files:
- src/mcp.rs
- src/main.rs
- Cargo.toml
commits:
  - c2a36c9
completed_at: 2026-01-24T12:19:17Z
---
# Add MCP server with chant_spec_list tool

Implement an MCP (Model Context Protocol) server that exposes chant tools to AI agents via JSON-RPC over stdio.

## Acceptance Criteria

- [x] Create new `src/mcp.rs` module for MCP server implementation
- [x] Implement JSON-RPC 2.0 protocol over stdin/stdout
- [x] Handle `initialize` method to establish connection
- [x] Handle `tools/list` method to advertise available tools
- [x] Implement `chant_spec_list` tool that returns list of specs
- [x] Handle `tools/call` method to execute tool calls
- [x] Add `chant mcp` subcommand to start the MCP server

## Implementation Notes

- Use synchronous I/O (no async runtime needed for stdio)
- JSON-RPC format: `{"jsonrpc": "2.0", "method": "...", "params": {...}, "id": 1}`
- Response format: `{"jsonrpc": "2.0", "result": {...}, "id": 1}`
- The `chant_spec_list` tool should accept optional `status` parameter to filter
- Return specs as JSON in the tool result content

## Tool Schema for chant_spec_list

```json
{
  "name": "chant_spec_list",
  "description": "List all chant specs in the current project",
  "inputSchema": {
    "type": "object",
    "properties": {
      "status": {
        "type": "string",
        "description": "Filter by status (pending, in_progress, completed, failed)"
      }
    }
  }
}
```

## Agent Output

2026-01-24T12:19:17Z

```
The spec is complete. Here's a summary of what was verified:

**Implementation Summary:**

The MCP server implementation was already fully implemented in `src/mcp.rs`. I verified all acceptance criteria:

1. **`src/mcp.rs` module created** - 500 lines implementing the full MCP server
2. **JSON-RPC 2.0 protocol** - `JsonRpcRequest` and `JsonRpcResponse` structs with proper parsing and serialization
3. **`initialize` method** - Returns protocol version `2024-11-05`, server info, and capabilities
4. **`tools/list` method** - Returns `chant_spec_list` (plus `chant_spec_get` and `chant_spec_update` bonus tools)
5. **`chant_spec_list` tool** - Filters by optional `status` parameter, returns specs as JSON
6. **`tools/call` method** - Dispatches tool calls to appropriate handlers
7. **`chant mcp` subcommand** - Added in `main.rs:69` and calls `mcp::run_server()`

All 4 MCP tests pass and manual testing confirms the server works correctly over stdin/stdout.```
