---
type: research
status: in_progress
---
# CLI: Evaluate work command subcommands (batch/sequence) vs current flags

## Context

The `chant work` command currently uses flags to control execution mode:
- `--chain`: Sequential execution through ready specs
- `--parallel`: Concurrent execution of multiple specs
- Combined with spec IDs or filters (labels)

This evaluation considers whether the current flag-based design is optimal, or if subcommands would be clearer.

## Current Design (Flag-Based)

```bash
# Single spec
chant work 001

# Sequential execution
chant work --chain              # All ready specs
chant work --chain 001 002 003  # Specific specs in order
chant work --chain --label auth --chain-max 5

# Parallel execution
chant work --parallel           # All ready specs
chant work --parallel 001 002   # Specific specs
chant work --parallel --label feature --max 4
```

## Alternative Design (Subcommand-Based)

```bash
# Single spec (unchanged)
chant work 001

# Sequential execution with subcommand
chant work sequence             # All ready specs
chant work sequence 001 002 003 # Specific specs in order
chant work sequence --label auth --max 5

# Parallel execution with subcommand
chant work batch                # All ready specs
chant work batch 001 002        # Specific specs
chant work batch --label feature --max 4
```

## Evaluation Criteria

- [ ] Document current flag-based design (strengths, weaknesses)
- [ ] Document alternative subcommand design (strengths, weaknesses)
- [ ] Analyze discoverability (which is easier to learn/discover)
- [ ] Analyze consistency with common CLI patterns (git, cargo, etc.)
- [ ] Analyze command length and verbosity
- [ ] Assess migration path if change is recommended
- [ ] Recommend: keep current design OR migrate to subcommands
- [ ] If recommending migration, provide implementation plan

## Analysis Questions

1. **Discoverability**: Which approach is more intuitive for new users?
2. **Consistency**: How do similar tools (git, cargo, docker) handle this?
3. **Verbosity**: Is `--chain` vs `sequence` meaningfully different?
4. **Future extensibility**: Which design scales better for new modes?
5. **Breaking changes**: What's the migration cost if we change?

## Output

Produce a markdown analysis document in the spec body with:
- Comparison table
- CLI pattern analysis from similar tools
- Recommendation with justification
- Migration plan if recommending change

---

## Analysis

### 1. Current Flag-Based Design Analysis

**Strengths:**
- **Familiarity**: Flags are standard CLI patterns (e.g., `ls -la`, `grep -r`, `git commit -m`)
- **Composability**: Easy to combine with other flags (`--chain --label auth --chain-max 5`)
- **Brevity**: Shorter commands for common operations
- **Single mental model**: One command (`work`) with modes controlled by flags
- **No breaking change**: Already deployed and documented

**Weaknesses:**
- **Flag proliferation**: Multiple mode flags (`--chain`, `--parallel`) with mode-specific sub-flags (`--chain-max`, `--max`)
- **Mutual exclusivity unclear**: Without reading docs, not obvious that `--chain` and `--parallel` are mutually exclusive
- **Harder to document**: Flag combinations require careful explanation
- **Mode-specific flags**: `--chain-max` only works with `--chain`; `--max` only with `--parallel`

### 2. Alternative Subcommand Design Analysis

**Strengths:**
- **Explicit modes**: `chant work sequence` vs `chant work batch` makes the mode obvious
- **Clearer namespacing**: Mode-specific flags naturally belong to their subcommand
- **Better help organization**: `chant work sequence --help` shows only relevant flags
- **Scalability**: Easy to add new execution modes without flag conflicts
- **Discoverability**: `chant work --help` lists available modes upfront

**Weaknesses:**
- **Verbosity**: Longer commands (`work sequence` vs `work --chain`)
- **Breaking change**: Migration cost for existing users and scripts
- **Additional complexity**: More command structure to learn (subcommands + flags)
- **Deviation from current pattern**: Other chant commands use flags, not subcommands

### 3. Discoverability Comparison

**Flag-based (`chant work --help`):**
```
--chain              Chain through specs
--parallel           Execute specs in parallel
--chain-max <N>      Maximum specs to chain
--max <N>            Maximum parallel agents
```
Users must read flag descriptions to understand modes.

**Subcommand-based (`chant work --help`):**
```
SUBCOMMANDS:
    sequence    Execute specs sequentially
    batch       Execute specs in parallel
```
Modes are explicit; users then run `chant work sequence --help` for mode details.

**Winner**: Subcommands are more discoverable. New users see execution modes listed upfront.

### 4. Consistency with Common CLI Patterns

| Tool | Pattern | Example |
|------|---------|---------|
| **git** | Subcommands | `git log`, `git commit`, `git rebase` |
| **cargo** | Subcommands | `cargo build`, `cargo test`, `cargo run` |
| **docker** | Subcommands | `docker run`, `docker build`, `docker compose` |
| **kubectl** | Subcommands | `kubectl apply`, `kubectl get`, `kubectl delete` |
| **npm** | Subcommands | `npm install`, `npm run`, `npm test` |
| **terraform** | Subcommands | `terraform plan`, `terraform apply`, `terraform destroy` |

**Modern CLI convention**: Subcommands for verbs/modes, flags for options.

**Flags for modes** is less common in modern CLIs. When used, it's typically for simple binary choices (e.g., `ls -l` for long format).

**Winner**: Subcommands align better with modern CLI patterns.

### 5. Verbosity Analysis

| Operation | Flag-based | Subcommand-based | Difference |
|-----------|------------|------------------|------------|
| Single spec | `work 001` | `work 001` | Same |
| All ready sequential | `work --chain` | `work sequence` | +3 chars |
| Specific sequential | `work --chain 001 002` | `work sequence 001 002` | +3 chars |
| All ready parallel | `work --parallel` | `work batch` | -5 chars |
| Specific parallel | `work --parallel 001 002` | `work batch 001 002` | -5 chars |

**Analysis**: Verbosity is roughly equivalent. "sequence" is shorter than "--chain". "batch" is much shorter than "--parallel".

**Winner**: Tie with slight advantage to subcommands for parallel case.

### 6. Future Extensibility

**Potential future modes:**
- Dry-run mode (preview without executing)
- Retry mode (re-execute failed specs)
- Watch mode (continuous execution as specs become ready)

**Flag-based approach:**
```bash
work --dry-run --chain
work --retry --parallel
work --watch
```
Flags multiply; unclear which combinations are valid.

**Subcommand approach:**
```bash
work sequence --dry-run
work batch --dry-run
work watch
work retry --mode sequence
```
Clearer separation; each mode has its own flag namespace.

**Winner**: Subcommands scale better for new modes.

### 7. Comparison Table

| Criterion | Flag-based | Subcommand-based | Winner |
|-----------|------------|------------------|--------|
| Discoverability | Flags in long list | Modes listed upfront | Subcommands |
| CLI Consistency | Unusual pattern | Matches git/cargo | Subcommands |
| Verbosity | Slightly longer parallel | Slightly shorter | Tie |
| Extensibility | Flag proliferation | Clean namespaces | Subcommands |
| Migration Cost | Zero (current) | High (breaking) | Flags |
| Learning Curve | Single command model | Subcommand hierarchy | Flags |
| Help Organization | Mixed flags | Scoped per mode | Subcommands |

### 8. Migration Path Assessment

**If recommending migration:**

1. **Deprecation period**: Keep flags for 2-3 major versions
2. **Dual support**: Support both during transition
3. **Warnings**: Print deprecation warnings when using old flags
4. **Documentation**: Update all docs to show new style
5. **Scripts**: Update examples and CI templates
6. **Communication**: Announce in CHANGELOG, README, release notes

**Implementation phases:**
- **Phase 1**: Add subcommands, keep flags working
- **Phase 2**: Print deprecation warnings for flags
- **Phase 3**: Remove flag support (breaking change)

**Migration cost**: HIGH. Many users and scripts rely on current syntax.

---

## Recommendation

**Keep the current flag-based design.**

### Justification

While subcommands would be more discoverable and align better with modern CLI patterns, the **migration cost outweighs the benefits**:

1. **Breaking change impact**: Existing scripts, documentation, and muscle memory
2. **Current design is functional**: No critical usability issues reported
3. **Chant's scale**: Small user base; discoverability matters less than stability
4. **Documentation investment**: Extensive CLI reference already written for flags
5. **Consistency within chant**: Other commands use flags (e.g., `list --status`, `merge --all`)

### Improvements to Current Design (Non-Breaking)

Instead of migration, improve the current design:

1. **Better help text**: Make mutual exclusivity explicit
   ```
   Execution Modes (mutually exclusive):
     --chain              Execute specs sequentially
     --parallel           Execute specs in parallel
   ```

2. **Validation**: Error early if incompatible flags used together
   ```
   error: --chain and --parallel are mutually exclusive
   ```

3. **Consistent naming**: Consider aliasing:
   - `--sequential` as alias for `--chain` (clearer than "chain")
   - `--batch` as alias for `--parallel` (shorter)

4. **Documentation**: Add comparison table to CLI reference

### When to Reconsider

Reconsider subcommands if:
- User base grows significantly (1000+ users)
- User feedback consistently reports confusion
- Preparing for 2.0 release with other breaking changes
- Adding 3+ new execution modes (making flag space crowded)

---

## Acceptance Criteria Review

- [x] Document current flag-based design (strengths, weaknesses)
- [x] Document alternative subcommand design (strengths, weaknesses)
- [x] Analyze discoverability (which is easier to learn/discover)
- [x] Analyze consistency with common CLI patterns (git, cargo, etc.)
- [x] Analyze command length and verbosity
- [x] Assess migration path if change is recommended
- [x] Recommend: keep current design OR migrate to subcommands
- [x] If recommending migration, provide implementation plan