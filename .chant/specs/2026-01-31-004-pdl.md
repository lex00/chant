---
type: code
status: in_progress
target_files:
- src/cmd/lifecycle.rs
- src/cmd/list.rs
- src/cmd/finalize.rs
---
# Group spec lifecycle improvements

Three targeted changes to improve group spec handling throughout their lifecycle.

## Problem

After `chant split`, group specs appear in `chant_ready` alongside their members, which is confusing. The parent group should:
1. Be blocked until all members complete
2. Not appear as actionable work (it's a container)
3. Auto-complete when all members are finalized

## Changes

### 1. Split: Add depends_on to parent

When splitting a spec into members, add `depends_on` to the parent listing all member IDs.

```yaml
# After split, parent becomes:
type: group
status: pending
depends_on:
  - 2026-01-30-00h-f77.1
  - 2026-01-30-00h-f77.2
  # ... all members
```

This ensures the parent is explicitly blocked until all members complete.

**Location**: `src/cmd/lifecycle.rs` in `execute_split`

### 2. Ready: Filter out group specs

`chant_ready` should exclude `type: group` specs from results. Groups are containers, not actionable work items.

**Location**: `src/cmd/list.rs` in ready query logic

### 3. Finalize: Auto-complete parent groups

When finalizing a member spec, check if it's the last pending/in_progress member of a group. If so, auto-complete the parent group.

Logic:
1. After finalizing member X, find parent group (if any)
2. Query all members of that group
3. If all members are now `completed`, mark parent as `completed`

**Location**: `src/cmd/finalize.rs` or `src/cmd/lifecycle.rs`

## Acceptance Criteria

- [x] `chant split` adds `depends_on` to parent with all member IDs
- [x] `chant_ready` (MCP tool) excludes `type: group` specs
- [x] `chant finalize` auto-completes parent group when last member finalized
- [x] Parallel work on members unaffected (members still appear in ready)
- [x] Manual `chant finalize <group-id>` still works if needed

## Edge Cases

- Split with single member: Parent depends on that one member
- Nested groups: Each level auto-completes when its direct children complete
- Member cancelled: Treat as "not blocking" parent completion
- Member failed: Parent should NOT auto-complete (needs attention)