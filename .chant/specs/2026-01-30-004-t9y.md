---
type: code
status: in_progress
---
# Add worktree environment variables (CHANT_WORKTREE, CHANT_WORKTREE_PATH, CHANT_BRANCH) when invoking agents in worktree mode

## Problem

When agents run in worktree mode (during parallel execution), they need to be aware of their execution context. Currently, agents only have access to `CHANT_SPEC_ID` and `CHANT_SPEC_FILE`, but don't know if they're running in a worktree or what branch they're on.

## Solution

Add three new environment variables when invoking agents in worktree mode:
- `CHANT_WORKTREE=1` - Set to "1" when running in a worktree
- `CHANT_WORKTREE_PATH=<path>` - The absolute path to the worktree
- `CHANT_BRANCH=<branch_name>` - The name of the git branch

## Acceptance Criteria

- [x] `CHANT_WORKTREE` environment variable set to "1" when agent runs in worktree mode
- [x] `CHANT_WORKTREE_PATH` environment variable set to worktree path when agent runs in worktree mode
- [x] `CHANT_BRANCH` environment variable set to branch name when agent runs in worktree mode
- [x] Environment variables only set when actually in worktree mode (not in normal execution)
- [x] Build passes (`cargo build`)
- [x] Tests pass (`just test`)
- [x] Code formatted (`cargo fmt`)
- [x] Clippy passes (`cargo clippy`)
