---
type: code
status: completed
target_files:
- tests/integration_tests.rs
completed_at: 2026-01-27T23:15:56Z
model: opus
---
# Add integration test for path-based derivation

## Problem

Path-based derivation has no integration test verifying it works with real spec file paths during `chant add`.

**Gap:** The spec path is constructed from the spec ID at creation time. Need to verify the derivation engine correctly receives and processes this path.

## Solution

Add integration test that:
1. Creates a test git repository
2. Sets up enterprise config with path pattern (e.g., extract team from specs directory structure)
3. Organizes specs in subdirectories (.chant/specs/platform/, .chant/specs/frontend/, etc.)
4. Runs `chant add` and verifies team is derived from spec file path

**Note:** Spec path is determined by spec ID, so we can't pre-create subdirectories. Instead, verify the path derivation logic works with the actual generated spec path.

## Test Implementation

```rust
#[test]
fn test_path_based_derivation_end_to_end() {
    let temp_dir = "/tmp/chant-test-path-deriv";
    setup_test_repo(temp_dir);

    // Create enterprise config with path pattern
    let config = r#"
enterprise:
  derived:
    component:
      from: path
      pattern: "/([^/]+)\\.md$"
"#;
    write_config(temp_dir, config);

    // Run chant add
    let output = Command::new(env!("CARGO_BIN_EXE_chant"))
        .args(["add", "Test spec"])
        .current_dir(temp_dir)
        .output()
        .expect("Failed to run chant add");

    assert!(output.status.success());

    // Read created spec and verify component derived from spec filename
    let spec_content = read_latest_spec(temp_dir);

    // Spec path will be like .chant/specs/2026-01-27-00c-abc.md
    // Pattern should extract the spec ID as component
    assert!(spec_content.contains("component:"));
    assert!(spec_content.contains("derived_fields:\n  - component"));
}
```

## Acceptance Criteria

- [ ] Add test to tests/integration_tests.rs
- [ ] Test sets up enterprise config with path pattern
- [ ] Test runs `chant add` command
- [ ] Test verifies spec file contains derived component field
- [ ] Test verifies derived_fields tracking list
- [ ] Pattern matches realistic spec file paths
- [ ] Test passes: `cargo test test_path_based_derivation_end_to_end`
- [ ] Cleanup temp directory after test