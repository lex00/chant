---
type: code
status: completed
target_files:
- .chant/config.md
- src/cmd/spec.rs
- docs/reference/config.md
commits:
- 7c6b306
completed_at: 2026-01-29T00:46:44Z
model: opus
---
# Remove stale config fields from .chant/config.md

## Problem

The `pr: false` field in `defaults:` section is stale - it's a leftover from removed functionality:
- ❌ Not in `DefaultsConfig` struct (src/config.rs)
- ❌ Not in `SpecFrontmatter` struct (src/spec.rs)
- ❌ Not accessed anywhere in code (`.pr` has zero matches)
- ✅ Only appears in test fixtures and example configs

This creates confusion - users see the field in config and think it does something.

## Solution

### 1. Remove from Active Configs

Remove `pr: false` from:
- `.chant/config.md` (project config)
- `~/.config/chant/config.md` docs (if mentioned)
- `docs/reference/config.md` examples

### 2. Audit Test Fixtures

Search test files for `pr:` and:
- Remove if test doesn't need it
- Keep with comment `# legacy field for backwards compat test` if needed for parsing tests

### 3. Comprehensive Config Audit

Check for other stale fields:

**DefaultsConfig actual fields** (src/config.rs:248-263):
- `prompt: String`
- `branch: bool`
- `branch_prefix: String`
- `model: Option<String>`
- `split_model: Option<String>`
- `main_branch: String` (dead_code, still in struct)
- `rotation_strategy: RotationStrategy`

**Check documentation matches implementation:**
- Does docs/reference/config.md document all of these?
- Are there fields in docs not in struct?
- Are field descriptions accurate?

### 4. Update Config Template

The config template in `src/main.rs` (init command) should not include stale fields.

## Acceptance Criteria

- [x] Remove `pr: false` from .chant/config.md
- [x] Remove `pr:` from test fixtures or mark as legacy
- [x] Audit DefaultsConfig struct vs documentation
- [x] Verify all config fields in docs are implemented
- [x] Verify all implemented fields are documented
- [x] Update config template in src/main.rs if needed
- [x] Check docs/reference/config.md for accuracy
- [x] All tests passing
- [x] Code linted and formatted

## Agent Output

2026-01-29T00:46:44Z

```
I've read the relevant files. Let me now:
1. Remove `pr: false` from `.chant/config.md`
2. Search for any test fixtures with `pr:`
3. Check the config template in `src/main.rs`
I found many occurrences. Let me now:
1. Remove `pr: false` from `src/main.rs` (init template)
2. Remove `pr:` from test fixtures in `src/config.rs` and `src/cmd/spec.rs`
3. Remove from `examples/swiftyjson/chant/config.md`
Now let me edit the main.rs and the test fixtures. Since there are many test fixtures in src/cmd/spec.rs, I'll use replace_all to remove `pr: false` from all of them in one go.
Now let me handle the test fixtures in src/cmd/spec.rs. Since there are many occurrences, I'll do multiple replacements.
Now let me verify all `pr:` occurrences are gone (except in archive and the spec itself):
The remaining `pr:` occurrences are only in archive files, which is acceptable (archived specs document historical data). Now let me update the todo and audit the DefaultsConfig struct vs documentation:
Now let me audit the DefaultsConfig struct vs documentation. From my earlier read:

**DefaultsConfig actual fields** (src/config.rs:248-271):
1. `prompt: String` - default: "bootstrap"
2. `branch: bool` - default: false
3. `branch_prefix: String` - default: "chant/"
4. `model: Option<String>` - default: None
5. `split_model: Option<String>` - default: None
6. `main_branch: String` - default: "main" (has `#[allow(dead_code)]`)
7. `provider: ProviderType` - default: Claude
8. `rotation_strategy: String` - default: "none"

**Documentation in docs/reference/config.md (Full Schema section):**
1. `prompt: bootstrap` ✅
2. `branch: false` ✅
3. `branch_prefix: "chant/"` ✅
4. `provider: claude` ✅
5. `model: null` ✅
6. `split_model: null` ✅
7. `main_branch: "main"` ✅

Missing from docs: `rotation_strategy`! Let me check if it's documented elsewhere:
`rotation_strategy` is documented in the Agent Rotation section. Let me verify it's also in the Full Schema section:
The Full Schema section in docs/reference/config.md is missing `rotation_strategy` from the `defaults:` section. Let me add it:
Now let me run tests and lint:
All tests pass. Now let me check off the acceptance criteria and commit:
Now let me add the model to the frontmatter:
Now let me commit the changes:
The spec-related changes are committed. The remaining modified files are in `.chant/archive/` which are unrelated to this spec.
All tasks completed successfully. Here's a summary of the changes made:

## Summary

Removed the stale `pr: false` config field that was a leftover from removed functionality. This field was never read by any code:
- Not in `DefaultsConfig` struct
- Not in `SpecFrontmatter` struct  
- No `.pr` field access anywhere in codebase

### Files Modified

1. **`.chant/config.md`** - Removed `pr: false`
2. **`src/main.rs`** - Removed `pr: false` from the config template in the init command
3. **`src/config.rs`** - Removed `pr: true` from test fixture
4. **`src/cmd/spec.rs`** - Removed `pr: false` from all 18 test fixtures
5. **`examples/swiftyjson/chant/config.md`** - Removed `pr: false`
6. **`docs/reference/config.md`** - Added missing `rotation_strategy` field to the Full Schema section

### Audit Results

Audited `DefaultsConfig` struct fields vs documentation:
- All implemented fields are now documented in `docs/reference/config.md`
- The `rotation_strategy` field was missing from the Full Schema section and has been added```
