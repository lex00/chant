---
type: docs
status: needs_attention
target_files:
- CLAUDE.md
- README.md
- docs/
---
# Document 014-a4i: Custom merge driver installation and usage

## Problem

Spec 014-a4i (Auto-resolve spec frontmatter conflicts during merge) implemented a custom merge driver for `.chant/specs/*.md` files, but installation and usage are not documented:

**What was implemented**:
- Custom merge driver in `src/merge_driver.rs`
- Intelligently resolves spec frontmatter conflicts
- Detects when main has `status: completed` but branch has `status: in_progress`
- Preserves implementation content while merging metadata correctly

**Why users need this**:
- Prevents merge conflicts when merging spec branches back to main
- Avoids accidentally discarding implementation code with `git checkout --theirs`
- Automates the tedious spec frontmatter conflict resolution

**Currently undocumented**:
- How to install/configure the merge driver
- When it activates (automatic vs manual)
- What conflicts it resolves
- How to verify it's working

## Solution

Add comprehensive documentation to CLAUDE.md under a new "Custom Merge Driver for Specs" section:

```markdown
## Custom Merge Driver for Specs

Chant includes a custom git merge driver that automatically resolves frontmatter conflicts in `.chant/specs/*.md` files.

### What It Does

When merging spec branches back to main, frontmatter conflicts commonly occur:
- Main branch: `status: completed` (from finalize)
- Feature branch: `status: in_progress`
- Conflict: Both sides modified the same fields

The merge driver:
- Detects frontmatter vs body conflicts
- Intelligently merges status, completed_at, and model fields
- Preserves implementation content (never discards code)
- Prevents accidental data loss from manual conflict resolution

### Installation

**Automatic** (recommended):
```bash
chant init --install-merge-driver
```

**Manual**:
1. Add to `.gitattributes`:
   ```
   .chant/specs/*.md merge=chant-spec
   ```

2. Configure git merge driver:
   ```bash
   git config merge.chant-spec.driver "chant merge-driver %O %A %B %L %P"
   git config merge.chant-spec.name "Chant spec merge driver"
   ```

### Verification

Check if the driver is active:
```bash
git config --get merge.chant-spec.driver
cat .gitattributes | grep chant-spec
```

Test with a merge:
```bash
chant work spec-id --branch
# Make changes, finalize in main
git merge chant/spec-id  # Should auto-resolve frontmatter conflicts
```

### When It Activates

The driver activates automatically when:
- Merging any branch that modifies `.chant/specs/*.md` files
- Git detects a conflict in spec frontmatter
- `.gitattributes` is properly configured

### Troubleshooting

**Driver not activating?**
- Check `.gitattributes` exists and has correct pattern
- Verify git config: `git config --get merge.chant-spec.driver`
- Ensure chant binary is in PATH

**Still getting conflicts?**
- Check if conflict is in spec body (not frontmatter)
- Body conflicts require manual resolution
- Driver only handles frontmatter metadata conflicts
```

Also add brief mention in "Best Practices" section and update post-mortem specs to reference this feature.

## Acceptance Criteria

- [ ] Add "Custom Merge Driver for Specs" section to CLAUDE.md
- [ ] Document what the driver does and why it's useful
- [ ] Provide installation instructions (automatic + manual)
- [ ] Explain when the driver activates
- [ ] Add verification steps
- [ ] Include troubleshooting section
- [ ] Add brief mention in Best Practices section
- [ ] Verify documentation is complete and clear