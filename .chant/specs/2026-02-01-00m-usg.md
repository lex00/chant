---
type: code
status: in_progress
---
# Add pagination/limits to MCP tools to prevent oversized responses

When projects have many specs (e.g., 395 pending), MCP tool responses exceed Claude's context limits. The response gets saved to a file instead of being shown inline, breaking the workflow.

## Problem

```
Error: result (126,647 characters) exceeds maximum allowed tokens.
Output has been saved to /Users/.../.claude1/.../tool-results/mcp-chant-chant_ready-....txt
```

## Affected Tools

- `chant_ready` - returns all ready specs with full details
- `chant_spec_list` - returns all specs matching filter
- `chant_status` - already has `brief` param, but other tools don't

## Implementation

In `src/mcp.rs`, add `limit` param to tool input structs:

```rust
pub struct ChantReadyInput {
    #[serde(default = "default_limit")]
    pub limit: Option<usize>,
}

pub struct ChantSpecListInput {
    pub status: Option<String>,
    #[serde(default = "default_limit")]
    pub limit: Option<usize>,
}

fn default_limit() -> Option<usize> { Some(50) }
```

Update handlers to slice results and include metadata:
```rust
let total = specs.len();
let limited = specs.into_iter().take(limit).collect();
json!({ "specs": limited, "total": total, "limit": limit })
```

## Acceptance Criteria

- [x] Add `limit` param to `chant_ready` in src/mcp.rs with default value 50
- [x] Add `limit` param to `chant_spec_list` in src/mcp.rs with default value 50
- [x] Return `{ specs: [...], total: N }` format showing total count before limiting
- [x] Add unit test verifying limit truncates results correctly
- [x] Verify `cargo test` passes