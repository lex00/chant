---
type: code
status: completed
commits:
- 0d96dcd
completed_at: 2026-02-01T21:05:40Z
model: sonnet
---
# Add pagination/limits to MCP tools to prevent oversized responses

When projects have many specs (e.g., 395 pending), MCP tool responses exceed Claude's context limits. The response gets saved to a file instead of being shown inline, breaking the workflow.

## Problem

```
Error: result (126,647 characters) exceeds maximum allowed tokens.
Output has been saved to /Users/.../.claude1/.../tool-results/mcp-chant-chant_ready-....txt
```

## Affected Tools

- `chant_ready` - returns all ready specs with full details
- `chant_spec_list` - returns all specs matching filter
- `chant_status` - already has `brief` param, but other tools don't

## Implementation

In `src/mcp.rs`, add `limit` param to tool input structs:

```rust
pub struct ChantReadyInput {
    #[serde(default = "default_limit")]
    pub limit: Option<usize>,
}

pub struct ChantSpecListInput {
    pub status: Option<String>,
    #[serde(default = "default_limit")]
    pub limit: Option<usize>,
}

fn default_limit() -> Option<usize> { Some(50) }
```

Update handlers to slice results and include metadata:
```rust
let total = specs.len();
let limited = specs.into_iter().take(limit).collect();
json!({ "specs": limited, "total": total, "limit": limit })
```

## Acceptance Criteria

- [x] Add `limit` param to `chant_ready` in src/mcp.rs with default value 50
- [x] Add `limit` param to `chant_spec_list` in src/mcp.rs with default value 50
- [x] Return `{ specs: [...], total: N }` format showing total count before limiting
- [x] Add unit test verifying limit truncates results correctly
- [x] Verify `cargo test` passes

model: claude-sonnet-4-5-20250929

## Agent Output

2026-02-01T21:05:40Z

```
I'll implement pagination/limits for the MCP tools to prevent oversized responses.
The `chant_ready` tool is missing from the MCP implementation. I need to check the tools list to see if it was mentioned there, and also look at the spec management functions.
I need to look at the CLI implementation to see how `ready` works:
Now I understand. The `chant_ready` tool doesn't exist yet, but the spec mentions it needs to be implemented. I can see the `cmd_list` function handles the `ready_only` flag. Let me implement both `chant_ready` and add limits to `chant_spec_list`.
Now let me add a test for the limit functionality:
## Summary

Added pagination to MCP tools to prevent oversized responses exceeding Claude's context limits.

- Implemented `chant_ready` tool with default limit of 50 specs
- Added limit parameter to `chant_spec_list` (default: 50)
- Both tools return JSON with `specs`, `total`, `limit`, and `returned` fields
- Added unit tests verifying limit parameter exists and works correctly
- All tests pass, code formatted, clippy clean```
