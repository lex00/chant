---
type: code
status: in_progress
target_files:
- src/prompt.rs
- src/config.rs
---
# Implement prompt extends/inheritance system

## Problem

Prompt inheritance is documented in `docs/guides/prompts.md` but not implemented. The current `src/prompt.rs` only does basic variable substitution with no support for `extends:` in frontmatter.

This prevents:
- Composing prompts from reusable fragments
- Having project-wide defaults that apply to all prompts
- DRY prompt authoring

## Solution

Implement two complementary features:

### 1. Prompt `extends:` in frontmatter

Allow prompts to inherit from a parent:

```yaml
---
name: tdd
extends: standard
---

{{> parent}}

## TDD Requirements
Write tests before implementation.
```

The `{{> parent}}` marker indicates where parent content should be injected.

### 2. Config-level `prompt_extensions`

Allow globally-applied extensions in config:

```yaml
defaults:
  prompt: standard
  prompt_extensions:
    - output-concise
```

Extensions are appended to the assembled prompt in order.

## Implementation

### PromptFrontmatter struct

Add to `src/prompt.rs`:

```rust
#[derive(Debug, Deserialize, Default)]
pub struct PromptFrontmatter {
    pub name: Option<String>,
    pub purpose: Option<String>,
    pub extends: Option<String>,  // Parent prompt name
}
```

### Extension resolution

In `assemble_with_context`:

1. Parse prompt frontmatter
2. If `extends:` is set, recursively load parent prompt
3. Replace `{{> parent}}` with parent body content
4. After assembly, append any `prompt_extensions` from config

### Extension loading

Extensions live in `.chant/prompts/extensions/` directory:

```
.chant/prompts/
├── standard.md
├── tdd.md
└── extensions/
    ├── output-concise.md
    └── rust-idioms.md
```

### Config changes

Add to `DefaultsConfig` in `src/config.rs`:

```rust
#[serde(default)]
pub prompt_extensions: Vec<String>,
```

## Acceptance Criteria

- [x] Parse `extends:` from prompt frontmatter
- [x] Resolve parent prompt and inject at `{{> parent}}` marker
- [x] Support single inheritance (no multiple parents for v1)
- [x] Detect circular inheritance and error clearly
- [x] Add `prompt_extensions` to DefaultsConfig
- [x] Load extensions from `.chant/prompts/extensions/` directory
- [x] Append extensions to assembled prompt in order
- [x] Add tests for inheritance resolution
- [x] Add tests for extension loading
- [x] Update `docs/guides/prompts.md` to mark feature as implemented