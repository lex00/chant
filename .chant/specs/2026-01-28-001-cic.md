---
type: code
status: completed
model: claude-opus-4-5-20251101
completed_at: 2026-01-28T12:00:00Z
---
# Approval system core - frontmatter, commands, validation

## Problem

Chant needs a human-in-the-loop governance mechanism for spec execution. Currently, anyone can create and work a spec without review. For teams and sensitive changes, we need optional spec approval before work begins.

The spec itself is already the PR primitive - it has a title, acceptance criteria, branch, commits, and review checkpoint. We just need to add approval workflow on top of this existing structure.

## Solution

Implement core approval functionality:

1. **Frontmatter schema** - Add `approval:` section to track approval status
2. **Creation flag** - Add `--needs-approval` flag to `chant add`
3. **Commands** - Implement `chant approve <spec-id> --by <name>` and `chant reject <spec-id> --by <name> --reason <text>`
4. **Work validation** - Block `chant work` if approval required but not granted
5. **Override** - Add `--skip-approval` flag to bypass check (for emergencies)
6. **Committer validation** - Validate `--by` names against git committers
7. **Discussion thread** - Append to "## Approval Discussion" section in spec body

Frontmatter schema:
```yaml
approval:
  required: true
  status: pending    # pending | approved | rejected
  by: alice
  at: 2026-01-28T10:00:00Z
```

Body discussion format:
```markdown
## Approval Discussion

**alice** - 2026-01-28 10:00 - REJECTED
Too broad. Need token validation first.

**bob** - 2026-01-28 10:30
Agreed. I can split this into 3 specs.

**alice** - 2026-01-28 15:00 - APPROVED
Much better after the split!
```

## Acceptance Criteria

- [x] Add `approval:` frontmatter schema to spec structure
- [x] Add `--needs-approval` flag to `chant add` command
- [x] Implement `chant approve <spec-id> --by <name>` command
- [x] Implement `chant reject <spec-id> --by <name> --reason <text>` command
- [x] Block `chant work` if `approval.required: true` and status is not `approved`
- [x] Add `--skip-approval` flag to `chant work` to override approval check
- [x] Validate `--by` parameter against git committers (warn if not found)
- [x] Append approval/rejection to "## Approval Discussion" section in body
- [x] Update frontmatter parser to handle approval fields
- [x] Update spec validation to check approval schema
- [x] All tests passing
- [x] Code linted and formatted