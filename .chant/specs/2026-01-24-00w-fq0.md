---
type: code
status: in_progress
depends_on:
- 2026-01-24-00v-6zj
target_files:
- src/main.rs
---
# Add tests for agent logging behavior

Add unit tests for the logging functions implemented in spec 00v.

## Acceptance Criteria

- [x] Test `ensure_logs_dir` creates directory if not exists
- [x] Test `ensure_logs_dir` adds to .gitignore if not present
- [x] Test `ensure_logs_dir` doesn't duplicate .gitignore entry
- [x] Test `write_agent_log` creates log file with correct format
- [x] Test `write_agent_log` overwrites on replay
- [x] Test log file header contains spec ID, timestamp, prompt name

## Test Cases

```rust
#[test]
fn test_ensure_logs_dir_creates_directory() {
    // Use tempdir
    // Call ensure_logs_dir
    // Assert .chant/logs exists
}

#[test]
fn test_ensure_logs_dir_updates_gitignore() {
    // Create .chant dir without .gitignore
    // Call ensure_logs_dir
    // Assert .gitignore contains "logs/"
}

#[test]
fn test_write_agent_log_format() {
    // Write a log
    // Read it back
    // Assert header format is correct
    // Assert content is preserved
}

#[test]
fn test_write_agent_log_overwrites() {
    // Write log with content A
    // Write log with content B
    // Assert file contains only B
}
```

## Implementation Notes

- Use `tempfile` crate for isolated test directories
- May need to refactor functions to accept path parameter for testability
- Consider making ensure_logs_dir and write_agent_log take a base path