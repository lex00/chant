---
type: code
status: pending
target_files:
- src/main.rs
---
# Implement chant delete command to remove specs

## Overview

Add `chant delete <spec-id>` command to safely remove specs and clean up associated artifacts.

## Potential Pitfalls

### 1. Spec Status
- **In-progress specs**: Should require `--force` to delete (work may be lost)
- **Completed specs**: Safe to delete, but warn about losing history

### 2. Driver/Member Relationships
- **Deleting a driver**: Should delete all members too? Or require `--cascade`?
- **Deleting a member**: Should update driver? Prevent deletion?

### 3. Git Artifacts
- **Commits**: Should NOT revert commits (too dangerous, history rewriting)
- **Branches**: If `--branch` mode was used, offer to delete the branch
- **Uncommitted changes**: Warn if spec file has uncommitted changes

### 4. Associated Files
- **Log files**: Delete `.chant/logs/{spec-id}.log`
- **Worktrees**: Clean up `/tmp/chant-{spec-id}` if exists

### 5. Dependencies
- **depends_on references**: Other specs may depend on this one
- Should warn or prevent deletion if spec is a dependency

### 6. Archived vs Active
- Should `delete` work on archived specs too?
- Different paths: `.chant/specs/` vs `.chant/archive/YYYY-MM-DD/`

## Proposed Behavior

```bash
# Basic delete (pending specs only, no dependencies)
chant delete <spec-id>

# Force delete (any status)
chant delete <spec-id> --force

# Delete driver and all members
chant delete <driver-id> --cascade

# Delete and remove associated branch
chant delete <spec-id> --delete-branch

# Dry run
chant delete <spec-id> --dry-run

# Skip confirmation
chant delete <spec-id> --yes
```

## Safety Checks

1. Confirm before deletion (unless `--yes`)
2. Prevent deletion if:
   - Spec is in_progress (without `--force`)
   - Spec is depended on by others (without `--force`)
   - Spec is a member of a group (suggest deleting driver instead)
3. Warn if:
   - Spec has associated branch
   - Spec has uncommitted changes
   - Deleting will orphan member specs

## Cleanup Actions

| Artifact | Action |
|----------|--------|
| Spec file | Delete |
| Log file | Delete |
| Branch | Delete if `--delete-branch` |
| Worktree | Remove if exists |
| Commits | Do NOT touch (history is sacred) |
| depends_on refs | Warn only |

## Acceptance Criteria

- [ ] `chant delete <id>` deletes pending specs
- [ ] `--force` allows deleting in_progress/completed specs
- [ ] `--cascade` deletes driver + all members
- [ ] `--delete-branch` removes associated git branch
- [ ] `--dry-run` shows what would be deleted
- [ ] `--yes` skips confirmation prompt
- [ ] Deletes associated log file
- [ ] Cleans up worktree if exists
- [ ] Warns if spec is depended on by others
- [ ] Prevents member deletion (suggests driver deletion)
- [ ] Works for both active and archived specs
- [ ] All tests pass
