---
type: code
status: in_progress
target_files:
- src/main.rs
model: claude-opus-4-5-20251101
---
# Fix handle_agent_update to create MCP config

## Bug

When updating agent configuration on an existing project via the wizard path:
```
chant init → "Add/update agent configuration" → "Claude Code (CLAUDE.md)"
```

The `.mcp.json` file is NOT created, even though the agent template is written.

**Root cause**: `handle_agent_update()` (lines 952-1029 in `src/main.rs`) only writes the template file. It doesn't call `update_claude_mcp_config()` or create `.mcp.json` like the fresh init path does (lines 1805-1878).

## Acceptance Criteria

- [x] `handle_agent_update()` calls `update_claude_mcp_config()` for providers that support MCP
- [x] `handle_agent_update()` creates local `.mcp.json` reference copy for MCP providers
- [x] Print appropriate status messages (same as fresh init path)
- [x] All tests pass