---
type: code
status: in_progress
labels:
- refactor
- utilities
target_files:
- src/derivation.rs
- src/cmd/spec.rs
- src/cmd/template.rs
- src/cmd/derive.rs
model: claude-opus-4-5-20251101
---
# Extract DerivationContext builder to src/derivation.rs

## Problem

The `build_derivation_context()` function is duplicated in 3 files:
- `src/cmd/spec.rs`
- `src/cmd/template.rs`
- `src/cmd/derive.rs`

Each implementation builds a DerivationContext with the same fields (date, time, user info, etc.).

## Solution

Move the context builder to `src/derivation.rs` as a public function. Update all callers to use this single implementation.

## Acceptance Criteria

- [x] Add `pub fn build_context() -> DerivationContext` to `src/derivation.rs`
- [x] Update `src/cmd/spec.rs` to use `derivation::build_context()`
- [x] Update `src/cmd/template.rs` to use `derivation::build_context()`
- [x] Update `src/cmd/derive.rs` to use `derivation::build_context()`
- [x] Remove duplicated implementations
- [x] All tests pass