---
type: code
status: pending
labels:
- bug
- timestamps
target_files:
- src/cmd/finalize.rs
- src/cmd/agent.rs
- src/spec_group.rs
---
# Fix timestamps — centralize UTC generation, remove Local::now with Z suffix

## Context

Nine locations generate `completed_at` and similar timestamps using `chrono::Local::now()` but format with `Z` (UTC indicator). A user in US Pacific gets `2026-02-07T14:30:00Z` when UTC is actually `22:30:00Z`. The `Z` suffix is a lie.

Meanwhile, some places correctly use `Utc::now()` (merge.rs, approve.rs, executor.rs). The finalization validation checks `completed_at` ends with `Z` — tautological since the format string hardcodes it.

**Bug locations** (all use `Local::now()` + `Z` suffix):
`operations/finalize.rs:109`, `cmd/finalize.rs:96,248,405,507`, `cmd/agent.rs:457,475,545`, `spec_group.rs:467`

**Correctly using `Local::now()`** (display, IDs, should NOT change): `id.rs`, `status.rs`, `watch.rs`, `list.rs`, `archive.rs`

## Task

Create a `pub fn utc_now_iso() -> String` helper in the library crate that uses `chrono::Utc::now()`. Replace all 9 instances of `Local::now().format("%Y-%m-%dT%H:%M:%SZ")` with the new helper. Replace the tautological timestamp validation in both finalize files with a real ISO 8601 parse check. Do NOT change `Local::now()` usages for display/UI/IDs (id.rs, status.rs, watch.rs, list.rs, archive.rs).

## Acceptance Criteria

- [ ] `utc_now_iso()` helper function exists in the library crate
- [ ] Zero instances of `Local::now()` followed by `format("%Y-%m-%dT%H:%M:%SZ")` remain
- [ ] Timestamp validation parses the timestamp (not just checks for `Z` suffix)
- [ ] `Local::now()` still used for display contexts (ID generation, watch UI, list formatting)
- [ ] `cargo test` passes
- [ ] `cargo clippy -- -D warnings` passes
