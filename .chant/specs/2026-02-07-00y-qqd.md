---
type: code
status: in_progress
labels:
- operations
- finalize
- bug
target_files:
- src/operations/finalize.rs
- src/cmd/finalize.rs
branch: chant/2026-02-07-00y-qqd
model: opus
---
# Complete operations layer finalize — replace stubs with real implementations

## Context

`src/operations/finalize.rs` has three placeholder functions that always return hardcoded empty values:

- `get_commits_for_spec_impl()` → always returns `Vec::new()`
- `detect_agent_in_commit_impl()` → always returns `false`
- `get_model_name_impl()` → always returns `None`

The real implementations exist in the CLI binary crate (`src/cmd/commits.rs` and `src/cmd/model.rs`). The library crate (`src/operations/`) can't import them, so MCP finalization produces specs with no commits, no model, no agent detection.

## Task

Move the real commit detection (`cmd/commits.rs`), agent detection, and model name (`cmd/model.rs`) functions from the binary crate into the library crate so `operations/finalize.rs` can call them. Replace the three stubs with calls to the real implementations. The operations finalize must match the CLI's behavior: branch-aware commit detection (`cmd/finalize.rs:68-77`), dependent-spec unblocking (lines 185-192), and parent group auto-completion (lines 195-197). Update `cmd/finalize.rs` to import from the new library location. **Do NOT duplicate logic.**

## Acceptance Criteria

- [ ] No placeholder/stub functions in `src/operations/finalize.rs` (grep for "placeholder" returns nothing)
- [ ] Commit detection, agent detection, model name functions exist in the library crate
- [ ] `operations::finalize_spec` detects commits, agent co-authorship, and model name
- [ ] `cmd/finalize.rs` imports from library crate (no duplication with operations)
- [ ] `cargo test` passes
- [ ] `cargo clippy -- -D warnings` passes