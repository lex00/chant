---
type: code
status: pending
---

# Improve chant diagnose output clarity

Agents using `chant_diagnose` (MCP tool) misinterpret file state checks as process state, leading to false conclusions like "agent stopped" when it actually completed successfully.

## Problem

Current diagnose output shows:
```
- "status: failed"
- "Lock file: Not present"
- "Log file: Does not exist"
```

Agents interpret this as "the agent crashed/stopped" when actually:
- Lock file not present = agent finished (normal)
- Log file missing = might be in worktree, or agent used different logging
- Status failed = could be stale, doesn't mean work wasn't done

## Solution

1. Add explicit interpretation hints to diagnose output
2. Distinguish between "agent stopped unexpectedly" vs "agent completed and cleaned up"
3. Check for positive signals (commits, checked criteria) alongside negative signals
4. Add a summary conclusion: "Likely completed", "Likely failed", "Unclear - check manually"

## Tasks

1. Find `chant_diagnose` implementation (likely in `src/mcp.rs` or `src/cmd/`)
2. Add success signal checks (commits with spec pattern, criteria completion %)
3. Add interpretation text to output:
   - "Lock file absent: Agent finished (normal) or never started"
   - "Log file missing: May be in worktree or using different log path"
4. Add summary conclusion based on signals
5. Update MCP tool output format

## Acceptance Criteria

- [ ] Diagnose output includes interpretation hints for each check
- [ ] Diagnose checks for commits matching spec ID
- [ ] Diagnose shows criteria completion percentage
- [ ] Diagnose ends with summary: "Assessment: <likely status>"
- [ ] MCP chant_diagnose returns clearer output
