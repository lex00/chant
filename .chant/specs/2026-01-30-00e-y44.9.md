---
type: code
status: completed
depends_on:
- 2026-01-30-00e-y44.8
target_files:
- src/cmd/spec/lint.rs
- src/main.rs
commits:
- eb5769f
completed_at: 2026-01-31T17:51:05Z
model: sonnet
---
# Integrate Scoring into chant lint

Add quality scoring display to the `chant lint` command.

### Acceptance Criteria

- [x] Call scoring functions for each spec in `chant lint`
- [x] Display format: `{spec_id}: {traffic_light} | Complexity: {grade} | Confidence: {grade} | Splittable: {grade}`
- [x] Show suggestions below specs with Review/Refine status
- [x] Support `--verbose` flag to show all dimension details including isolation and AC quality
- [x] Ensure lint output remains readable with new quality info

### Edge Cases

- Specs without members should omit isolation grade
- Long suggestion lists should be truncated with "... and N more"
- Empty spec list should not crash

### Example Test Cases

- Running `chant lint` on 3 specs shows traffic light and grades for each
- Spec with Grade D shows red refine status and suggestion
- `chant lint --verbose` shows all 5 dimensions

### Requires

- Calls scoring functions from Members 2-8

## Agent Output

2026-01-31T17:51:05Z

```
I'll implement the scoring integration into `chant lint`. Let me start by reading the relevant code and planning my approach.
Let me read the current lint implementation and the scoring functions:
Now let me search for other scoring functions that were mentioned in the spec dependencies:
Let me check if there are other scoring-related files or functions:
Good! Let me check the score module structure and the traffic light function:
Now let me check how to build a complete score and also look at the CLI structure:
Let me find the main CLI entry point:
Now let me update the todos and plan the approach:
Perfect! Now I understand the structure. Let me plan the approach:

## Plan

1. **Modify the Lint command** to add a `--verbose` flag
2. **Import scoring modules** in the lint.rs file
3. **Create a function to calculate full SpecScore** for each spec
4. **Update the display logic** to show:
   - Base format: `{spec_id}: {traffic_light} | Complexity: {grade} | Confidence: {grade} | Splittable: {grade}`
   - If isolation exists: add `| Isolation: {grade}` 
   - Show suggestions for Review/Refine statuses
   - In verbose mode: show all 5 dimensions including AC quality
5. **Handle edge cases**: specs without members, long suggestion lists

Now let me implement this:
First, let me update main.rs to add the verbose flag to the Lint command:
Now update the command handler to pass the verbose flag:
Now let me update the lint.rs file to add scoring integration. First, let me add the necessary imports and helper function:
Now let me add a helper function to calculate the full score for a spec:
Now I need to update the cmd_lint function signature and implementation. Let me first update the function signature:
Now let me update the main loop in cmd_lint to add scoring display. Let me find where specs are being printed:
Let me see the rest of the display logic:
Now I need to replace the display section to add scoring information. Let me modify the text output section:
Now let's run cargo fmt to format the code:
Good! Now let's run cargo clippy:
I need to fix these errors. Let me first check how to extract acceptance criteria from a spec:
Let me check the AC quality module to see how it expects the criteria:
I need to extract the criteria text from the spec. Let me check if there's a method to extract the criteria text:
I need to create a function to extract the actual criteria strings. Let me check the spec module more carefully:
Let me create a helper function in the lint module to extract acceptance criteria text:
Now let me fix the Config::default() issue. Let me check if there's a better way to handle the missing config:
Let me look at where config is loaded in cmd_lint:
I see, the config is loaded and it's an Option<Config>. I need to handle the case where config might be None. Let me check how confidence calculation handles this:
The confidence function requires a &Config. Let me create a default config if none exists. Let me check the Config structure:
Let me look for the `impl Default` or default values:
Let me look at the LintThresholds default instead and create a minimal config on the fly:
Now let me update the call site to pass Option<&Config>:
Now let's try building again:
I need a better approach. Let me look for how Config is created elsewhere in the codebase:
Let me look for how to create a simple default Config. Let me look at the Config more carefully:
Let me use a simpler approach - just use a lazy static or check if we can load the config on the fly. Actually, let me simplify by just passing the config reference directly:
Now update the call site:
Now let's try building again:
Good! Just one warning. Let me fix it:
Great! Now let's run the tests:
Perfect! All tests pass. Now let's verify the implementation works by testing it manually:
Excellent! Now let's test the verbose flag:
Great! I can see the AC Quality is now showing in verbose mode. Let me test with a spec that has members to see if isolation shows up:
Perfect! The isolation grade is showing for specs with members. Now let me verify all acceptance criteria and mark them complete:
Let me verify each acceptance criterion:

1. ✅ **Call scoring functions for each spec in `chant lint`** - Yes, we're calling calculate_complexity, calculate_confidence, calculate_splittability, calculate_isolation, and calculate_ac_quality
2. ✅ **Display format: `{spec_id}: {traffic_light} | Complexity: {grade} | Confidence: {grade} | Splittable: {grade}`** - Yes, the format is correct
3. ✅ **Show suggestions below specs with Review/Refine status** - Yes, we're showing suggestions for Review/Refine statuses
4. ✅ **Support `--verbose` flag to show all dimension details including isolation and AC quality** - Yes, verbose flag shows isolation (when present) and AC quality
5. ✅ **Ensure lint output remains readable with new quality info** - Yes, the output is well-formatted and readable

All acceptance criteria are met! Let me update the spec:
Now let me add the m

... (output truncated, 6936 chars total)```
