---
type: code
status: pending
target_files:
- src/spec_group.rs
- src/cmd/work.rs
---

# Investigate and fix driver spec not auto-completing when all member specs complete

## Problem

When all member specs of a driver/group spec complete, the driver spec should automatically transition from `in_progress` to `completed`. Users report that the driver stays showing ‚óê (in-progress) even after all members complete.

## Investigation Findings

The `auto_complete_driver_if_ready()` function in `src/spec_group.rs` (lines 267-307) is called after each member completes. It requires:

1. The completing spec must be a member (have a driver ID)
2. The driver must be in `InProgress` status
3. ALL members must have `Completed` status

Potential failure points:
- If a member fails to finalize properly (e.g., no commits found), it may not be marked `Completed`
- If the driver was never marked `InProgress` when first member started
- If `auto_complete_driver_if_ready()` isn't being called in all code paths

## Acceptance Criteria

- [ ] Add diagnostic logging to `auto_complete_driver_if_ready()` to show why it didn't complete
- [ ] Verify `mark_driver_in_progress()` is called when first member starts
- [ ] Verify `auto_complete_driver_if_ready()` is called after every member completion (both single and parallel modes)
- [ ] Add `chant status` or `chant show` output that explains why a driver isn't completing
- [ ] If a member has status other than `completed`, show which member is blocking
- [ ] All existing tests pass
- [ ] Add integration test: create driver with 2 members, complete both, verify driver auto-completes

## Technical Details

Key functions to examine:
- `mark_driver_in_progress()` at spec_group.rs:227-240
- `auto_complete_driver_if_ready()` at spec_group.rs:267-307
- `all_members_completed()` at spec_group.rs:74-82
- Call sites in work.rs:264-270 (single) and work.rs:776-795 (parallel)

## Debugging Approach

1. Add verbose logging when `auto_complete_driver_if_ready()` is called
2. Log the driver status and all member statuses
3. Log the result of `all_members_completed()` check
4. This will reveal exactly why auto-completion isn't triggering
