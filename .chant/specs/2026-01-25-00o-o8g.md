---
type: code
status: completed
target_files:
- src/worktree.rs
model: claude-haiku-4-5-20251001
---
# Fix CI test failure causing failing badge

## Overview

The CI pipeline is failing due to test `test_merge_and_cleanup_successful_merge` in `src/worktree.rs`. This causes a red badge on the repo.

## Error

From CI logs:
```
test worktree::tests::test_merge_and_cleanup_successful_merge ... FAILED

thread 'worktree::tests::test_merge_and_cleanup_successful_merge' panicked at src/worktree.rs:374:9:
assertion failed: result.success && result.error.is_none()
```

## Analysis

The test is asserting `result.success && result.error.is_none()` but one of those is false. The `merge_and_cleanup` function was recently refactored to return `MergeCleanupResult` instead of `Result<()>`.

Possible causes:
1. The test environment on CI (Linux) behaves differently than local (macOS)
2. Race condition or timing issue
3. Git configuration differences between CI and local

## Acceptance Criteria

- [x] Identify root cause of test failure
- [x] Fix the failing test
- [x] Ensure test passes on both local and CI
- [x] All tests pass