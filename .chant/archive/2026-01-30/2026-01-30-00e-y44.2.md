---
type: code
status: completed
depends_on:
- 2026-01-30-00e-y44.1
target_files:
- src/score/complexity.rs
commits:
- 33e98af
completed_at: 2026-01-31T17:05:05Z
model: sonnet
---
# Complexity Scoring Implementation

Implement scoring based on criteria count, target files, and word count.

### Inherited Context

- Complexity thresholds: ≤5 criteria, ≤5 files, ≤200 words is ideal (Grade A)
- Haiku-friendly specs should be Grade A or B

### Acceptance Criteria

- [x] Implement `calculate_complexity(spec: &Spec) -> ComplexityGrade` function
- [x] Grade A: 1-3 criteria, 1-2 files, <200 words
- [x] Grade B: 4-5 criteria, 3 files, 200-400 words
- [x] Grade C: 6-7 criteria, 4 files, 400-600 words
- [x] Grade D: 8+ criteria OR 5+ files OR 600+ words
- [x] Extract criteria count, file count, word count from Spec struct

### Edge Cases

- Specs with no target_files should default to 0 files
- Empty body should have word count of 0
- If any single metric triggers D, overall grade is D

### Example Test Cases

- Spec with 2 criteria, 1 file, 150 words → Grade A
- Spec with 5 criteria, 3 files, 300 words → Grade B
- Spec with 10 criteria, 2 files, 100 words → Grade D (criteria exceeds threshold)

### Provides

- `calculate_complexity(spec: &Spec) -> ComplexityGrade` - Returns grade based on criteria/files/words, errors if spec metadata missing

## Agent Output

2026-01-31T17:05:05Z

```
I'll implement the complexity scoring system based on the spec requirements. Let me start by reading the relevant code to understand the existing structure.
Let me search for the scoring and spec related files:
Great! I found the scoring.rs file. Let me read it along with the spec.rs:
Let me read the Spec struct more selectively:
Good! Now let me search for methods on the Spec struct that might help with counting criteria and words:
Perfect! I can see there's a `count_total_checkboxes` method. Now let me check for word count methods and understand the full Spec structure better:
Now let me check if there are any existing implementations or tests I need to be aware of:
Good! There's no existing implementation. Now let me update the todo and implement the function. First, let me understand the full structure of the scoring module:
Now I'll implement the `calculate_complexity` function. Based on the spec requirements and the types I've read, I need to:

1. Count acceptance criteria (using `count_total_checkboxes()`)
2. Count target files (from `frontmatter.target_files`)
3. Count words in the body
4. Apply grading logic

Let me add this function to the scoring.rs file:
Now let me add comprehensive tests for this function:
Now let me run cargo fmt and cargo clippy:
Great! Now let me run the tests:
Let me check if all tests passed:
Perfect! All tests passed. Now let me update the spec to check off all the acceptance criteria:
Now let me commit the changes:
Now let me stage and commit the changes:
Perfect! The changes for spec 2026-01-30-00e-y44.2 have been committed. The remaining modified files are not part of this spec's scope. Let me update the final todo:
Excellent! I've successfully implemented the complexity scoring system for spec 2026-01-30-00e-y44.2. Here's a summary of what was accomplished:

## Implementation Summary

**Added `calculate_complexity` function to `src/scoring.rs`:**
- Calculates complexity grade (A-D) based on three metrics:
  - Acceptance criteria count (using existing `count_total_checkboxes()` method)
  - Target files count (from `frontmatter.target_files`)
  - Word count (from spec body)

**Grading thresholds implemented:**
- Grade A: 1-3 criteria, 1-2 files, <200 words
- Grade B: 4-5 criteria, 3 files, 200-400 words
- Grade C: 6-7 criteria, 4 files, 400-600 words
- Grade D: 8+ criteria OR 5+ files OR 600+ words

**Edge cases handled:**
- Specs with no `target_files` default to 0 files ✓
- Empty body has word count of 0 ✓
- Any single metric triggering D results in overall grade D ✓

**Testing:**
- Added 8 comprehensive tests covering all grade levels and edge cases
- All tests pass ✓
- Code formatted with `cargo fmt` ✓
- No clippy warnings ✓

**Commit:**
- Changes committed with message: `chant(2026-01-30-00e-y44.2): Implement complexity scoring based on criteria, files, and word count`
- All acceptance criteria marked as complete ✓

The implementation is in `src/scoring.rs:189-222`, with tests at `src/scoring.rs:329-510`.```
