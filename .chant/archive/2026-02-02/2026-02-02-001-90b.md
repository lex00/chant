---
type: code
status: completed
commits:
- 1afed27
completed_at: 2026-02-02T22:50:23Z
model: sonnet
---
# Fix dependency resolution to recognize archived specs as completed

## Agent Output

2026-02-02T22:50:23Z

```
I'll read the spec and relevant code to understand the issue with dependency resolution.
The issue is in `deps.rs:226` - the `is_blocked_by_dependencies` function checks if a dependency spec has status `Completed`, but archived specs are also completed and should be treated as such. Let me check how archived specs work:
Good - I can see that `resolve_local_dependency` already handles searching the archive, so specs can be found there. The issue is in `is_blocked_by_dependencies` at line 226 - when it finds a dependency via `find_spec_by_id`, it only checks if the status is `Completed`. However, archived specs should be treated as completed regardless of their stored status.

Let me check one of the archived specs to verify their status:
The archived spec already has `status: completed`, so the issue is more subtle. Let me look at the actual test case or issue that triggered this spec:
Let me read the full spec to understand the problem better:
The spec file is minimal. Let me check if there's a test case or issue description:
Let me check the git log for the initial spec creation:
Let me check the codebase for any actual issues reported or tests that demonstrate the problem. Let me look for where dependencies are checked:
Now I understand the issue better. Looking at the code in `deps.rs:216-232`, the `is_blocked_by_dependencies` function checks if dependencies are completed. When it resolves a dependency (via `find_spec_by_id` → `resolve_dependency` → `resolve_local_dependency`), it can load specs from the archive directory (lines 56-74). However, the check at line 226 only looks at whether `dep_spec.frontmatter.status == SpecStatus::Completed`.

The problem is subtle: while archived specs should have `status: completed` in their frontmatter, the logic should be more robust. If a spec is in the archive, it should be treated as completed regardless of its status field. This is defensive programming.

Let me implement the fix:
Now I need to check if the Spec struct has a `path` field. Let me verify:
The Spec struct doesn't have a path field. I need a different approach. Let me check the `resolve_local_dependency` function again to see how it tracks whether a spec came from the archive:

Looking at the code, `resolve_local_dependency` returns a `Spec` loaded from either the specs directory or the archive directory, but there's no way to tell which after loading. I need to modify the approach.

The better solution is to check if the spec file path is in the archive when we load it. Let me look at how `Spec::load` works and if we can add path tracking:
Let me take a simpler approach. Instead of modifying the Spec struct, I can modify the `resolve_local_dependency` function to return information about whether the spec is archived, or I can check directly in `is_blocked_by_dependencies` by re-checking if the dependency file exists in the archive.

Actually, the cleanest solution is to modify `find_spec_by_id` to return additional information or to add a helper that checks if a spec ID exists in the archive. Let me look more carefully:
I see my edit included a reference to `dep_spec.path` which doesn't exist. Let me fix this with a better approach - I'll create a helper function to check if a spec ID is in the archive:
Now let me add a test case to verify this works:
Now let me run the tests to verify the implementation:
Good! The test passes. Let me run all the deps tests to make sure I didn't break anything:
Perfect! All tests pass. Now let me format the code and run clippy:
Excellent! No lint errors. Now let me check if the spec file has any acceptance criteria to mark:
The spec is minimal with no acceptance criteria. Let me commit the changes:
## Summary

Fixed dependency resolution in `src/deps.rs` to recognize archived specs as completed.

- Added `is_spec_archived()` helper function that searches the archive directory for a spec ID
- Updated `is_blocked_by_dependencies()` to check if dependencies are in the archive, treating them as completed
- Added test case `test_is_blocked_by_dependencies_archived` verifying archived specs don't block dependents```
