---
type: code
status: completed
commits:
- 269a55d
completed_at: 2026-02-02T11:13:38Z
model: sonnet
---
# chant work shows lint warning before failing on existing branch

## Problem

When running `chant work`, if the user aborts at the quality check prompt (answers "N"), the branch AND worktree have already been created and are left behind. Subsequent runs fail with "Branch already exists", and cleanup requires `git worktree remove` before `git branch -D`.

## Root Cause

In `src/cmd/work/single.rs`:
- Line 416: `worktree::create_worktree` creates branch AND worktree FIRST
- Lines 439-517: Quality check happens AFTER

## Fix

In `src/cmd/work/single.rs`, move the quality check block (lines 439-517) to BEFORE the worktree creation block (lines 409-423).

## Acceptance Criteria

- [x] In `src/cmd/work/single.rs`, the `traffic_light` quality check appears before `worktree::create_worktree` call
- [x] `grep -n "traffic_light\|create_worktree" src/cmd/work/single.rs` shows traffic_light line < create_worktree line
- [x] `cargo check` compiles without errors
- [x] `cargo test cmd::work` passes

## Agent Output

2026-02-02T11:13:38Z

```
I'll implement the spec to move the quality check before worktree creation in `src/cmd/work/single.rs`.
Now I'll move the quality check (lines 439-568) to before the worktree creation (lines 409-423).
## Summary

Moved quality check before worktree creation in `src/cmd/work/single.rs`.

- Quality check (lines 409-538) now executes before worktree creation (lines 540-552)
- User can abort at quality prompt without leaving abandoned branches/worktrees
- All tests pass, code compiles without errors```
