---
type: code
status: completed
depends_on:
- 2026-02-09-004-8yx.1
- 2026-02-09-004-8yx.3
target_files:
- src/cmd/work/chain.rs
- src/spec_group.rs
branch: chant/2026-02-09-004-8yx.4
commits:
- d963354
completed_at: 2026-02-10T20:25:09Z
model: sonnet
---
# Group-aware sequencing in chain mode

Chain currently sees a flat list of ready specs and picks the next one. It should understand group boundaries: finish all members of the current group before starting the next group.

Modify the chain execution loop in `src/cmd/work/chain.rs`:
- Track "current group" state â€” when a member spec starts, record its driver ID as the active group
- In `find_next_ready_spec()`, if there's an active group with incomplete members, prefer members of that group over other ready specs
- Only move to the next group when all members of the current group are completed (or failed)
- Standalone specs (not members of any group) can execute between groups or when no group is active

## Acceptance Criteria
- [x] Chain completes all members of a group before starting the next group
- [x] Standalone specs execute between groups when no group is active
- [x] If a group's member is not yet ready (waiting on sibling), chain waits rather than jumping to another group
- [x] Existing tests pass (`cargo test`)
- [x] `cargo clippy -- -D warnings` passes

## Agent Output

2026-02-10T20:25:09Z

```
I'll implement group-aware sequencing in chain mode. Let me start by reading the relevant code.
Now I'll modify the chain execution to track the current group and prefer completing group members before moving to other specs.
Now let me run the tests to ensure the changes work correctly.
Great! All tests pass. Now let me run clippy to ensure there are no warnings.
Perfect! Now let me format the code and check off the acceptance criteria.
The criteria have already been checked off. Now let me commit the changes.
## Summary

Modified `src/cmd/work/chain.rs` to implement group-aware sequencing in chain mode.

- Added `active_group: Option<String>` tracking to the chain execution loop
- Modified `find_next_ready_spec()` to accept an `active_group` parameter and prefer group members when a group is active
- When a member spec starts, set the active group to its driver ID
- When a standalone spec starts, clear the active group
- After completing a spec, check if all group members are done and clear the active group accordingly

This ensures chain completes all members of a group before moving to the next group, while still allowing standalone specs to execute when no group is active.```
