---
type: code
status: completed
branch: chant/2026-02-05-00h-uzs
commits:
- 89845da
completed_at: 2026-02-05T20:00:59Z
model: sonnet
---
# MCP chant_work_start fails silently when spec quality checks fail. Non-interactive mode can't prompt, so work just dies. Should either: (1) return quality errors to agent via MCP response, (2) add skip_criteria parameter to MCP tool, (3) auto-skip in MCP mode, or (4) pre-validate and reject before spawning.

## Solution

Implemented option (4): Pre-validate and reject before spawning.

Modified `tool_chant_work_start` in `src/mcp/handlers.rs` to:
1. Run quality checks before spawning `chant work` process (unless `skip_criteria: true`)
2. If spec has Red/Refine traffic light status, return error with quality assessment details
3. Include suggestions and guidance in error message
4. Inform user they can bypass with `skip_criteria: true`

This prevents silent failures by rejecting work upfront with clear feedback about quality issues.

## Acceptance Criteria

- [x] Quality checks run before spawning work process when skip_criteria is false
- [x] Red/Refine status returns MCP error response with quality details
- [x] Error message includes dimension grades (Complexity, Confidence, etc.)
- [x] Error message includes actionable suggestions
- [x] Error message mentions skip_criteria bypass option
- [x] Yellow/Review status proceeds without blocking
- [x] Green/Ready status proceeds silently
- [x] Code compiles and passes clippy

## Agent Output

2026-02-05T20:00:59Z

```
I'll analyze the issue with `chant_work_start` failing silently when spec quality checks fail.
I can see the issue. In `tool_chant_work_start` (line 1778-1882 in handlers.rs), the MCP server spawns a `chant work` process without handling quality check failures. The CLI code in `single.rs` (lines 414-543) runs quality checks and can abort in non-interactive mode, but when spawned via MCP, there's no way to return that error to the calling agent.

Looking at lines 1793-1796 in handlers.rs, the MCP tool accepts a `skip_criteria` parameter that gets passed through. The solution is to validate quality before spawning when not skipping criteria.
Now I need to test the change by updating the spec file and committing:
## Summary

Modified `src/mcp/handlers.rs` to pre-validate spec quality before spawning work process.

- Added quality check validation in `tool_chant_work_start` (runs unless `skip_criteria: true`)
- Red/Refine specs now return MCP error with detailed quality assessment
- Error includes dimension grades, suggestions, and bypass instructions
- Yellow/Review and Green/Ready specs proceed as before

Fixed module reference issue by updating `src/cmd/lifecycle/mod.rs` to use `reset` instead of `resume`.```
