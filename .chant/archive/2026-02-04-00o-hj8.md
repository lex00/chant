---
type: code
status: completed
depends_on:
- 2026-02-04-00j-nvv
target_files:
- src/domain/dependency.rs
branch: chant/2026-02-04-00o-hj8
commits:
- 4b74754
completed_at: 2026-02-04T22:22:56Z
model: sonnet
---
# Extract dependency resolution to domain module

## Problem

Topological sort and cycle detection is embedded in command code. Need pure functions.

## Solution

Add `src/domain/dependency.rs` with pure dependency graph functions.

## Acceptance Criteria

- [x] Create `src/domain/dependency.rs` with `detect_cycles(specs: &[Spec]) -> Vec<Vec<String>>` returning cycles as lists of spec IDs
- [x] Add `topological_sort(specs: &[Spec]) -> Result<Vec<String>>` returning sorted spec IDs or error if cycles
- [x] Add `pub mod dependency;` to `src/domain/mod.rs`
- [x] Add unit test `test_detect_cycles_no_cycles` verifying empty result for acyclic graph
- [x] Run `cargo test test_detect_cycles` and confirm it passes

## Agent Output

2026-02-04T22:22:56Z

```
I'll implement this task by creating a new domain module for dependency resolution with pure functions.
## Summary

Created `src/domain/dependency.rs` with pure dependency graph functions and integrated it into the domain module.

- Added `detect_cycles()` using DFS to find circular dependencies
- Added `topological_sort()` using Kahn's algorithm to order specs by dependencies
- Integrated module into `src/domain/mod.rs`
- All tests passing including `test_detect_cycles_no_cycles`
- Code formatted and clippy warnings resolved```
