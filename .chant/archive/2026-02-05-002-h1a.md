---
type: code
status: completed
commits:
- d64e71d
completed_at: 2026-02-05T09:19:25Z
model: sonnet
---
# MCP work process becomes zombie when lint fails - the spawned agent process exits on lint failure but chant doesn't reap it properly, leaving zombie entries in work_list

## Acceptance Criteria

- [x] MCP work_start spawns processes that are properly reaped when they exit
- [x] No zombie processes remain after spawned agent exits
- [x] Code compiles without clippy warnings
- [x] MCP tests pass

## Agent Output

2026-02-05T09:19:25Z

```
I'll investigate the zombie process issue in the MCP work system.
Found the issue! In `src/mcp/handlers.rs:1704`, the `tool_chant_work_start` function spawns a child process but doesn't store the `Child` handle or call `.wait()` on it. When the process exits, the kernel keeps it as a zombie until the parent reaps it.
The problem is clear: after spawning the child at line 1704, the code extracts the PID and drops the `Child` handle. When the child exits, it becomes a zombie because the parent (MCP server) never calls `wait()` on it.

The fix is to explicitly forget the child handle using `std::mem::forget()` or spawn it in a way that doesn't create zombies. The cleanest approach is to use a background thread that waits for the process.
The spec doesn't have acceptance criteria. Let me add them based on the issue description:
## Summary

Fixed zombie process bug in `src/mcp/handlers.rs:tool_chant_work_start`. The spawned `chant work` process wasn't being reaped - added a background thread that calls `wait()` on the child process.

- Changed `child` to `mut child` to enable moving into thread
- Added `std::thread::spawn` that waits for process exit
- Prevents zombie processes when agent exits early (e.g., on lint failure)```
