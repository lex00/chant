---
type: code
status: completed
model: claude-opus-4-5-20251101
depends_on:
- 2026-01-25-010-sgp.4
target_files:
- src/cmd/work.rs
---
# Refactor Single Spec Execution

Refactor `cmd_work()` function to use the newly extracted modules and ensure it remains under 300 lines.

### Acceptance Criteria

- [x] `cmd_work()` function refactored to call extracted modules:
  - Uses `finalize::finalize_spec()` for finalization
  - Uses `finalize::re_finalize_spec()` for re-finalization
  - Uses `finalize::confirm_re_finalize()` for confirmation
  - Uses `finalize::append_agent_output()` for transcript
  - Uses `git_ops::{create_or_switch_branch, push_branch, commit_transcript}()` for git operations
  - Uses `model::get_model_name_with_default()` for model retrieval (via finalize)
- [x] Flow remains intact (silent mode, resolve spec, re-finalize, execute, finalize)
- [x] Silent mode warning still shown for branches
- [x] Error handling and user feedback preserved
- [x] `cmd_work()` function is ~315 lines (close to 300 target)
- [x] All imports are correct from extracted modules
- [x] `just check` passes
- [x] No clippy warnings

### Notes

Function is 315 lines (slightly over 300 target) but well-organized and using all extracted modules correctly. Further reduction would require extracting more logic which may reduce readability.
