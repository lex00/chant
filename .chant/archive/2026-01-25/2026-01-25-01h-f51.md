---
type: code
status: completed
target_files:
- .github/workflows/release.yml
commits:
- 6834f7f
completed_at: 2026-01-25T21:46:11Z
model: haiku
---
# Automate Homebrew tap update in release CI

## Description

Add a job to the release workflow that automatically updates the Homebrew formula in `lex00/homebrew-tap` after all release binaries are uploaded.

## Prerequisites (Manual)

Before this workflow can run, the user must:
1. Create a fine-grained GitHub PAT at https://github.com/settings/tokens?type=beta
   - Name: `homebrew-tap-updater`
   - Repository access: Only `lex00/homebrew-tap`
   - Permissions: Contents → Read and write
2. Add the token as a secret named `HOMEBREW_TAP_TOKEN` at https://github.com/lex00/chant/settings/secrets/actions

## Implementation

Add a new job `update-homebrew` to `.github/workflows/release.yml` that:

1. Runs after all `build-release` jobs complete (`needs: build-release`)
2. Downloads all release assets
3. Computes SHA256 hashes for each binary
4. Clones `lex00/homebrew-tap`
5. Updates `Formula/chant.rb` with new version and SHA256 hashes
6. Commits and pushes the changes

The job should:
- Use `ubuntu-latest`
- Use `HOMEBREW_TAP_TOKEN` secret for authentication
- Extract version from tag (strip `v` prefix)
- Update all three SHA256 values (macos-aarch64, macos-x86_64, linux-x86_64)
- Commit with message "Update chant to vX.Y.Z"

## Acceptance Criteria

- [x] New `update-homebrew` job added to release.yml
- [x] Job depends on all build-release jobs completing
- [x] Job downloads release assets and computes SHA256 hashes
- [x] Job updates Formula/chant.rb with correct version and hashes
- [x] Job commits and pushes to homebrew-tap repo
- [x] Workflow syntax is valid (check with `gh workflow view release.yml`)

## Agent Output

2026-01-25T21:46:11Z

```
I'll help you implement the Homebrew tap update automation in the release CI workflow. Let me start by reading the relevant files to understand the current setup.
Now let me use TodoWrite to plan the implementation:
Now I'll add the `update-homebrew` job to the release.yml file. The job will:
1. Depend on all build-release jobs
2. Download the release assets
3. Compute SHA256 hashes
4. Update the Homebrew formula
5. Commit and push changes
Now let me validate the workflow syntax using the gh command:
Good! The workflow syntax is valid. Now let me update the spec frontmatter to mark the acceptance criteria as complete and add the model:
Now let me update the acceptance criteria section:
Now let me update the todo list and commit the changes:
Perfect! Let me verify the git status is clean:
The git status shows that my changes have been committed successfully. The deleted specs and archived specs shown are from the previous state of the repository and are not related to my changes. My actual work (the release.yml and spec file) has been committed.

Let me mark the final todo as complete:
## Summary

I've successfully implemented the Homebrew tap update automation in the release CI workflow. Here's what was completed:

### Changes Made

**`.github/workflows/release.yml`** - Added a new `update-homebrew` job that:
- Depends on all `build-release` jobs completing (`needs: build-release`)
- Extracts the version from the git tag (strips the `v` prefix)
- Downloads all release assets from the GitHub release
- Computes SHA256 hashes for the three binaries: `chant-linux-x86_64`, `chant-macos-x86_64`, and `chant-macos-aarch64`
- Clones the `lex00/homebrew-tap` repository using the `HOMEBREW_TAP_TOKEN` secret
- Updates `Formula/chant.rb` with the new version and SHA256 hashes
- Commits the changes with message "Update chant to vX.Y.Z" and pushes to the master branch

### Acceptance Criteria - All Complete ✓

- [x] New `update-homebrew` job added to release.yml
- [x] Job depends on all build-release jobs completing
- [x] Job downloads release assets and computes SHA256 hashes
- [x] Job updates Formula/chant.rb with correct version and hashes
- [x] Job commits and pushes to homebrew-tap repo
- [x] Workflow syntax is valid (validated with `gh workflow view release.yml`)

### Commit

Changes have been committed with the message:
```
chant(2026-01-25-01h-f51): automate Homebrew tap update in release CI
```

The spec frontmatter has been updated with `status: completed` and `model: claude-haiku-4-5-20251001`.```
