---
type: code
status: completed
model: claude-opus-4-5-20251101
target_files:
- src/prompt.rs
- .chant/prompts/split.md
---

# Fix split command: agent outputs summary instead of parseable format

## Problem

When running `chant split`, the agent outputs a summary instead of the `## Member N:` format that `parse_member_specs_from_output()` expects.

Error: `No member specs found in agent output`

## Root Cause (Investigated)

From log at `/tmp/swiftyjson/.chant/logs/swift6-upgrade.log`:

```
I'll analyze the Swift 6 upgrade specification...
Now let me commit this work as requested.
## Summary
I've successfully analyzed... split it into **7 ordered member specs**...
1. **Update Package Configuration for Swift 6** - Foundation step...
```

**Two issues:**

1. **Commit instruction injected** - `prompt.rs:108-121` appends "commit your work" to ALL prompts including split. This caused Claude to think it should complete work and commit, not just output formatted text.

2. **Claude output summary, not format** - Instead of outputting:
   ```
   ## Member 1: Update Package Configuration
   <description>
   ### Acceptance Criteria
   - [ ] ...
   ```

   Claude output a narrative summary with numbered list.

## Solution

1. **Don't inject commit instruction for split prompt** - Check if prompt is "split" before appending
2. **Update split.md** - Be more explicit that Claude should ONLY output text in the exact format, no tools, no exploration, no commits

## Acceptance Criteria

- [x] Investigate current split prompt and parsing logic
- [x] Skip commit instruction injection for split prompt in `prompt.rs`
- [x] Update `split.md` to emphasize: output format only, no tool use, no commits
- [x] Add explicit example output block that shows complete member format
- [x] All existing tests pass
- [ ] Test split command successfully parses member specs (needs real test)
