---
type: code
status: completed
target_files:
- src/cmd/lifecycle/split.rs
branch: chant/2026-02-04-00p-4yq
commits:
- '0642892'
completed_at: 2026-02-04T22:12:29Z
model: sonnet
---
# Extract prompt building from cmd_split

## Problem

`cmd_split()` in `src/cmd/lifecycle/split.rs` is 900+ lines. First step: extract prompt building.

## Solution

Extract LLM prompt construction into a separate `build_split_prompt()` function.

## Acceptance Criteria

- [x] Create `build_split_prompt(spec: &Spec, config: &Config) -> String` function in `src/cmd/lifecycle/split.rs`
- [x] Move prompt template loading and variable substitution into this function
- [x] Function should be pure (no I/O except reading prompt template)
- [x] Call `build_split_prompt()` from `cmd_split()` where prompt was previously built inline
- [x] Run `cargo build` and confirm zero errors

## Agent Output

2026-02-04T22:12:29Z

```
I'll implement this spec by extracting the prompt building logic from `cmd_split()` into a separate function.
Now I'll identify the prompt building logic in the `cmd_split` function and extract it into a separate function:
## Summary

Extracted prompt building logic from `cmd_split()` into `build_split_prompt()` function in src/cmd/lifecycle/split.rs:190-500.

- Created pure function accepting `&Spec`, `&Config`, and `&Path` parameters
- Moved prompt template loading and `prompt::assemble()` call into new function
- Function returns `Result<String>` for error handling
- Updated `cmd_split_impl()` to call new function

All acceptance criteria met, cargo build and clippy pass with zero errors.```
