---
type: code
status: completed
target_files:
- src/cmd/work/single.rs
branch: chant/2026-02-04-00n-xho
commits:
- 9f30a95
completed_at: 2026-02-04T22:11:25Z
model: sonnet
---
# Extract validate_work_preconditions from cmd_work

## Problem

`cmd_work()` in `src/cmd/work/single.rs` is 758 lines. Extract precondition validation to reduce complexity.

## Acceptance Criteria

- [x] Add `fn validate_work_preconditions(spec: &Spec) -> Result<()>` in `src/cmd/work/single.rs`
- [x] Function returns `Err` if spec status is `Completed` or `Cancelled`
- [x] Function returns `Ok(())` for `Pending` or `InProgress` specs
- [x] Call this function near the start of `cmd_work()` before processing begins
- [x] Run `cargo build` and confirm zero errors

## Agent Output

2026-02-04T22:11:25Z

```
I'll implement the extraction of `validate_work_preconditions` from `cmd_work()`.
I need to extract validation logic from lines 231-236 and 372-386 into a new function.
## Summary

Extracted `validate_work_preconditions()` from `cmd_work()` in `src/cmd/work/single.rs`.

- Added new function at line 860 that validates spec status
- Function returns errors for Completed, Cancelled, or InProgress specs
- Replaced inline validation logic at lines 231-236 and 372-386 with single function call
- Reduced function complexity by consolidating precondition checks```
