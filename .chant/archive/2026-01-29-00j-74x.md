---
type: code
status: cancelled
target_files:
- src/templates.rs
- src/main.rs
- src/mcp.rs
context:
- src/cmd/lifecycle.rs
- src/cmd/spec.rs
- src/cmd/search.rs
- src/cmd/work.rs
---
# Cursor MCP integration

Enable Cursor IDE integration via MCP (Model Context Protocol) so that `chant init --agent cursor` auto-generates `.cursor/mcp.json` and the MCP server exposes useful chant tools.

## Problem

Currently `chant init --agent cursor` only creates `.cursorrules`. Cursor IDE supports MCP servers which allow AI agents to call tools. We have an existing MCP server (`chant mcp`) with only 3 basic tools. We should:

1. Generate `.cursor/mcp.json` when initializing with cursor agent
2. Expand the MCP tools to cover more useful CLI operations

## Solution

### Phase 1: Init writes `.cursor/mcp.json`

Add `cursor_mcp_config()` to `src/templates.rs` that returns:
```json
{
  "mcpServers": {
    "chant": {
      "command": "chant",
      "args": ["mcp"]
    }
  }
}
```

Modify `cmd_init()` in `src/main.rs` to write `.cursor/mcp.json` when `--agent cursor` is specified.

### Phase 2: Expand MCP tools

Add query tools (read-only, safe):
- `chant_ready` - list specs with status=ready
- `chant_status` - count specs by status (project summary)
- `chant_log` - read from `.chant/logs/{id}.log`
- `chant_search` - filter specs by query string
- `chant_diagnose` - analyze failed spec
- `chant_show` - full spec details (alias for chant_spec_get with body)

Add mutating tools:
- `chant_add` - create spec file from description
- `chant_work` - spawn agent process (note: this starts an external process)
- `chant_finalize` - update spec to completed
- `chant_resume` - reset failed spec to pending
- `chant_cancel` - set status to cancelled
- `chant_archive` - move to archive dir

## Acceptance Criteria

- [ ] `src/templates.rs` has a `cursor_mcp_config()` function that returns valid MCP JSON config
- [ ] `chant init --agent cursor` creates both `.cursorrules` and `.cursor/mcp.json`
- [ ] `.cursor/mcp.json` contains valid MCP server config pointing to `chant mcp`
- [ ] MCP server exposes `chant_ready` tool that lists ready specs
- [ ] MCP server exposes `chant_status` tool that returns spec counts by status
- [ ] MCP server exposes `chant_log` tool that reads spec log files
- [ ] MCP server exposes `chant_search` tool that searches specs by query
- [ ] MCP server exposes `chant_diagnose` tool that analyzes failed specs
- [ ] MCP server exposes `chant_add` tool that creates new specs
- [ ] MCP server exposes `chant_finalize` tool that finalizes completed specs
- [ ] MCP server exposes `chant_resume` tool that resets failed specs to pending
- [ ] MCP server exposes `chant_cancel` tool that cancels specs
- [ ] MCP server exposes `chant_archive` tool that archives completed specs
- [ ] `echo '{"jsonrpc":"2.0","method":"tools/list","id":1}' | chant mcp` shows 15+ tools
- [ ] All existing tests pass (`cargo test`)
- [ ] Update the test in `mcp.rs` that validates tool count