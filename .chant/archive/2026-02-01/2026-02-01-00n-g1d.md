---
type: code
status: completed
completed_at: 2026-02-01T19:26:12.221126-07:00
---
# Fix chant watch false positive failure detection

`chant watch` incorrectly marks specs as failed when agents actually completed their work.

## Root Cause

The `is_failed()` function in `src/spec.rs:994-1014` has flawed logic:

```rust
// Current logic:
1. Only check in_progress specs
2. If lock file exists → not failed (agent still running)
3. If unchecked criteria exist → FAILED  ← Problem!
```

This triggers false positives when:
- Agent completes work and releases lock
- But criteria aren't checked yet (race condition)
- Or agent completed work but didn't check all criteria boxes

## Solution

Add success signal detection BEFORE flagging as failed:

1. Check for commits matching `chant(<spec-id>):` pattern
2. Check if log file contains completion markers
3. Check if all target files were modified
4. Only flag as failed if NO success signals AND unchecked criteria

## Tasks

1. Read `src/spec.rs` function `is_failed()` (line ~994)
2. Add helper function `has_success_signals(spec_id)` that checks:
   - Git commits with `chant(<spec-id>):` pattern exist
   - Log file doesn't contain obvious error patterns (panics, crashes)
3. Update `is_failed()` to return false if success signals present
4. Add tests for the new logic

## Acceptance Criteria

- [x] `is_failed()` checks for commits before flagging failure
- [x] Specs with matching commits are NOT marked as failed
- [x] Specs with no commits AND unchecked criteria ARE marked as failed
- [x] Tests cover both true positive and false positive scenarios
- [x] `cargo test` passes