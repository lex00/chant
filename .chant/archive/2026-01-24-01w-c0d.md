---
type: code
status: completed
target_files:
- src/main.rs
commits:
- 19907df
completed_at: 2026-01-24T21:57:01Z
model: haiku
---
# Simplify archive - remove include-members flag, always archive whole group

## Problem

The `--include-members` flag is unnecessary complexity. The behavior should be simple:

1. A driver spec can ONLY be archived if ALL its members are completed
2. Archiving a driver ALWAYS archives all its members automatically
3. No flag needed - this is the only sensible behavior

## Changes

1. Remove `--include-members` flag from Archive command
2. When archiving a driver:
   - Check all members are completed (fail if not)
   - Automatically include all members in the archive operation
3. When archiving a member directly:
   - Just archive that member (don't require driver)
   - Driver can stay if other members still active

## Acceptance Criteria

- [x] Remove `--include-members` flag from CLI
- [x] Remove `include_members` parameter from `cmd_archive()`
- [x] Archiving a driver automatically archives all completed members
- [x] Archiving a driver fails if any member is not completed
- [x] Archiving a member directly still works (independent of driver)
- [x] Update/remove tests that reference `--include-members`
- [x] All tests pass

## Agent Output

2026-01-24T21:57:01Z

```
I'll help you implement this spec. Let me start by exploring the codebase to understand the current implementation of the archive command.
Now let me create a todo list and examine the implementation more closely:
Let me read the relevant source files:
Good, now let me check the tests to understand what needs to be updated:
Now let me update the todo and start implementing the changes. First, let me mark the initial reading as complete:
Now let me remove the include_members flag from the CLI parser:
Let me read the full file first:
Now I'll make the edit to remove the include_members flag:
Now update the command dispatch:
Now update the cmd_archive function signature and implementation:
Now I need to update the logic to always archive members when a driver is archived. Let me read the relevant section again:
Now I need to update the logic to always archive members (not conditionally). Here I need to handle two cases:
1. Archiving a member directly - just archive the member (allowed even if driver exists)
2. Archiving a driver - always archive all its members automatically

Let me update the logic:
Good! Now let me update the todo list and check for tests that need to be updated:
Now let me find and check the tests:
Let me read the tests to see if they use the include_members flag:
Let me continue reading to see the rest of the tests:
Good, these are unit tests for the helper functions. Let me check if there are any integration tests that call cmd_archive with the include_members flag:
Good! No tests are currently using the include_members flag. Now let me build and run the tests:
Let me use the just command as suggested in CLAUDE.md:
Good! The build succeeded but there's a warning about an unused variable. Let me fix that:
Now let's rebuild and run the tests:
Let me find the right path:
I see - I need to use the full path. Let me use the justfile approach instead:
Great! Let me run the tests using just:
Excellent! All tests pass! Now let me fix the warning about the unused variable in the test:
I can see the issue - the `specs` variable is created but not used in the test. Let me fix it:
Now let me run the tests again to make sure all is still passing:
Perfect! All tests pass and no warnings. Now let me run the lint:
Excellent! No lint warnings. Let me update the todo list and now build and check the final implementation:
Now let me verify the build one more time:
Perfect! Now let me read the spec file and update it with the model and mark the acceptance criteria as complete:
Now let me update the spec file to mark all acceptance criteria as complete:
Now I need to add the model to the frontmatter. Let me update the status to completed and add the model:
Now let me create a summary of the changes and commit:
Perfect! Now let me commit the changes:
Excellent! Now let me verify the implementation one final time by running a quick check:
Perfect! The `--include-members` flag is completely gone. Let me mark the final todo as complete:
## Summary

I've successfully completed the spec to simplify the archive command. Here's what was done:

### Changes Made:

1. **Removed `--include-members` flag** from the CLI parser in `Commands::Archive`
2. **Removed `include_members` parameter** from `cmd_archive()` function signature
3. **Updated archive logic** to:
   - Always automatically archive all completed members when archiving a driver
   - Allow archiving individual members independently (without requiring the driver)
   - Maintain the validation that drivers cannot be archived if any member is incomplete

### Implementation Details:

- When archiving a driver spec: All members are automatically included in the archive operation (no flag needed)
- When archiving a member spec: The member is archived directly, independent of the driver
- When archiving by criteria: The existing logic correctly handles both drivers and members

### Verification:

✅ All 122 tests pass
✅ No lint warnings
✅ Binary builds successfully
✅ `--include-members` flag no longer appears in help output

The simplified behavior is now the only sensible default, making the archive command more intuitive and less error-prone.```
