---
type: code
status: completed
target_files:
- src/mcp/handlers.rs
- src/scoring.rs
- src/spec.rs
- src/cmd/work/single.rs
completed_at: 2026-02-05T15:50:49.174160-07:00
---
# Investigate and align AC detection between chant work and chant lint

## Problem

User reports that `chant lint` and `chant work` may have different views of acceptance criteria:
- `chant lint` may report a spec as valid
- `chant work` may still prompt about quality issues for the same spec

The MCP `chant_lint` tool was updated to use the same `calculate_spec_score()` function as `chant work`, but there may still be differences in how acceptance criteria are detected or parsed.

## Investigation Areas

1. **AC extraction logic** - How does `extract_acceptance_criteria()` in scoring.rs parse the spec body?
2. **Section detection** - Does it require exact `## Acceptance Criteria` header?
3. **Checkbox format** - What checkbox formats are recognized (`- [ ]`, `- [x]`, `- [X]`)?
4. **Code fence handling** - Are checkboxes inside code fences properly ignored?

## Acceptance Criteria

- [x] Trace the AC extraction logic in `src/scoring.rs` `extract_acceptance_criteria()`
- [x] Compare with `count_total_checkboxes()` and `count_unchecked_checkboxes()` in spec.rs
- [x] Identify any discrepancies between CLI lint and MCP lint behavior
- [x] Add test cases that cover edge cases in AC detection
- [x] Ensure both chant work and chant lint use identical AC parsing

## Resolution

Fixed in v0.15.19 through v0.15.22:

1. **v0.15.19**: Aligned MCP `chant_lint` to use same `calculate_spec_score()` as `chant work`
2. **v0.15.21**: Simplified AC quality scoring to count-based (removed verb analysis that was too aggressive)
3. **v0.15.22**: Fixed `extract_acceptance_criteria()` to:
   - Find checkboxes anywhere in body (not just under "## Acceptance Criteria" header)
   - Handle both `[x]` and `[X]` (case insensitive)
   - Updated tests for new scoring model