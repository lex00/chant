---
type: code
status: cancelled
depends_on:
- 2026-02-06-005-p16
---
# Replace hardcoded strip_prefix("chant/") with config-derived branch prefix

## Problem
Multiple files use hardcoded `strip_prefix("chant/")` or `starts_with("chant/")` to parse branch names, and `starts_with("chant-")` to identify worktree directories. These break when `defaults.branch_prefix` is customized.

## Changes

### 1. `src/cmd/watch.rs:133-134,156-157`
- Replace `branch.starts_with("chant/")` and `branch.strip_prefix("chant/")` with config-derived prefix
- Config is loaded at line ~517, thread the `branch_prefix` into `find_active_worktrees()` as a parameter

### 2. `src/cmd/worktree.rs:80,88`
- `extract_spec_id()` uses `strip_prefix("chant/")` and `strip_prefix("chant-")` — load config or accept prefix as parameter

### 3. `src/mcp/tools/watch.rs:37-38,57-58`
- Same pattern as cmd/watch.rs — `starts_with("chant/")` and `strip_prefix("chant/")`
- Load config to get prefix, or accept as parameter

### 4. `src/worktree/git_ops.rs:512`
- `branch.trim_start_matches("chant/")` in merge error — accept branch_prefix as parameter or derive from branch name

### 5. `src/cmd/cleanup.rs`
- `starts_with("chant-")` checks in worktree scanning — also match `chant-{project}-` pattern for namespaced worktrees

## Acceptance Criteria
- [ ] watch.rs uses config branch prefix for worktree discovery
- [ ] worktree.rs extract_spec_id uses config prefix
- [ ] MCP watch tools use config branch prefix
- [ ] git_ops.rs merge error uses correct prefix
- [ ] cleanup.rs handles namespaced worktree paths
- [ ] `cargo test` passes
- [ ] `cargo clippy -- -D warnings` passes