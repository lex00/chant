---
type: group
status: completed
labels:
- autonomy
- v0.2.0
target_files:
- src/main.rs
- src/cmd/lifecycle.rs
---
# Implement chant verify command to re-check acceptance criteria on completed specs

Add a `chant verify` command that re-checks whether acceptance criteria on completed specs still hold true. This is a key part of the autonomy layer - specs aren't just "done", they're durable specifications that can be verified over time.

## Context

The `drift` command checks if tracked files have changed since completion. The `verify` command goes deeper: it asks an agent to actually check if the acceptance criteria are still satisfied by the current codebase.

Example from docs:
```
$ chant verify 001
Verifying spec 001: Add rate limiting to API

Checking acceptance criteria...
  ✓ Rate limiter middleware exists (src/middleware/ratelimit.go)
  ✓ Returns 429 with Retry-After header
  ✓ Limits are configurable (config.yaml)
  ✓ Tests verify rate limiting works (4 tests passing)

Spec 001: VERIFIED
```

## Design

### Command Interface

```
chant verify [OPTIONS] [ID]

Arguments:
  [ID]  Spec ID to verify. If omitted, verify all completed specs.

Options:
  --all           Verify all completed specs (same as omitting ID)
  --label <LABEL> Only verify specs with this label
  --exit-code     Exit with non-zero code if any spec fails verification
  --dry-run       Show what would be verified without running agents
  --prompt <NAME> Use a specific prompt for verification (default: verify)
```

### Verification Flow

1. Load spec(s) to verify (must be status: completed)
2. For each spec:
   a. Parse acceptance criteria from the spec body
   b. Invoke agent with the verify prompt
   c. Agent checks each criterion against current codebase
   d. Report pass/fail for each criterion
   e. Update spec frontmatter if needed (last_verified, verification_status)

### Agent Verification Prompt

Create `.chant/prompts/verify.md` (built-in):
```markdown
You are verifying that a completed spec's acceptance criteria still hold true.

## Your Task

Check each acceptance criterion against the current codebase state.
For each criterion, report:
- PASS: The criterion is satisfied
- FAIL: The criterion is no longer satisfied (explain why)
- SKIP: Cannot verify (explain why)

## Output Format

After checking all criteria, output a summary:
```
VERIFICATION RESULT: [PASS|FAIL]

Criteria:
- [x] Criterion 1 - PASS
- [ ] Criterion 2 - FAIL: <reason>
- [~] Criterion 3 - SKIP: <reason>
```
```

### Frontmatter Updates

Add optional fields to track verification:
```yaml
last_verified: 2026-01-26T10:00:00Z
verification_status: passed  # passed | failed | partial
verification_failures:
  - "Tests no longer passing"
```

## Acceptance Criteria

- [ ] `chant verify <id>` invokes agent to check acceptance criteria
- [ ] Agent receives spec body and acceptance criteria in prompt
- [ ] Each criterion is checked and reported as PASS/FAIL/SKIP
- [ ] Summary shows overall verification status
- [ ] `--all` flag verifies all completed specs
- [ ] `--label` flag filters specs to verify
- [ ] `--exit-code` returns non-zero if any verification fails
- [ ] `--dry-run` shows specs that would be verified
- [ ] Built-in `verify` prompt is added to templates
- [ ] `last_verified` and `verification_status` updated in frontmatter
- [ ] Only completed specs can be verified
- [ ] Tests cover the verify command functionality
- [ ] `just lint` passes with no warnings

## Notes

- This command uses an agent, so it incurs API costs
- The verify prompt should be concise to minimize token usage
- Consider caching verification results to avoid redundant checks
- The `--exit-code` flag enables CI/CD integration