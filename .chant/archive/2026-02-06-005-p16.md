---
type: code
status: cancelled
---
# Namespace worktree paths by project name and fix branch prefix in single.rs

## Problem
`worktree_path_for_spec` in `src/worktree/git_ops.rs` hardcodes `/tmp/chant-{id}`, causing collisions when multiple chant projects exist. Also `src/cmd/work/single.rs:547` hardcodes `"chant/"` instead of using `config.defaults.branch_prefix`.

## Changes

### 1. `src/worktree/git_ops.rs`
- Change `worktree_path_for_spec(spec_id: &str)` to `worktree_path_for_spec(spec_id: &str, project_name: Option<&str>)`
- When project_name is Some(non-empty), return `/tmp/chant-{name}-{spec_id}`, otherwise `/tmp/chant-{spec_id}`
- Change `create_worktree(spec_id, branch)` to `create_worktree(spec_id, branch, project_name: Option<&str>)` — use project_name in path
- Change `get_active_worktree(spec_id)` to `get_active_worktree(spec_id, project_name: Option<&str>)`

### 2. All callers — thread project_name
Pass `config.project.name` (as `Option<&str>`, treating empty as None) through:
- `src/cmd/work/single.rs` — has config
- `src/cmd/work/parallel.rs` — has config
- `src/cmd/watch.rs` — loads config
- `src/cmd/cleanup.rs` — load config, handle both namespaced and non-namespaced `/tmp/chant-*` dirs

### 3. `src/cmd/work/single.rs:547`
- Replace `format!("chant/{}", spec.id)` with `format!("{}{}", config.defaults.branch_prefix, spec.id)`

### 4. `src/cmd/work/parallel.rs:299`
- Replace `format!("chant/{}", spec_id)` with config-based prefix (config isn't directly available in the cleanup handler — either capture it or use a constant)

### 5. Tests
- Update `test_worktree_path_for_spec` — test with None and Some project name
- Update `test_create_worktree_success` path assertion
- Add test: two project names produce different paths

## Acceptance Criteria
- [ ] `worktree_path_for_spec` accepts optional project name
- [ ] `create_worktree` uses project name in path
- [ ] `single.rs` uses config branch prefix not hardcoded `"chant/"`
- [ ] All callers updated to pass project name
- [ ] `cargo test` passes
- [ ] `cargo clippy -- -D warnings` passes