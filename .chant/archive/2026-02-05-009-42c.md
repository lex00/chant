---
type: code
status: completed
commits:
- 5852b3d
completed_at: 2026-02-05T12:08:21Z
model: sonnet
---
# Support full model names like claude-sonnet-4-20250514 in addition to shorthand like sonnet - map full Anthropic model IDs to the corresponding shorthand that chant uses internally

## Agent Output

2026-02-05T12:08:21Z

```
I'll implement support for full Anthropic model IDs alongside the existing shorthand notation.
Now I understand the codebase. The model name is currently returned as-is from `get_model_name()` in `src/cmd/model.rs` and stored in the spec's frontmatter. There's a `normalize_model_name()` function in `src/spec/parse.rs` that converts full model IDs to shorthand when _parsing_ specs, but the issue is that `get_model_name()` should also normalize model names when they're initially retrieved (from env vars or config).

Let me check the current tests and update the code:
Now let me add tests for the normalization:
Now let me remove the duplicate `normalize_model_name` function from `src/spec/parse.rs` since we should use a single implementation:
I'll replace the local function with a call to the one in model.rs to avoid duplication:
Now let me check where `normalize_model_name` is used in parse.rs and replace it with a call to the public function we'll expose from model.rs:
I need to make the normalize function public in model.rs and import it in parse.rs:
Now import and use it in parse.rs:
Now let me update the test expectations that use full model IDs. Let me find those tests:
I need to update these tests to expect normalized model names:
Now let's run cargo fmt and clippy:
The issue is that `parse.rs` is in the library crate but `cmd` is only in the binary crate. I need to move the `normalize_model_name` function to a shared location. Let me check the crate structure:
I should move the normalize function to the spec module since that's where it's being used. Let me check where else model.rs is used:
I'll move the normalize function to the spec module and have cmd/model.rs use it from there:
I'll add the normalize function to the spec module. Let me add it after the re-exports:
Now update the imports in parse.rs:
Now update cmd/model.rs to import from spec:
Now move the tests from model.rs to spec.rs:
Now let's run clippy again:
Great! Now let's run the tests to make sure everything works:
Perfect! All tests are passing. Now let me check the acceptance criteria in the spec:
The spec doesn't have explicit acceptance criteria, but let me verify the implementation works by running a quick test with environment variables:
Good! Now let's commit the changes:
Perfect! Now let me update the spec to mark it as complete:
The .chant directory is ignored by git, which is correct. Let me verify the status:
Perfect! The implementation is complete and committed. Let me create a summary:

## Summary

Changed `src/cmd/model.rs`, `src/spec.rs`, `src/spec/parse.rs`, and `src/cmd/spec/mod.rs` to support full Anthropic model IDs alongside shorthand notation.

- Added `normalize_model_name()` function to `src/spec.rs` that maps full model IDs (e.g., "claude-sonnet-4-20250514") to shorthand ("sonnet", "opus", "haiku")
- Updated `get_model_name_with_default()` to normalize model names from all sources (env vars, config, claude --version)
- Removed duplicate normalization code from `src/spec/parse.rs`
- Updated all test expectations to match normalized model names
- Added comprehensive tests for the normalization function covering all three Claude model families

Users can now use either `CHANT_MODEL=claude-sonnet-4-20250514` or `CHANT_MODEL=sonnet` interchangeably, and chant will internally normalize them to the shorthand form for consistency.```
