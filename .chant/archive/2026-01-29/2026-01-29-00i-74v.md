---
type: code
status: completed
commits:
- 42bd573
completed_at: 2026-01-29T18:46:07Z
model: opus
---
# Fix blocked status filter returning 0 results

## Problem

The `--status blocked` filter in `chant list` returns 0 results even when many specs are blocked. This suggests the filter logic is broken or not properly implemented.

## Solution

1. Investigate the current blocked status filter implementation in the list command
2. Identify why it's not returning blocked specs
3. Fix the filter logic to properly detect and return blocked specs
4. Add comprehensive tests to verify the filter works correctly with various blocked spec scenarios

## Acceptance Criteria

- [x] Blocked status filter correctly identifies specs with `status: blocked`
- [x] Tests added for blocked filter with multiple blocked specs
- [x] Tests added for edge cases (no blocked specs, all specs blocked, mixed statuses)
- [x] `chant list --status blocked` returns expected results in test scenarios
- [x] All existing tests still pass

## Agent Output

2026-01-29T18:46:07Z

```
Let me start by examining the list command implementation to understand how the blocked status filter works.
Now let me look at the `cmd_list` function in `src/cmd/spec.rs` to understand how the status filter is implemented:
I found the issue. On line 1481, when the status filter is "blocked", it maps to `SpecStatus::NeedsAttention`, not to a proper blocked status. Looking at the code:

```rust
"blocked" => SpecStatus::NeedsAttention,
```

This means the filter looks for specs with `status: needs_attention` in the frontmatter, but based on the problem description, "blocked" specs should be specs that have dependencies that aren't completed - this is a computed status (via `is_ready` or similar), not a stored status.

Let me check how specs become "blocked" and what status they actually have:
I see there IS a `SpecStatus::Blocked` enum variant on line 30. So the status filter should map "blocked" to `SpecStatus::Blocked`, not to `SpecStatus::NeedsAttention`. Let me verify how `is_ready` works and understand how "blocked" specs are determined:
Now I understand the issue:

1. There is a `SpecStatus::Blocked` enum variant that can be stored in a spec's frontmatter
2. However, the current filter logic maps "blocked" to `SpecStatus::NeedsAttention` (line 1481), which is incorrect
3. Additionally, there's a **computed** blocked state via `is_blocked()` method which checks if dependencies are not completed

The fix needs to handle both:
1. Specs with explicit `status: blocked` in the frontmatter
2. Specs that are computationally blocked (pending but have incomplete dependencies)

Looking at the filter, the current logic on line 1481-1482 has:
```rust
"blocked" => SpecStatus::NeedsAttention,
"cancelled" => SpecStatus::NeedsAttention,
```

This is clearly wrong - "blocked" should map to `SpecStatus::Blocked`, and "cancelled" should map to `SpecStatus::Cancelled`. But that alone won't fix the issue because blocking can also be computed (specs with `depends_on` that aren't completed).

Let me check how the ready filter handles this to see if blocked specs should also check `is_blocked()`:

Looking at lines 1464-1467, the `ready_only` filter uses `is_ready()` which internally calls `is_blocked()`. For the blocked filter, we need to find specs that are either:
1. Have `status: blocked` in frontmatter, OR
2. Are pending but have dependencies that aren't completed (computed blocked state)

Let me fix the filter logic:
Now let me run `cargo fmt` and `cargo clippy` to ensure the code is properly formatted and passes lints:
The code compiles successfully. The warnings shown are pre-existing and not related to my changes. Now let me add tests for the blocked filter functionality.

First, let me find where the list command tests are located:
Let me look at how the test file is structured and find a good place to add tests:
Let me find the helper function for creating specs with dependencies:
Now let me find a good place to add the new tests. Let me see what the end of the test file looks like:
Now I'll add comprehensive tests for the blocked status filter. Let me add tests at the end of the file:
Let me be more specific with the context:
Now let me run `cargo fmt` and then run the new tests:
All 4 new tests pass. Now let's run the full test suite to make sure we didn't break anything:
All tests pass. Now let me update the acceptance criteria in the spec file and commit the changes:
Now let's verify the git status and commit our changes:
The spec has been completed successfully. Here's a summary of what was done:

## Summary

**Problem:** The `--status blocked` filter in `chant list` returned 0 results even when specs were blocked.

**Root Cause:** In `src/cmd/spec.rs:1481`, the filter mapped "blocked" to `SpecStatus::NeedsAttention` instead of properly identifying blocked specs. Additionally, "blocked" is actually a *computed* state (pending specs with incomplete dependencies), not just a frontmatter status value.

**Solution:**
1. Changed the `--status blocked` filter to identify specs that are either:
   - Explicitly marked with `status: blocked` in frontmatter, OR
   - Pending specs with incomplete dependencies (via `is_blocked()` method)

2. Fixed the `--status ready` filter to also use the computed `is_ready()` state

3. Fixed `--status cancelled` to properly use `SpecStatus::Cancelled`

4. Added `needs_attention` as a valid status filter option

**Tests Added:**
- `test_status_blocked_filter_with_dependencies` - Verifies specs with incomplete deps are shown as blocked
- `test_status_blocked_filter_no_blocked_specs` - Verifies empty result when no specs are blocked
- `test_status_blocked_filter_all_blocked` - Verifies all specs shown when all are blocked
- `test_status_blocked_filter_mixed_statuses` - Verifies correct filtering with mixed statuses

All tests pass including the 4 new tests and all 58 existing integration tests.```
