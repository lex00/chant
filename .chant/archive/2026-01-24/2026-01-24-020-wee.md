---
type: code
status: completed
target_files:
- src/main.rs
- src/spec.rs
- tests/integration_tests.rs
commits:
- 6606b80
completed_at: 2026-01-24T23:48:21Z
model: haiku
---
# Fail chant work if spec dependencies not met

## Problem

Currently `chant work` doesn't check if a spec's dependencies are satisfied. If spec B depends on spec A, working B before A completes could cause issues.

## Solution

Before starting work on a spec, verify:
1. All specs in `depends_on` list are completed
2. For member specs, verify driver is at least `in_progress`
3. For member specs, verify prior siblings are completed (e.g., can't work .3 until .1 and .2 done)

## Acceptance Criteria

- [x] Check `depends_on` field - all listed specs must be `completed`
- [x] Member specs: prior siblings must be completed (.1 before .2)
- [x] Show clear error listing which dependencies are blocking
- [x] Add `--force` flag to bypass dependency check
- [x] Add test for dependency validation

## Agent Output

2026-01-24T23:48:21Z

```
I'll implement the spec to add dependency checking to `chant work`. Let me start by understanding the codebase structure and the current implementation.
Let me explore the codebase structure first.
Let me continue reading to see the rest of the dependency check logic and understand the full structure:
Good! I can see there's already some dependency checking logic. Now let me check the spec.rs file to understand the data structures better:
Now let me check what the spec file looks like to understand the structure better:
Let me look at a member spec example to understand the structure better:
Good! Now let me check the integration tests to understand how they're structured:
Let me look at the integration tests structure:
Let me continue examining the tests:
Now let me understand the current dependency checking logic better by re-reading the relevant section of cmd_work:
Looking at the code, I can see that there's already dependency checking in place. Now let me understand what's missing according to the spec. The spec requires:

1. ✅ Check `depends_on` field - all listed specs must be `completed` (already exists)
2. ❓ Member specs: prior siblings must be completed (.1 before .2)
3. ✅ Show clear error listing which dependencies are blocking (already exists)
4. ❓ Add `--force` flag to bypass dependency check
5. ❓ Add test for dependency validation

Let me check if the `--force` flag already bypasses the dependency check:
Let me check the CLI args definition to understand if force flag is already supported:
Good! The `--force` flag already exists. Now I need to understand what the spec is asking for exactly. Let me look more carefully at what's missing. Looking back at the code in cmd_work and the is_ready function, I see:

1. The `is_ready` function checks `depends_on` dependencies ✅
2. The `is_ready` function checks that group members are completed (all members must be done if this is a driver) ✅
3. **But it doesn't check prior siblings!** - this is the key missing piece

The spec requires that for member specs like `.1`, `.2`, `.3`, you can't work on `.3` until `.1` and `.2` are completed. Let me update the code to add this check.

First, let me create a todo list to track the implementation:
Now let me examine the spec.rs file more closely to understand the full is_ready function and what needs to be added:
Now I understand the code structure. I need to add:

1. A function to extract the member number from a member spec ID (e.g., "2026-01-24-01x-v06.3" -> 3)
2. Logic to check that all prior siblings are completed
3. Update the `is_ready` function to include this check
4. Update `cmd_work` to allow `--force` to bypass the dependency check
5. Add tests

Let me start implementing these changes:
Let me look at the entire spec.rs to understand where to add the new function:
Now I'll add the functions needed to support sibling checking. Let me insert them after the `extract_driver_id` function:
Now I need to update the `is_ready` function to include the prior sibling check:
Now I need to update the cmd_work function to allow the `--force` flag to bypass dependency checks. Let me first check the current code again:
I see the current code doesn't allow forcing past dependencies. I need to wrap the dependency check to allow bypassing with the force flag. Let me update this:
Now I need to update the parallel work function as well. Let me find it:
The parallel work function already filters by `is_ready`, which is good - it will automatically respect the new sibling check. Now let me build and test the changes:
Let me check if there's a justfile available:
Good! Let me build using just:
Excellent! The build succeeded. Now let me update the todo list and add tests:
Now let me add tests for the dependency validation. First, let me look at the end of the integration tests file:
Let me look at the beginning and middle of the test file to understand the test patterns better:
Now let me add a test for dependency validation at the end of the integration test file:
Let me check the total number of lines in the test file:
Let me read the end of the file to see where to add the new test:
Perfect! Now I'll add a test for dependency validation. However, I realize that integration tests in this file are mostly testing the worktree functionality, not the spec logic. Let me add unit tests in the spec.rs file instead, since that's where the logic is. Let me first check if there are any existing tests in spec.rs:
Great! There are already tests in spec.rs. Let me look at the test module structure:
Let me continue reading the tests to understand the pattern:
Perfect! Now I understand the test pattern. Let me check where the test module ends:
Now let me add tests for the new functions. I'll add them before the closing brace of the tests module:
Perfect! Now I'll add the new tests before the closing brace. Let me add comprehensive tests for the new dependency validation functions:
Great! Now let's update the todo list and run

... (output truncated, 9288 chars total)```
