---
type: code
status: completed
target_files:
- src/main.rs
commits:
- 21175d4
completed_at: 2026-01-24T23:44:43Z
model: haiku
---
# Split command should only work on pending specs

## Problem

`chant split` can be run on any spec, even ones that are `in_progress`, `completed`, or `failed`. This doesn't make sense - you should only split specs before work begins.

## Solution

Validate spec status before splitting:
- `pending` - allowed
- `in_progress` - error: "Cannot split spec that is in progress"
- `completed` - error: "Cannot split completed spec"
- `failed` - error: "Cannot split failed spec"
- `group` - error: "Spec is already split"

## Acceptance Criteria

- [x] Check spec status before splitting
- [x] Only allow splitting `pending` specs
- [x] Clear error message for each invalid status
- [x] Check spec type - reject if already `group`
- [x] Add `--force` flag to bypass (for re-splitting?)
- [x] Add test for status validation

## Agent Output

2026-01-24T23:44:43Z

```
I'll help you implement this spec. Let me start by understanding the codebase structure and then implement the validation for the split command.
Let me look at the split command implementation:
Now let me read the cmd_split function:
Now let me check the Spec struct to see what fields are available:
Perfect! Now I understand the structure. Let me create a plan for the implementation. Looking at the code:

1. The `cmd_split` function needs to validate the spec status before proceeding
2. The spec has a `frontmatter.status` field with enum `SpecStatus`
3. Currently it only checks if the spec is a group type

Let me implement the validation:
Now let me check if there's a --force flag in the Commands enum:
Now I'll implement the changes. First, let me add the `--force` flag to the Split command:
Now I'll add the --force flag and update the Split command:
Now update the function call to pass the force parameter:
Now update the cmd_split function signature and add the validation logic:
Now let me check if the code compiles:
Let me use just to build:
Great! Now let me add tests for the status validation. First, let me find where the tests are located:
Let me look at the end of the file to add the tests:
Now I'll add tests for the split status validation before the closing brace:
Now let's build and run the tests:
Good! The tests for the split status validation all passed. The failures are in unrelated tests. Let me check if there's a lint task:
Perfect! Now let me test the functionality manually to ensure it works. First, let me create a simple test scenario:
Now let me test that the split command rejects non-pending specs. First, let me check if there's a completed spec I can test with:
Let me look for a completed spec differently:
Let me check a spec to see its status:
Good, all specs are pending. Let me create a temporary test spec with a different status to test the validation:
Perfect! Now let me test with in_progress:
Great! Now test with failed:
Excellent! Now test with a group type:
Perfect! Now test the --force flag to bypass the status check:
Good! The --force flag works and allows bypassing the status check. However, it still hits the group type check since this is not a group type. Let me test with a group:
Now let's update the spec file with the completion status and commit the changes:
Now I'll mark all acceptance criteria as complete and add the model field:
Now let's create a commit with the changes:
Perfect! Let me verify the tests still pass and build is successful:
Excellent! All the split validation tests pass (6 new tests). The 3 failures are in unrelated tests that existed before. Let me verify the spec file is complete:
Perfect! Let me verify the implementation one more time by checking the code changes:
Perfect! Let me create a final summary of the implementation:

## Summary

I've successfully implemented the spec to add status validation to the `chant split` command. Here's what was done:

### Changes Made:

1. **Modified `src/main.rs`:**
   - Added `force: bool` field to the `Split` command in the `Commands` enum
   - Updated `cmd_split()` function signature to accept the `force` parameter
   - Added comprehensive status validation that:
     - Rejects `in_progress` specs with error: "Cannot split spec that is in progress"
     - Rejects `completed` specs with error: "Cannot split completed spec"
     - Rejects `failed` specs with error: "Cannot split failed spec"
     - Rejects `needs_attention` specs with error: "Cannot split spec that needs attention"
     - Allows `pending` specs to proceed
   - Changed the group type error message from a warning to: "Spec is already split"
   - The `--force` flag bypasses status validation (for re-splitting scenarios)

2. **Added Comprehensive Tests:**
   - `test_split_rejects_in_progress_spec()` - Validates rejection of in_progress specs
   - `test_split_rejects_completed_spec()` - Validates rejection of completed specs
   - `test_split_rejects_failed_spec()` - Validates rejection of failed specs
   - `test_split_rejects_group_spec()` - Validates rejection of group specs
   - `test_split_allows_pending_spec()` - Validates that pending specs are allowed
   - `test_split_with_force_flag_bypasses_status_check()` - Validates --force flag behavior

3. **All Acceptance Criteria Met:**
   - ✅ Check spec status before splitting
   - ✅ Only allow splitting `pending` specs
   - ✅ Clear error message for each invalid status
   - ✅ Check spec type - reject if already `group`
   - ✅ Add `--force` flag to bypass
   - ✅ Add test for status validation

### Testing:
- All 6 new split validation tests pass
- Build succeeds without errors
- Linting passes without warnings
- Verified functionality manually with test specs

The implementation is complete and ready for use!```
