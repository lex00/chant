---
type: code
status: completed
branch: chant/2026-02-06-007-mrk
completed_at: 2026-02-06T16:21:25.357757-07:00
---
# Add project_name parameter to worktree functions and fix hardcoded branch prefix

## Goal
Add `project_name: Option<&str>` to worktree functions in git_ops.rs and update all callers to pass `None`. Also fix the one hardcoded `"chant/"` branch prefix in single.rs.

## Exact changes (mechanical — follow precisely)

### File: `src/worktree/git_ops.rs`

**Function `worktree_path_for_spec` (line 18):**
Change signature from `pub fn worktree_path_for_spec(spec_id: &str) -> PathBuf` to `pub fn worktree_path_for_spec(spec_id: &str, project_name: Option<&str>) -> PathBuf`
Change body: if `project_name` is `Some(name)` where name is non-empty, return `PathBuf::from(format!("/tmp/chant-{}-{}", name, spec_id))`, else keep current behavior.

**Function `get_active_worktree` (line 25):**
Change signature to add `project_name: Option<&str>`, pass it through to `worktree_path_for_spec`.

**Function `create_worktree` (line 142):**
Change signature to add `project_name: Option<&str>`, use it in the `PathBuf::from(format!(...))` on line 143, same logic as worktree_path_for_spec.

### Update ALL callers to pass `None` (search for function names):

- `src/worktree/git_ops.rs` — internal calls in `get_active_worktree`
- `src/cmd/work/single.rs` — calls `worktree::create_worktree`, `worktree::get_active_worktree`
- `src/cmd/work/parallel.rs` — calls `worktree::create_worktree`
- `src/cmd/watch.rs` — may call `worktree::get_active_worktree` or `worktree_path_for_spec`
- `src/cmd/cleanup.rs` — may call worktree functions
- `src/mcp/tools/*.rs` — may call worktree functions
- Tests in `git_ops.rs` — update test calls

Use `grep -r "worktree_path_for_spec\|create_worktree\|get_active_worktree" src/ tests/` to find ALL call sites.

### Fix hardcoded prefix in `src/cmd/work/single.rs` line 547:
Change `format!("chant/{}", spec.id)` to `format!("{}{}", config.defaults.branch_prefix, spec.id)`

### Fix hardcoded prefix in `src/cmd/work/parallel.rs` line 299:
Change `format!("chant/{}", spec_id)` to `format!("{}{}", self.branch_prefix, spec_id)` — store config.defaults.branch_prefix in ParallelExecutionState

## Acceptance Criteria
- [x] Three functions in git_ops.rs accept `project_name: Option<&str>`
- [x] All callers pass `None` (or config value where available)
- [x] single.rs uses `config.defaults.branch_prefix`
- [x] `cargo test` passes
- [x] `cargo clippy -- -D warnings` passes