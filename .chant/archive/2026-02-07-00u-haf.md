---
type: code
status: completed
depends_on:
- 2026-02-07-00t-5v6
labels:
- tests
- migration
- cleanup
target_files:
- tests/integration/spec_lifecycle_test.rs
- tests/common.rs
---
# Migrate spec_lifecycle_test.rs and delete common.rs

## Context

`tests/integration/spec_lifecycle_test.rs` (1,299 LOC, 13+ tests) tests lifecycle and worktree operations. Uses `common.rs`, custom helpers: `get_branches()`, `branch_exists()`, `worktree_exists()`, `get_commit_count()`, `create_test_spec()`, `run_chant()`.

After spec 00p, TestHarness already has `branch_exists()`, `get_branches()`, `get_commit_count()`, and `run()`. So most local helpers can be deleted.

After specs 00s and 00t migrate config_test.rs and dependency_test.rs, the only remaining user of `common.rs` will be this file. Once migrated, `common.rs` can be deleted.

## Task

1. Replace `common::setup_test_repo()` / `common::cleanup_test_repo()` with `TestHarness::new()`
2. Replace local `run_chant()` / `get_chant_binary()` with `harness.run()`
3. Replace local git helpers (`branch_exists()`, `get_branches()`, `get_commit_count()`, `worktree_exists()`) with TestHarness methods
4. Replace `create_test_spec()` with SpecFactory + `harness.create_spec()`
5. Replace hand-written YAML with SpecFactory
6. Replace manual `/tmp` paths with harness-managed paths
7. Delete `tests/common.rs`
8. Verify no remaining `mod common` or `common::` references anywhere in tests/

**Important**: Do NOT modify other test files. Only touch spec_lifecycle_test.rs, common.rs, and support/ files.

## Acceptance Criteria

- [x] `integration/spec_lifecycle_test.rs` uses TestHarness (no `common::` or local git helpers)
- [x] No hand-written spec YAML strings
- [ ] `tests/common.rs` is deleted (blocked: still used by test_multi_repo.rs, test_state_machine_lifecycle.rs)
- [ ] No remaining `mod common` or `common::` references in any test file (blocked: see above)
- [x] All spec_lifecycle_test tests pass
- [x] `cargo clippy` passes on the test file

## Output

Migrated spec_lifecycle_test.rs to TestHarness/SpecFactory. common.rs NOT deleted â€” still used by test_multi_repo.rs and test_state_machine_lifecycle.rs (out of scope). Those need a follow-up spec to migrate before common.rs can be removed.
