---
type: code
status: completed
commits:
- 69761db
completed_at: 2026-02-05T11:25:09Z
model: sonnet
---
# Run lint validation before worktree creation in chant work - fail fast with actionable feedback if spec has issues, before spawning agent or creating worktree

## Agent Output

2026-02-05T11:25:09Z

```
I'll implement the lint validation before worktree creation in `chant work`. Let me start by reading the relevant code.
Now I need to understand where `chant work` creates the worktree and see where lint validation should be inserted. Let me check the worktree creation logic:
Looking at the code, I can see that:
1. In `single.rs` line 529, `create_worktree` is called
2. In `chain.rs`, there's no worktree creation (it works on main branch)
3. In `parallel.rs` line 539, `create_worktree` is called

The lint validation should happen **before** worktree creation to fail fast. Looking at `single.rs`, the flow is:
- Line 228: Resolve spec
- Line 232-234: Validate work preconditions
- Line 529: Create worktree â† **lint should happen before this**

I need to add lint validation after resolving the spec but before creating the worktree. Let me check what the lint function looks like:
Perfect! Now I'll implement the lint validation. The strategy is:
1. After resolving the spec (line 228 in single.rs)
2. Before creating worktree (line 529 in single.rs)
3. Run `lint_specific_specs` and check if `failed > 0`
4. If there are errors, bail with actionable message

Let me implement this:
Now I need to do the same for chain.rs. Let me check where the spec is resolved there:
Now I need to do the same for parallel.rs. Let me find where specs are resolved there:
I can see that in parallel mode, specs are loaded as a batch. I need to validate all specs before starting parallel execution. Let me add validation after line 397:
Now let me run `cargo fmt` and `cargo clippy` to ensure the code is properly formatted and has no lint errors:
Great! Now let me check off the acceptance criteria in the spec:
It looks like the spec file doesn't have the full content. Let me check for a spec file with more content:
The spec doesn't have acceptance criteria yet. Let me check the git status to see what files were modified:
Good! Now let me commit the changes:
Perfect! The implementation is complete. Let me create a summary:

## Summary

Added lint validation before worktree creation in `chant work` to fail fast with actionable feedback if spec has issues.

**Changes made:**
- **src/cmd/work/single.rs**: Added lint validation after spec resolution, before worktree creation (line ~230)
- **src/cmd/work/chain.rs**: Added lint validation in chain execution mode after spec resolution (line ~140)
- **src/cmd/work/parallel.rs**: Added batch lint validation for all specs before starting parallel execution (line ~400)

**Key implementation details:**
- Validation runs immediately after spec resolution but before any expensive operations (worktree creation, agent spawning)
- Uses existing `lint_specific_specs()` function which performs comprehensive spec validation
- Fails with clear error message if any validation errors found: `"Spec validation failed with N error(s). Fix the issues before running 'chant work'. Run 'chant lint <spec-id>' to see details."`
- Shows warning count but allows execution if only warnings (no errors) are present
- Applied consistently across all three work modes: single, chain, and parallel

The implementation ensures specs are validated early in the workflow, preventing wasted time on invalid specs and providing actionable feedback to fix issues before attempting execution.```
