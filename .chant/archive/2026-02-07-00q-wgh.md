---
type: code
status: cancelled
depends_on:
- 2026-02-07-00p-q5s
labels:
- tests
- migration
- cleanup
target_files:
- tests/integration/config_test.rs
- tests/integration/dependency_test.rs
- tests/integration/spec_lifecycle_test.rs
- tests/common.rs
- tests/support/harness.rs
- tests/support/factory.rs
---
# Migrate hard test files and delete common.rs

## Context

Three large integration test files (3,956 LOC total) are the last holdouts using `common.rs` and manual setup. After this migration, `common.rs` can be deleted entirely.

1. **`integration/config_test.rs`** (1,164 LOC, 14+ tests) — extensive enterprise config testing. Uses `common.rs`, manual git init, hand-written config YAML. Needs a `TestHarness::with_enterprise_config()` or similar factory method for enterprise config setups.

2. **`integration/dependency_test.rs`** (1,493 LOC, 17+ tests) — dependency chain testing. Uses `common.rs`, custom helpers: `create_spec_with_dependencies()`, `update_spec_status()`, `run_chant_list()`. Should use `SpecFactory::blocked_by()` for dependency setup.

3. **`integration/spec_lifecycle_test.rs`** (1,299 LOC, 13+ tests) — lifecycle and worktree testing. Uses `common.rs`, custom helpers: `get_branches()`, `branch_exists()`, `worktree_exists()`, `get_commit_count()`, `create_test_spec()`. After spec 00p moves git helpers to TestHarness, this file can use them directly.

## Task

For each file:
1. Replace all `common::setup_test_repo()` / `common::cleanup_test_repo()` with `TestHarness::new()`
2. Replace hand-written YAML with SpecFactory methods
3. Replace local `run_chant()` / `get_chant_binary()` with `harness.run()`
4. Remove duplicated helper functions that now exist in TestHarness
5. Add any new SpecFactory methods needed (e.g. `as_markdown_with_deps()`, `as_markdown_with_config()`)

After migrating all 3 files:
6. Delete `tests/common.rs`
7. Remove all `mod common` declarations across test files
8. Verify no file references `common::` anymore

## Acceptance Criteria

- [ ] `integration/config_test.rs` uses TestHarness (no `common.rs`)
- [ ] `integration/dependency_test.rs` uses TestHarness and SpecFactory
- [ ] `integration/spec_lifecycle_test.rs` uses TestHarness (no local git helpers that duplicate TestHarness)
- [ ] `tests/common.rs` is deleted
- [ ] No remaining `mod common` or `common::` references in test files
- [ ] All existing tests pass
- [ ] `cargo clippy` passes