---
type: code
status: completed
target_files:
- src/score/confidence.rs
branch: chant/2026-02-09-002-3mh
commits:
- 8d6bcab
completed_at: 2026-02-09T22:29:25Z
model: sonnet
---
# Relax confidence scorer thresholds so well-written specs can achieve passing grades
## Problem

The confidence scorer in `src/score/confidence.rs` has thresholds that make it nearly impossible for normal, well-written specs to score above D:

- **Grade D auto-trigger**: bullet ratio <20% — but specs naturally have headings (`## Section`), context paragraphs, and code blocks that count as prose. A spec with 3 bullets and a Problem/Solution/AC structure easily falls below 20%.
- **Grade A requires >80% bullet ratio** — only achievable with pure bullet-list specs with almost no prose context at all.
- **Vague pattern matching is too broad**: "improve" matches "improvement" (substring), "similar" flags legitimate technical usage ("similar to the existing pattern"). >5 instances across an entire spec body = auto Grade D.
- **Grade C gap**: The C check requires exactly 3-5 vague patterns AND >30% verb ratio. Specs with 0-2 vague patterns but only 30-50% bullet ratio fall through to default C, but specs with 20-50% bullet ratio and 0 vague patterns also get C — same grade as specs with actual problems.

## Solution

- Lower the Grade D bullet ratio threshold from <20% to <10% (only truly prose-wall specs)
- Lower Grade A bullet ratio from >80% to >60% 
- Lower Grade B bullet ratio from >50% to >30%
- Raise vague pattern Grade D threshold from >5 to >8 instances
- Fix Grade C logic: remove the rigid 3-5 vague count requirement, make it the natural fallthrough between B and D
- Exclude markdown headings from paragraph count (they are structural, not prose)

## Target Files

- src/score/confidence.rs

## Acceptance Criteria

- [x] Grade D bullet ratio threshold lowered from <20% to <10%
- [x] Grade A bullet ratio threshold lowered from >80% to >60%
- [x] Grade B bullet ratio threshold lowered from >50% to >30%
- [x] Vague pattern Grade D threshold raised from >5 to >8
- [x] Grade C no longer requires exactly 3-5 vague patterns — it is the natural fallthrough between B and D
- [x] Markdown headings (lines starting with #) excluded from paragraph line count in `count_bullets_and_paragraphs`
- [x] Existing tests updated to reflect new thresholds
- [x] `cargo test` passes
- [x] `cargo clippy -- -D warnings` passes

## Agent Output

2026-02-09T20:42:23Z

```
I'll implement the changes to relax the confidence scorer thresholds.
Now I need to update the tests to reflect the new thresholds:
The test is failing because the vague pattern count in the test doesn't exceed 8. Let me check what patterns are being detected:
The patterns are: "improve", "as needed", "etc", "and related", "similar". Let me count the instances in the failing test. The test has:
- "Improve performance as needed" - "improve", "as needed"
- "Add features and related functionality" - "and", "related" (but "and related" is the pattern, not separate)
- "Create tests etc" - "etc"
- "Update components as needed" - "as needed" (2nd instance)
- "Fix bugs and related issues" - "and related" (2nd instance)
- "Similar improvements needed" - "similar", "improve" (2nd instance of "improve" in "improvements")

Total instances: improve(2), as needed(2), etc(1), and related(2), similar(1) = 8 instances. That's exactly 8, which is not >8, so it falls through to Grade C, not D.

I need to add more vague patterns to make it >8:
Perfect! All tests pass. Now let me update the acceptance criteria in the spec file:
## Summary

Updated `src/score/confidence.rs` to relax scorer thresholds for better grading of normal specs.

- Lowered Grade D threshold from <20% to <10% bullet ratio
- Lowered Grade A threshold from >80% to >60% bullet ratio  
- Lowered Grade B threshold from >50% to >30% bullet ratio
- Raised vague pattern Grade D threshold from >5 to >8 instances
- Removed rigid 3-5 vague count requirement for Grade C — now natural fallthrough
- Updated doc comments to reflect new grading rules
- Updated test comments and added more vague patterns to test case to exceed threshold
- All tests pass, clippy passes, git status clean```